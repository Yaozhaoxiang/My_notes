# <future>
## std::future

std::future提供了一种访问异步操作结果的机制。

std::future和std::promise是用于实现异步任务结果传递的工具，并不是消息队列。它们主要用来获取异步操作的结果或者状态。具体来说：

std::promise 是一种机制，用于在一个线程中设置一个值，而另一个线程可以通过对应的 std::future 对象来获取这个值。

**主要特性：**
1. 异步操作：你可以在一个线程中进行某种计算或操作，然后将结果传递给另一个线程。

2. 与 std::future 结合使用：
std::promise 创建一个 std::future 对象，可以通过这个对象来获取异步操作的结果。
```cpp
std::promise<bool> callback;
std::future<bool> future_result = callback.get_future();
```

3. 设置值：在某个线程中，你可以调用 callback.set_value(true); 来设置结果值。

4. 获取值：在另一个线程中，你可以调用 future_result.get(); 来获取结果值。如果值尚未设置，调用 get() 将会阻塞，直到值被设置。

注意：std::promise和std::future是**一次性**的，即一个std::promise对象只能被设置一次值，而std::future对象只能获取一次结果。如果需要多次通信，可以考虑使用其他线程同步机制，如条件变量、互斥锁等。此外，使用std::future的wait_for或wait_until方法可以实现非阻塞的等待，并可以设置超时时间。


```cpp
#include <iostream>
#include <thread>
#include <future>

void asyncOperation(std::promise<bool> promise) {
    // 模拟某种异步操作
    std::this_thread::sleep_for(std::chrono::seconds(1));
    promise.set_value(true);  // 设置结果值
}

int main() {
    std::promise<bool> promise;
    std::future<bool> future_result = promise.get_future();

    std::thread t(asyncOperation, std::move(promise));

    // 等待异步操作完成并获取结果
    bool result = future_result.get(); 
    std::cout << "Operation result: " << result << std::endl;

    t.join(); // 等待线程完成
    return 0;
}

```

## async

async可以根据情况选择**同步执行**或创建新线程来**异步执行**，当然也可以手动选择。对于async的**返回值**操作也比thread更加方便。

std::async参数
不同于thread，async是一个函数，所以没有成员函数。

std::async会自动创建一个线程去调用 线程函数，它返回一个std::future，这个future中存储了线程函数返回的结果，当我们需要线程函数的结果时，直接从future中获取。




```cpp
template <class Function, class... Args>
std::future<typename std::result_of<Function(Args...)>::type>
    async(std::launch policy = std::launch::async | std::launch::deferred,
          Function&& f, Args&&... args);
```

异步或同步（根据操作系统而定）以args为参数执行fn 同样地，传递引用参数需要std::ref或std::cref

+ policy：指定任务的执行策略，默认值是 std::launch::async | std::launch::deferred，这意味着编译器可以选择最合适的策略。您可以明确指定为 std::launch::async（立即在一个新线程中执行）或 std::launch::deferred（延迟执行，直到结果被获取时才执行）。
+ f：要异步执行的可调用对象（如函数、lambda 表达式等）。
+ args：传递给 f 的参数。


+ std::launch:
std::launch::async : 异步启动
std::launch::deferred : 在调用future::get、future::wait时同步启动
特殊值：launch::async | launch::defereed : 同步或异步，根据操作系统而定



















