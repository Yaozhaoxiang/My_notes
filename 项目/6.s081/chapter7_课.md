#### 线程切换
state：
RUNNING  ：当前在cpu上运行的线程；
RUNNABLE  ：想运行但是还没有运行的线程；
SLEEPING ：  不允许的状态；

每个cpu和进程都保持一个 context；调度的时候，保存当前的 context到进程中，加载cpu中下一个进程的context；


如果程序执行一个系统调用或因为响应中断走到了内核中，那么用户状态保存在 trampfram中，同时属于这个用户程序的内核线程会被激活；

切换：在内核中这个进程的内核线程切换到其他内核进程的内核线程，然后其他进程的内核线程会返回到用户空间。 线程转换发生在内核中，索引 context保存的是内核寄存器，

通过switch里加载cpu中的ra，这是返回地址，这指向 scheduler(void)，也就是cpu的调度器，每个cpu都有一个调度器；




**什么是内核栈？**
在操作系统中，每个进程都有一个内核栈（kernel stack），它在进程进入内核模式时使用。内核栈的作用非常重要，主要用于存储与进程在内核模式下执行相关的信息。以下是内核栈的主要作用和详细解释：
1.  存储函数调用的上下文
当进程从用户模式切换到内核模式时，内核栈用于存储函数调用的上下文信息。这些信息包括：
+ 寄存器值：保存当前寄存器的值，以便在返回用户模式时恢复。
+ 局部变量：存储函数调用中的局部变量。
+ 返回地址：保存调用函数的返回地址，以便在函数执行完毕后能够正确返回

2. 存储系统调用参数
当进程执行系统调用时，传递给系统调用的参数通常会存储在内核栈中。这些参数在内核模式下会被系统调用处理函数使用。

3. 存储中断处理信息
当发生中断时，内核栈用于存储中断处理过程中需要的信息。这些信息包括：
中断状态：保存中断发生时的处理器状态。
中断处理函数的局部变量：存储中断处理函数中的局部变量。









