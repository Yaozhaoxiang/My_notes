# springBoot

## 1. åˆ›å»ºé¡¹ç›®

![](./å›¾ç‰‡/springboot-1.png)

![](./å›¾ç‰‡/springboot-2.png)

åœ¨com.yzxåŒ…ä¸‹åˆ›å»ºä¸€ä¸ª HelloController å¤„ç†å‡½æ•°ï¼›

è¯·æ±‚å¤„ç†å‡½æ•°å†™æ³•ï¼š
```java
@RestController // æ ‡è¯†è¯·æ±‚å¤„ç†ç±»
public class HelloController {
    @RequestMapping("/hello") // æ ‡è¯†
    public String sayHello() {
        System.out.println("Hello World");
        return "Hello World";
    }
}
```

åœ¨å­˜æ”¾æºç çš„src/main/javaç›®å½•ä¸­ï¼ŒSpring Bootå¯¹JavaåŒ…çš„å±‚çº§ç»“æ„æœ‰ä¸€ä¸ªè¦æ±‚ã€‚æ³¨æ„åˆ°æˆ‘ä»¬çš„æ ¹packageæ˜¯com.itranswarp.learnjavaï¼Œä¸‹é¢è¿˜æœ‰entityã€serviceã€webç­‰å­packageã€‚Spring Bootè¦æ±‚main()æ–¹æ³•æ‰€åœ¨çš„å¯åŠ¨ç±»å¿…é¡»æ”¾åˆ°æ ¹packageä¸‹ï¼Œå‘½åä¸åšè¦æ±‚ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥Application.javaå‘½åï¼Œå®ƒçš„å†…å®¹å¦‚ä¸‹ï¼š

```java
@SpringBootApplication
public class Application {
    public static void main(String[] args) throws Exception {
        SpringApplication.run(Application.class, args);
    }
}
```

å¯åŠ¨ç«¯å£ 8080ï¼›

å¯åŠ¨Spring Bootåº”ç”¨ç¨‹åºåªéœ€è¦ä¸€è¡Œä»£ç åŠ ä¸Šä¸€ä¸ªæ³¨è§£@SpringBootApplicationï¼Œè¯¥æ³¨è§£å®é™…ä¸ŠåˆåŒ…å«äº†ï¼š

+ @SpringBootConfiguration
    + @Configuration
+ @EnableAutoConfiguration
    + @AutoConfigurationPackage
+ @ComponentScan


## 2. è¯·æ±‚å¤„ç†å‡½æ•°

âœ… 1. åŸºæœ¬ç¤ºä¾‹ï¼šå¤„ç† GET è¯·æ±‚

```java
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/hello")  // ç±»ä¸Šçš„è·¯å¾„å‰ç¼€
public class HelloController {

    @GetMapping("/say")  // å¤„ç† GET è¯·æ±‚ /hello/say
    public String sayHello() {
        return "Hello, Spring Boot!";
    }
}
```

âœ… 2. æ¥æ”¶å‚æ•°çš„å‡ ç§æ–¹å¼ï¼š

ğŸ‘‰ æ–¹å¼ä¸€ï¼šè·¯å¾„å‚æ•°ï¼ˆPathVariableï¼‰

```java
@GetMapping("/user/{id}")
public String getUser(@PathVariable("id") int id) {
    return "User ID: " + id;
}

```

ğŸ‘‰ æ–¹å¼äºŒï¼šè¯·æ±‚å‚æ•°ï¼ˆRequestParamï¼‰

```java
@GetMapping("/search")
public String search(@RequestParam("q") String query) {
    return "Search query: " + query;
}
```

ğŸ‘‰ æ–¹å¼ä¸‰ï¼šè¯·æ±‚ä½“ JSONï¼ˆPost è¯·æ±‚ï¼ŒRequestBodyï¼‰
```java
@PostMapping("/user")
public String createUser(@RequestBody User user) {
    return "Received user: " + user.getName();
}
```
å…¶ä¸­ User æ˜¯ä¸€ä¸ª POJO ç±»ï¼š
```java
public class User {
    private String name;
    private int age;

    // è®°å¾—åŠ  getter/setter æˆ–ç”¨ @Data æ³¨è§£
}
```

âœ… 3. è¿”å› JSON å¯¹è±¡
```java
@GetMapping("/json")
public User getUserJson() {
    User user = new User();
    user.setName("Tom");
    user.setAge(20);
    return user;  // ä¼šè‡ªåŠ¨è½¬ä¸º JSON å“åº”
}
```

âœ… 4. å¤„ç† POST è¯·æ±‚ï¼ˆè¡¨å•æˆ– JSONï¼‰
```java
@PostMapping("/submit")
public String handleForm(@RequestParam String name, @RequestParam int age) {
    return "Name: " + name + ", Age: " + age;
}
```

ğŸ” ä½ å¯ä»¥ç†è§£ä¸ºï¼š

æ³¨è§£ | æè¿° | å¯¹åº” HTTP æ–¹æ³•
---|---|---
@GetMapping | å¤„ç† GET è¯·æ±‚ | GET
@PostMapping | å¤„ç† POST è¯·æ±‚ | POST
@PutMapping | å¤„ç† PUT è¯·æ±‚ | PUT
@DeleteMapping | å¤„ç† DELETE è¯·æ±‚ | DELETE
@RequestBody | ä»è¯·æ±‚ä½“ä¸­è¯»å– JSON æ•°æ®ï¼Œç»‘å®šåˆ°å¯¹è±¡ | ä»»æ„ï¼ˆå¸¸ç”¨äº POST/PUTï¼‰
@RequestParam | ä» URL æŸ¥è¯¢å‚æ•°ä¸­è·å–æ•°æ® | ä»»æ„ï¼ˆå¸¸ç”¨äº GETï¼‰
@PathVariable | ä»è·¯å¾„ä¸­æå–å˜é‡ | ä»»æ„


## 3. springbootweb å…¥é—¨è§£æ

![](./å›¾ç‰‡/springboot-3.png)

springboot å·²ç»å†…åµŒäº†Tomcatä¾èµ–ï¼Œç«¯å£ 8080ï¼›
![](./å›¾ç‰‡/springboot-4.png)

## 4. è¯·æ±‚å“åº”

![](./å›¾ç‰‡/springboot-5.png)

DispacherServlet ç”¨æ¥æ¥å—å’Œåˆ†å‘è¯·æ±‚ï¼›

æ€ä¹ˆåŒ…è£…è¯·æ±‚å’Œå“åº”å‘¢ï¼Ÿ
ç”¨ä¸¤ä¸ªå¯¹è±¡ï¼šHttpServletRequestå’ŒHttpSerletResponse;
æœ¬è´¨ä¸Šå°±æ˜¯ httpè¯·æ±‚å’Œç›¸åº”æŠ¥æ–‡çš„åŒ…è£…ç±»ï¼›

![](./å›¾ç‰‡/springboot-6.png)

ğŸ“¦ è¯¦ç»†è§£é‡Šï¼š

ğŸ“¨ HttpServletRequestï¼šå°è£…å®¢æˆ·ç«¯è¯·æ±‚çš„æ‰€æœ‰ä¿¡æ¯
å®ƒå…¶å®å°±æ˜¯å¯¹ HTTP è¯·æ±‚æŠ¥æ–‡ çš„å°è£…ï¼Œé‡Œé¢åŒ…å«äº†ï¼š

+ è¯·æ±‚å¤´ï¼ˆHeadersï¼‰
+ è¯·æ±‚ä½“ï¼ˆBodyï¼‰
+ æ–¹æ³•ç±»å‹ï¼ˆGETã€POSTç­‰ï¼‰
+ è¯·æ±‚å‚æ•°ï¼ˆQueryå‚æ•°ã€Formè¡¨å•ï¼‰
+ å®¢æˆ·ç«¯ IPã€Cookies ç­‰

ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªç±»è®¿é—®ï¼š

```java
request.getMethod();           // è¯·æ±‚æ–¹æ³• GET/POST
request.getHeader("User-Agent");
request.getParameter("name");  // è·å–è¯·æ±‚å‚æ•°
request.getInputStream();      // åŸå§‹è¯·æ±‚ä½“ï¼ˆç”¨äºè¯»å– JSONï¼‰
```

ğŸ“¤ HttpServletResponseï¼šå°è£…æœåŠ¡ç«¯è¿”å›ç»™å®¢æˆ·ç«¯çš„å“åº”
è¿™ä¸ªç±»å¯¹åº”çš„æ˜¯æœåŠ¡å™¨è¿”å›çš„ HTTP å“åº”æŠ¥æ–‡ï¼Œä½ å¯ä»¥è®¾ç½®ï¼š

+ å“åº”çŠ¶æ€ç ï¼ˆ200ï¼Œ404ç­‰ï¼‰
+ å“åº”å¤´ï¼ˆContent-Type ç­‰ï¼‰
+ å“åº”ä½“å†…å®¹ï¼ˆæ–‡æœ¬ã€JSONã€æ–‡ä»¶ç­‰ï¼‰

```java
response.setStatus(200);
response.setHeader("Content-Type", "application/json");
response.getWriter().write("{\"msg\": \"Hello\"}");
```

âœ… åœ¨ Spring Boot ä¸­é€šå¸¸ä¸ç”¨ç›´æ¥æ“ä½œå®ƒä»¬
å› ä¸º Spring Boot å·²ç»å°è£…äº†å¾ˆå¤šåº•å±‚æ“ä½œï¼Œä½ é€šå¸¸åªéœ€è¦è¿™æ ·å†™å°±å¥½ï¼š

```java
@GetMapping("/hello")
public String hello() {
    return "Hello World"; // Spring Boot ä¼šè‡ªåŠ¨åŒ…è£…æˆ HTTP å“åº”
}
```

ä½†å¦‚æœä½ çœŸçš„éœ€è¦è®¿é—®åŸå§‹è¯·æ±‚æˆ–å“åº”ï¼Œå¯ä»¥è¿™æ ·æ³¨å…¥ï¼š

```java
@GetMapping("/info")
public void info(HttpServletRequest request, HttpServletResponse response) throws IOException {
    String userAgent = request.getHeader("User-Agent");
    response.setContentType("text/plain");
    response.getWriter().write("Your User-Agent is: " + userAgent);
}
```

### 4.1 è¯·æ±‚

#### 4.1.1 ç®€å•å‚æ•°

ç®€å•å‚æ•°ï¼šå‚æ•°åä¸å½¢å‚å˜é‡åç›¸åŒï¼Œå®šä¹‰å½¢å‚å³å¯æ¥å—å‚æ•°

![](./å›¾ç‰‡/springboot-7.png)

âœ… 1. @RequestParamï¼šè·å– URL æŸ¥è¯¢å‚æ•°ã€è¡¨å•å‚æ•°
ç”¨äºæ¥æ”¶ URL ä¸­çš„ ?name=xxx å½¢å¼çš„å‚æ•°ï¼š

æ³¨æ„ï¼š@RequestParamä¸­requiredå±æ€§é»˜è®¤trueï¼Œä»£è¡¨æ”¹è¯·æ±‚å‚æ•°å¿…é¡»ä¼ é€’ï¼Œå¦‚æœä¸ä¼ é€’å°†æŠ¥é”™ã€‚

å¦‚æœè¯¥å‚æ•°æ˜¯å¯é€‰çš„ï¼Œå¯ä»¥å°†requiredå±æ€§è®¾ç½®ä¸ºfalseï¼›

```java
@RequestMapping("/hello")
public String sayHello(@RequestParam String name, @RequestParam int age) {
    System.out.println("Hello " + name + " " + age);
    return "Hello " + name + " " + age;
}
```

##### @RequestMapping ç”¨æ³•

ğŸ§© åŸºæœ¬ç”¨æ³•
âœ… 1. è·å– GET è¯·æ±‚çš„æŸ¥è¯¢å‚æ•°
```java
@GetMapping("/hello")
public String hello(@RequestParam String name) {
    return "Hello, " + name;
}
```

è®¿é—®ï¼š`GET /hello?name=Tom`
è¿”å›ï¼š`Hello, Tom`

âœ… 2. è®¾ç½®å‚æ•°åï¼ˆå½“å˜é‡åå’Œå‚æ•°åä¸ä¸€è‡´æ—¶ï¼‰

```java
@GetMapping("/hello")
public String hello(@RequestParam("username") String name) {
    return "Hello, " + name;
}
```

è¯·æ±‚ URLï¼š`GET /hello?username=Alice`

âœ… 3. è®¾ç½®é»˜è®¤å€¼å’Œæ˜¯å¦å¿…å¡«

```java
@GetMapping("/greet")
public String greet(@RequestParam(required = false, defaultValue = "Guest") String name) {
    return "Hi, " + name;
}
```

è¯·æ±‚ /greet æˆ– /greet?name=Jack éƒ½å¯ä»¥ï¼š

+ æ²¡æœ‰ä¼ å‚æ•°æ—¶ï¼šHi, Guest
+ ä¼ äº†å‚æ•°ï¼šHi, Jack


âœ… 4. æ¥æ”¶å¤šä¸ªå‚æ•°
```java
@GetMapping("/sum")
public int sum(@RequestParam int a, @RequestParam int b) {
    return a + b;
}
```

âœ… 5. æ¥æ”¶æ•°ç»„æˆ–é›†åˆå‚æ•°
```java
@GetMapping("/ids")
public String ids(@RequestParam List<Integer> ids) {
    return "IDs: " + ids;
}
```

è¯·æ±‚ï¼š`GET /ids?ids=1&ids=2&ids=3`

ğŸ’¡ ä¸ POST è¡¨å•ç»“åˆä½¿ç”¨
```java
@PostMapping("/login")
public String login(@RequestParam String username, @RequestParam String password) {
    return "Username: " + username;
}
```

è¡¨å•æäº¤ï¼š
```java
Content-Type: application/x-www-form-urlencoded

username=Tom&password=123456
```

#### 4.1.2 å®ä½“å‚æ•°

è§„åˆ™ï¼šè¯·æ±‚å‚æ•°åä¸å½¢å‚å¯¹è±¡å±æ€§åç›¸åŒï¼Œå³å¯ç›´æ¥æ¥å—ï¼›

![](./å›¾ç‰‡/springboot-8.png)

åˆ›å»ºä¸€ä¸ª Java ç±»ï¼ˆPOJOï¼‰ï¼Œç”¨æ¥å°è£…å‰ç«¯ä¼ è¿‡æ¥çš„å¤šä¸ªå‚æ•°ï¼ŒSpring Boot ä¼šè‡ªåŠ¨æ ¹æ®å‚æ•°åè¿›è¡ŒåŒ¹é…å¹¶èµ‹å€¼ã€‚

âœ… ç”¨æ³•ç¤ºä¾‹

1. å®šä¹‰ä¸€ä¸ªå®ä½“ç±»
```java
package com.yzx.pojo;

public class User {
    private String name;
    private int age;
    private Address address;

    @Override
    public String toString() {
        return "User{" +
                "name='" + name + '\'' +
                ", age=" + age +
                ", address=" + address +
                '}';
    }

    public Address getAddress() {
        return address;
    }

    public void setAddress(Address address) {
        this.address = address;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }

}


package com.yzx.pojo;

public class Address {
    private String province;
    private String city;

    public String getProvince() {
        return province;
    }

    public void setProvince(String province) {
        this.province = province;
    }

    public String getCity() {
        return city;
    }

    public void setCity(String city) {
        this.city = city;
    }

    @Override
    public String toString() {
        return "Address{" +
                "province='" + province + '\'' +
                ", city='" + city + '\'' +
                '}';
    }
}

```

2. æ§åˆ¶å™¨ä¸­æ¥æ”¶å®ä½“å‚æ•°
```java
@RestController
public class UserController {

    @GetMapping("/user")
    public String getUser(User user) {
        return "username: " + user.getUsername() + ", age: " + user.getAge();
    }
}
```

è¯·æ±‚ URL ç¤ºä¾‹ï¼š[GET /user?username=Tom&age=22](http://localhost:8080/simplePojo?age=12&name=qwe&address.province=å•Š&address.city=æ˜¯)

Spring ä¼šæ ¹æ®å‚æ•°åè‡ªåŠ¨ç»™ User å®ä½“ç±»é‡Œçš„å­—æ®µèµ‹å€¼ã€‚

âœ… ç”¨äº POST è¡¨å•æäº¤

```java
@PostMapping("/user")
public String createUser(User user) {
    return "Created user: " + user.getUsername();
}
```

é€‚ç”¨äºè¡¨å•æ•°æ®ï¼ˆapplication/x-www-form-urlencodedï¼‰

âœ… ç”¨äº POST JSON æäº¤ï¼ˆé‡è¦â—ï¼‰

```java
@PostMapping("/json")
public String postJson(@RequestBody User user) {
    return "Received: " + user.getUsername();
}
```

æ³¨æ„ï¼š
+ è¿™ä¸ªæ—¶å€™è¦åŠ ä¸Š @RequestBody
+ å‰ç«¯è¦å‘é€ Content-Type: application/json çš„ JSON æ•°æ®

ç¤ºä¾‹ JSON è¯·æ±‚ä½“ï¼š
```java
{
  "username": "Alice",
  "age": 25
}
```

#### 4.1.3 æ•°ç»„é›†åˆå‚æ•°

è¯·æ±‚ï¼š

![](./å›¾ç‰‡/springboot-9.png)

âœ… ä¸€ã€æ¥æ”¶æ•°ç»„æˆ–é›†åˆå‚æ•°ï¼š@RequestParam æ¥æ”¶æŸ¥è¯¢å‚æ•°

ğŸŒŸ ç¤ºä¾‹è¯·æ±‚ï¼šhttp://localhost:8080/test?ids=1&ids=2&ids=3

```java
@GetMapping("/test")
public String testArray(@RequestParam List<Integer> ids) {
    return "æ¥æ”¶åˆ°çš„ ids: " + ids;
}
```

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ Integer[] æ•°ç»„ç±»å‹æ¥æ”¶ï¼š
```java
@GetMapping("/test")
public String testArray(@RequestParam Integer[] ids) {
    return "æ¥æ”¶åˆ°çš„ ids: " + Arrays.toString(ids);
}
```

#### 4.1.4 æ—¥æœŸå‚æ•°

âœ… ä½¿ç”¨ @DateTimeFormat

å¦‚æœä½ æƒ³æ¥æ”¶æ ¼å¼ä¸º yyyy-MM-dd HH:mm:ss çš„æ—¶é—´ï¼Œå¯ä»¥ç”¨è¿™ä¸ªæ³¨è§£ï¼š

```java
import org.springframework.format.annotation.DateTimeFormat;

@GetMapping("/date")
public String getDate(@RequestParam("time")
                      @DateTimeFormat(pattern = "yyyy-MM-dd HH:mm:ss") Date time) {
    return "æ”¶åˆ°çš„æ—¥æœŸæ˜¯: " + time;
}
```

ğŸ” è¯·æ±‚ç¤ºä¾‹ï¼š

```java
http://localhost:8080/date?time=2024-04-21%2012:34:56
```
æ³¨æ„ç©ºæ ¼éœ€è¦ç¼–ç æˆ %20ã€‚


âœ… æ–¹å¼ 2ï¼šä½¿ç”¨ LocalDateã€LocalDateTimeï¼ˆæ¨èï¼‰

```java
@GetMapping("/date2")
public String getDate(@RequestParam("time")
                      @DateTimeFormat(pattern = "yyyy-MM-dd HH:mm:ss") LocalDateTime time) {
    return "æ”¶åˆ°çš„æ—¶é—´æ˜¯: " + time;
}

```

å¯¹åº” URLï¼š
http://localhost:8080/date2?time=2024-04-21%2014:23:00


#### 4.1.5 è·¯å¾„å‚æ•°æ˜¯JSON



âœ… POST JSON åœºæ™¯ï¼ˆ@RequestBodyï¼‰

å¦‚æœä½ ç”¨çš„æ˜¯ @RequestBody æ¥æ”¶ JSONï¼Œé‚£æ ¼å¼æ§åˆ¶åº”è¯¥äº¤ç»™ Jacksonï¼ˆSpring Boot é»˜è®¤çš„ JSON åºåˆ—åŒ–åº“ï¼‰ã€‚


![](./å›¾ç‰‡/springboot-10.png)
![](./å›¾ç‰‡/springboot-11.png)


```java
@RequestMapping("/jsonParam")
public String jsonParam(@RequestBody User user) {
    return user.toString();
}
```

#### 4.1.6 è·¯å¾„å‚æ•°

![](./å›¾ç‰‡/springboot-12.png)

```java
@RequestMapping("/path/{id}/{name}")
public String path(@PathVariable String id, @PathVariable String name) {
    return id+":"+name;
}
```

#### 4.1.7 æ€»ç»“

å‚æ•°ä½ç½® | æ”¯æŒçš„æ–¹æ³• | åç«¯æ¥æ”¶æ–¹å¼
---|---|---
URLè·¯å¾„å‚æ•° | GET/POST/PUT/DELETE | @PathVariable
æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•° | GETï¼ˆä¹Ÿå¯POSTç­‰ï¼‰ | @RequestParam
è¡¨å•ä½“ï¼ˆé”®å€¼å¯¹ï¼‰ | POST | @RequestParam
è¯·æ±‚ä½“ï¼ˆJSONï¼‰ | POST/PUT/DELETE | @RequestBody
æ–‡ä»¶ä¸Šä¼ å‚æ•° | POSTï¼ˆmultipartï¼‰ | @RequestParam + MultipartFile

âœ… 1. URLè·¯å¾„å‚æ•°ï¼ˆPath Variableï¼‰

```sql
GET /user/123
```

+ 123 æ˜¯ userId
+ åç«¯ç”¨ @PathVariable æ¥æ”¶

```java
@GetMapping("/user/{id}")
public String getUser(@PathVariable("id") Long id) {
    // ...
}
```

âœ… 2. æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°ï¼ˆQuery Parameterï¼‰

å¸¸ç”¨äº GET è¯·æ±‚ï¼Œä¹Ÿå¯ä»¥ç”¨äº POSTï¼š

```sql
GET /user/list?page=1&pageSize=10
```

+ å‰ç«¯ä¼ åœ¨ URL çš„ ? åé¢
+ åç«¯ç”¨ @RequestParam æ¥æ”¶ï¼š

```java
@GetMapping("/user/list")
public List<User> list(@RequestParam("page") int page,
                       @RequestParam("pageSize") int size) {
    // ...
}
```

âœ… 3. è¯·æ±‚ä½“å‚æ•°ï¼ˆRequest Bodyï¼‰

ç”¨äº POSTã€PUTã€DELETE ç­‰è¯·æ±‚æ–¹å¼ï¼š

ğŸ”¸ è¡¨å•æ–¹å¼ï¼ˆapplication/x-www-form-urlencodedï¼‰

è¡¨å•é”®å€¼å¯¹æ ¼å¼ï¼š

```html
<form method="post" action="/add">
    <input name="username">
    <input name="age">
</form>
```

åç«¯ç”¨ @RequestParam æ¥æ”¶ï¼š

```java
@PostMapping("/add")
public String add(@RequestParam("username") String name) { ... }
```

ğŸ”¸ JSONæ ¼å¼ï¼ˆapplication/jsonï¼‰

é€‚åˆå¤æ‚å¯¹è±¡ä¼ é€’ï¼š

```json
POST /add
Content-Type: application/json

{
  "username": "Tom",
  "age": 20
}
```

åç«¯ç”¨ @RequestBody æ¥æ”¶ï¼š

```java
@PostMapping("/add")
public String add(@RequestBody User user) { ... }
```

âœ… 4. ä¸Šä¼ æ–‡ä»¶ï¼ˆmultipart/form-dataï¼‰

æ–‡ä»¶ + è¡¨å•ä¸€èµ·ä¼ ï¼š

```html
<form enctype="multipart/form-data">
    <input type="text" name="username">
    <input type="file" name="avatar">
</form>

```

åç«¯ï¼š

```java
@PostMapping("/upload")
public String upload(@RequestParam("username") String name,
                     @RequestParam("avatar") MultipartFile file) { ... }
```



### 4.2 è®¾ç½®ç›¸åº”æ•°æ®

![](./å›¾ç‰‡/springboot-13.png)


```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Controller
@ResponseBody
public @interface RestController {
}
```

ğŸ§© ä¸€ã€æœ€åŸºæœ¬çš„è¿”å›ï¼šå­—ç¬¦ä¸²

```java
@RestController
public class HelloController {
    @GetMapping("/hello")
    public String sayHello() {
        return "Hello Spring Boot!";
    }
}
```

é»˜è®¤è¿”å›çš„æ˜¯å­—ç¬¦ä¸²ï¼Œå“åº”ç±»å‹æ˜¯ï¼štext/plain

ğŸ§© äºŒã€è¿”å›å¯¹è±¡ï¼ˆè‡ªåŠ¨è½¬ JSONï¼‰
```java
@RestController
public class UserController {
    @GetMapping("/user")
    public User getUser() {
        return new User(1, "Tom");
    }
}
```
```java
public class User {
    private int id;
    private String name;

    // æ„é€ å™¨ã€getterã€setter çœç•¥
}
```
âœ… å“åº”ç»“æœï¼ˆè‡ªåŠ¨è½¬ JSONï¼‰ï¼š
```java
{
  "id": 1,
  "name": "Tom"
}
```

è¿™å¾—ç›Šäº Spring Boot é»˜è®¤é›†æˆçš„ Jacksonï¼ˆå¯¹è±¡ <-> JSON è‡ªåŠ¨è½¬æ¢ï¼‰

ğŸ§© ä¸‰ã€è¿”å›é›†åˆ
```java
@GetMapping("/list")
public List<User> getUserList() {
    return Arrays.asList(
        new User(1, "Tom"),
        new User(2, "Jerry")
    );
}
```

âœ… å“åº” JSONï¼š
```java
[
  {"id":1,"name":"Tom"},
  {"id":2,"name":"Jerry"}
]
```

ğŸ§© å››ã€è‡ªå®šä¹‰å“åº”æ ¼å¼ï¼ˆç»Ÿä¸€è¿”å›ç»“æ„ï¼‰

å¾ˆå¤šé¡¹ç›®ä¸­ä¼šç»Ÿä¸€å°è£…å“åº”ï¼Œæ¯”å¦‚ï¼š

```java
public class Result<T> {
    private int code;
    private String message;
    private T data;

    public static <T> Result<T> success(T data) {
        return new Result<>(200, "success", data);
    }

    public static <T> Result<T> error(String message) {
        return new Result<>(500, message, null);
    }

    // æ„é€ å™¨ / getter / setter
}

```

Controller ä½¿ç”¨ï¼š
```java
@GetMapping("/info")
public Result<User> getInfo() {
    return Result.success(new User(1, "Tom"));
}
```
âœ… å“åº”ï¼š
```java
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "name": "Tom"
  }
}
```

### 4.3 demo

```java
@RestController
public class EmpController {

    @RequestMapping("/listEmp")
    public Result list(){
        // åŠ è½½å¹¶è§£æ.xml
        String file = this.getClass().getClassLoader().getResource("emp.xml").getFile();
        System.out.println(file);
        List<Emp> empList = XmlParserUtils.parse(file, Emp.class);
        // æ•°æ®è½¬åŒ–å¤„ç†
        empList.stream().forEach(emp -> {
            String gender = emp.getGender();
            if("1".equals(gender)){
                emp.setGender("M");
            }else if("2".equals(gender)){
                emp.setGender("F");
            }

            String job = emp.getJob();
            if("1".equals(job)){
                emp.setJob("è®²å¸ˆ");
            }else if("2".equals(job)){
                emp.setJob("ç­ä¸»ä»»");
            }else if("3".equals(job)){
                emp.setJob("å°±ä¸šæŒ‡å¯¼");
            }
        });

        return Result.success(empList);
    }
}
```


åœ¨ Spring Boot ä¸­æ˜¯å¯ä»¥æ­£ç¡®æ‹¿åˆ° resources ç›®å½•ä¸‹çš„ emp.xml æ–‡ä»¶çš„è·¯å¾„çš„ï¼š
```java
String file = this.getClass().getClassLoader().getResource("emp.xml").getFile();
```

1ï¸âƒ£ this.getClass()
è·å–å½“å‰å¯¹è±¡çš„ Class å¯¹è±¡ï¼Œæ¯”å¦‚ com.example.MyClassã€‚
2ï¸âƒ£ getClassLoader()
è·å–è¿™ä¸ªç±»çš„ ç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰ã€‚åœ¨å¤§å¤šæ•° Java ç¨‹åºä¸­ï¼Œè¿™è¿”å›çš„æ˜¯ AppClassLoaderï¼Œå®ƒä¸“é—¨ç”¨æ¥åŠ è½½ä½ é¡¹ç›®çš„ .class æ–‡ä»¶å’Œ resources èµ„æºæ–‡ä»¶ã€‚
3ï¸âƒ£ getResource("emp.xml")
è¿™ä¸ªæ–¹æ³•ä¼šåœ¨ ç±»è·¯å¾„ï¼ˆclasspathï¼‰ ä¸­æŸ¥æ‰¾ä½ ä¼ å…¥çš„èµ„æºï¼š

src/main/resources/emp.xml ä¼šåœ¨ç¼–è¯‘åå˜æˆï¼š
```java
target/classes/emp.xml
```
æ‰€ä»¥ getResource("emp.xml") å°±èƒ½æ‰¾åˆ°å®ƒã€‚è¿”å›çš„æ˜¯ä¸€ä¸ª URL å¯¹è±¡ã€‚

ä¾‹å¦‚ï¼š
```java
file:/D:/workspace/your_project/target/classes/emp.xml
```
4ï¸âƒ£ getFile()
ä» URL ä¸­è·å–æ–‡ä»¶è·¯å¾„å­—ç¬¦ä¸²ï¼Œå°±æ˜¯ï¼š

```java
"D:/workspace/your_project/target/classes/emp.xml"
```
ä½ å°±å¯ä»¥æ‹¿è¿™ä¸ªè·¯å¾„å»åš FileReaderã€new File(path) ä¹‹ç±»çš„æ“ä½œäº†ã€‚


âœ… ä¸€ã€å‰ææ¡ä»¶
ä½ å¿…é¡»ç¡®ä¿æ–‡ä»¶è·¯å¾„æ˜¯è¿™æ ·ï¼š
```java
src
 â””â”€â”€ main
     â””â”€â”€ resources
         â””â”€â”€ emp.xml
```
è¿™ä¸ªè·¯å¾„ä¸‹çš„æ–‡ä»¶ï¼Œåœ¨æ„å»ºæ—¶ä¼šè¢«è‡ªåŠ¨æ‰“åŒ…åˆ° target/classes ç›®å½•ä¸­ï¼Œä¹Ÿå°±æ˜¯ç±»è·¯å¾„çš„ä¸€éƒ¨åˆ†ï¼ˆClasspathï¼‰ã€‚

âœ… äºŒã€æ¨èæ–¹å¼ï¼šè·å– URLã€InputStreamã€Path
âœ”ï¸ 1. è·å–æ–‡ä»¶è·¯å¾„ï¼ˆä½ çš„æ–¹å¼ï¼‰

```java
String path = this.getClass().getClassLoader().getResource("emp.xml").getFile();
System.out.println(path);
```

âœ”ï¸ 2. è·å– URLï¼ˆæ›´é€šç”¨ï¼‰
```java
URL url = this.getClass().getClassLoader().getResource("emp.xml");
```

âœ”ï¸ 3. è·å– InputStreamï¼ˆæœ€å¸¸ç”¨ï¼Œç”¨äºè¯»é…ç½®æ–‡ä»¶ï¼‰
```java
InputStream in = this.getClass().getClassLoader().getResourceAsStream("emp.xml");
```

âœ”ï¸ 4. ä½¿ç”¨ Resourceï¼ˆSpring æä¾›ï¼Œæ”¯æŒå¤šç§èµ„æºï¼‰
```java
@Resource
private ResourceLoader resourceLoader;

public void readFile() throws IOException {
    Resource resource = resourceLoader.getResource("classpath:emp.xml");
    InputStream in = resource.getInputStream();
}
```

æˆ–ä½¿ç”¨é™æ€æ³¨å…¥ï¼š
```java
Resource resource = new ClassPathResource("emp.xml");
InputStream in = resource.getInputStream();
```

### 4.4 åˆ†å±‚è§£è€¦

#### 4.4.1 ä¸‰å±‚æ¶æ„

![](./å›¾ç‰‡/springboot-14.png)

![](./å›¾ç‰‡/springboot-15.png)


+ controller : æ§åˆ¶å±‚ï¼Œæ¥å—å‰ç«¯å‘é€çš„è¯·æ±‚ï¼Œå¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œå¹¶ç›¸åº”æ•°æ®
+ service : ä¸šåŠ¡é€»è¾‘å±‚ï¼Œå¤„ç†å…·ä½“çš„ä¸šåŠ¡é€»è¾‘
+ dao : æ•°æ®è®¿é—®å±‚ï¼ˆData Access Objectï¼‰ï¼Œè´Ÿè´£æ•°æ®è®¿é—®æ“ä½œï¼ŒåŒ…æ‹¬æ•°æ®çš„å¢åˆ æ”¹æŸ¥ï¼›

demo ä»£ç æ‹†åˆ†ï¼š
![](./å›¾ç‰‡/springboot-16.png)

![](./å›¾ç‰‡/springboot-17.png)

#### 4.4.2 åˆ†å±‚è§£è€¦ IOC & DI

![](./å›¾ç‰‡/springboot-18.png)

ä¸Šè¿°ä»£ç ï¼Œé€šè¿‡åˆ›å»ºå¯¹è±¡æ¥å»ºç«‹æ¯å±‚ä¹‹é—´çš„å…³ç³»ã€‚æ‰€ä»¥è€¦åˆæ€§è¾ƒå¼ºï¼›
é€šè¿‡æ§åˆ¶åè½¬å’Œä¾èµ–æ³¨å…¥æ¥è§£è€¦ï¼›

![](./å›¾ç‰‡/springboot-19.png)

**IOC & DI çš„å®ç°é€šè¿‡åŠ ä¸Š@Componetå’Œ@Autowiredå®ç°ï¼›**

![](./å›¾ç‰‡/springboot-20.png)

æ‰€ä»¥è¯´å¦‚æœæƒ³ä½¿ç”¨ EmpServiceB è¿™ä¸ªæœåŠ¡ï¼Œåªéœ€åœ¨ç±»ä¸ŠåŠ ä¸Š @Componentï¼Œç„¶åå†æŠŠ EmpServiceA ä¸Šçš„ @Component å»æ‰ï¼Œå°±è¡Œäº†ï¼›

> IOC 

Componentçš„è¡ç”Ÿï¼š

![](./å›¾ç‰‡/springboot-21.png)

> Bean ç»„ä»¶æ‰«æ

![](./å›¾ç‰‡/springboot-22.png)


> DI

![](./å›¾ç‰‡/springboot-23.png)

![](./å›¾ç‰‡/springboot-24.png)

## 5. Mysql

è¿œç¨‹è¿æ¥ï¼š

mysql -uç”¨æˆ·å -på¯†ç  -h ipåœ°å€ -P ç«¯å£å·

[mysqlçš„ä½¿ç”¨](../Mysql/ä½¿ç”¨/1.åŸºç¡€.md)

+ Ideaä¸­æ“ä½œæ•°æ®åº“è®¾ç½®åˆ—çš„ä¸»é”®ã€å”¯ä¸€ã€éç©ºã€é€’å¢ç­‰å±æ€§

![](./å›¾ç‰‡/idea-table.png)

æ³¨æ„è¦åŠ ä¸ŠåŸºç¡€å­—æ®µï¼šid,create_time,update_time;

ctrl+alt+l è¿›è¡Œæ ¼å¼åŒ–ï¼›


å¤šè¡¨ï¼šä¸€å¯¹å¤š
+ å®ç°ï¼šåœ¨æ•°æ®è¡¨ä¸­å¤šçš„ä¸€æ–¹ï¼Œæ·»åŠ å­—æ®µï¼Œæ¥å…³è”ä¸€çš„ä¸€æ–¹çš„ä¸»é”®ï¼›

![](./å›¾ç‰‡/mysql_ä¸€å¯¹å¤š.png)

å¤šè¡¨ï¼šä¸€å¯¹ä¸€
+ ä¸€å¯¹ä¸€å…³ç³»ï¼Œå¤šç”¨äºå•è¡¨æ‹†åˆ†ï¼Œå°†ä¸€å¼ è¡¨çš„åŸºç¡€å­—æ®µæ”¾åœ¨ä¸€å¼ è¡¨ä¸­ï¼Œå…¶ä»–å­—æ®µæ”¾åœ¨å¦ä¸€å¼ è¡¨ä¸­ï¼Œä»¥æé«˜æ“ä½œæ•ˆç‡ï¼›
+ å®ç°ï¼šåœ¨ä»»æ„ä¸€æ–¹åŠ å…¥å¤–é”®ï¼Œå…³è”å¦å¤–ä¸€æ–¹çš„ä¸»é”®ï¼Œå¹¶ä¸”è®¾ç½®å¤–é”®ä¸ºå”¯ä¸€çš„ï¼›å¯ä»¥çœ‹æˆä¸€å¯¹å¤šçš„ç‰¹æ®Šå½¢å¼ï¼›

å¤šè¡¨ï¼šå¤šå¯¹å¤š
+ å®ç°ï¼šå»ºç«‹ç¬¬ä¸‰å¼ ä¸­é—´è¡¨ï¼Œä¸­é—´è¡¨è‡³å°‘åŒ…å«ä¸¤ä¸ªå¤–é”®ï¼Œåˆ†åˆ«å…³è”ä¸¤æ–¹ä¸»é”®ï¼›


å¤šè¡¨è®¾è®¡æµç¨‹
+ é˜…è¯»é¡µé¢åŸå‹åŠéœ€æ±‚æ–‡æ¡£ï¼Œåˆ†æå„ä¸ªæ¨¡å—æ¶‰åŠåˆ°çš„è¡¨ç»“æ„ï¼ŒåŠè¡¨ç»“æ„ä¹‹é—´çš„å…³ç³»
+ æ ¹æ®é¡µé¢åŸå‹åŠéœ€æ±‚æ–‡æ¡£ï¼Œåˆ†æå„ä¸ªè¡¨ç»“æ„ä¸­å…·ä½“çš„å­—æ®µåŠçº¦æŸã€‚

![](./å›¾ç‰‡/mysql-è‹ç©¹å¤–å–è¡¨ç»“æ„.png)

## 6. Mybatis

https://mybatis.net.cn/

1. å‡†å¤‡å·¥ä½œ(åˆ›å»ºspringbootå·¥ç¨‹ã€æ•°æ®åº“è¡¨userã€å®ä½“ç±»User)

å®ä½“ç±»çš„æˆå‘˜å˜é‡å’Œæ•°æ®åº“è¡¨ä¸€ä¸€å¯¹åº”ï¼›

![](./å›¾ç‰‡/springboot-mybits.png)

2. å¼•å…¥Mybatisçš„ç›¸å…³ä¾èµ–ï¼Œé…ç½®Mybatis(æ•°æ®åº“è¿æ¥ä¿¡æ¯)

![](./å›¾ç‰‡/springboot-mybits2.png)

3. ç¼–å†™SQLè¯­å¥(æ³¨è§£/XML)

```java
@Mapper
public interface UserMapper {    
    @Select("select *  from user")  
    public List<User> list();
    }
```

è¿™é‡Œä¸éœ€è¦å†™å®ç°ç±»ï¼Œspringä¼šè‡ªåŠ¨å®ç°ï¼›è¿™é‡Œé‡‡ç”¨çš„æ˜¯æ³¨å…¥ä¾èµ–ï¼Œæ‰€ä»¥åé¢ç›´æ¥å®šä¹‰å°±è¡Œï¼›

3. å•å…ƒæµ‹è¯•

```java
@SpringBootTest class SpringbootMybatisQuickstart1ApplicationTests {            
    @Autowired    
    private UserMapper userMapper;
    @Test    
    public void test1(){       
        List<User> userList = userMapper.list();        userList.stream().forEach(user -> {
            System.out.println(user);        
        });    
    }
}
```

### 6.1 LOMBOK

![](./å›¾ç‰‡/springboot-lombok.png)

### 6.2 Mybits åˆ é™¤

ç”¨ '#{}' æ¥æ¥å—å‚æ•°ï¼›

```java
    @Delete("delete from tb_emp where id = #{id}")
    public int deleteByPrimaryKey(Integer id);
```

å¼€å¯æ—¥å¿—ï¼š

![](./å›¾ç‰‡/springboot-mybitslog.png)

### 6.3 Mybits æ–°å¢

è¿™é‡Œçš„ @Options(useGeneratedKeys = true, keyProperty = "id") æ˜¯ä¸»é”®è¿”å›ï¼Œä¿å­˜åœ¨ id ä¸­ï¼›

```java
    @Options(useGeneratedKeys = true, keyProperty = "id")
    @Insert("insert into tb_emp(username, name, gender, image, job, entrydate, dept_id, create_time, update_time)" +
            " values (#{username},#{name},#{gender},#{image},#{job},#{entrydate},#{deptId},#{createTime},#{updateTime})")
    public void insert(Emp emp);

```

### 6.4 Mybits æ›´æ–°

```java
    //æ›´æ–°å‘˜å·¥
    @Update("update emp set username = #{username}, name = #{name}, gender = #{gender}, image = #{image}," +
            " job = #{job}, entrydate = #{entrydate}, dept_id = #{deptId},update_time = #{updateTime} where id = #{id}")
    public void update(Emp emp);
```

### 6.4 Mybits æŸ¥è¯¢

```java
    @Select("select * from emp where id = #{id}")
    public Emp getById(Integer id);
```

æ•°æ®å°è£…ï¼š

+ å®ä½“ç±»å±æ€§å å’Œ æ•°æ®åº“è¡¨æŸ¥è¯¢è¿”å›çš„å­—æ®µåä¸€è‡´ï¼Œmybatisä¼šè‡ªåŠ¨å°è£…ã€‚

+ å¦‚æœå®ä½“ç±»å±æ€§å å’Œ æ•°æ®åº“è¡¨æŸ¥è¯¢è¿”å›çš„å­—æ®µåä¸ä¸€è‡´ï¼Œä¸èƒ½è‡ªåŠ¨å°è£…ã€‚

è§£å†³æ–¹æ³•ï¼š

+ 1.èµ·åˆ«åï¼šåœ¨SQLè¯­å¥ä¸­ï¼Œå¯¹ä¸ä¸€æ ·çš„åˆ—åèµ·åˆ«åï¼Œåˆ«åå’Œå®ä½“ç±»å±æ€§åä¸€æ ·

```java
@Select("select id, username, password, name, gender, image, job, entrydate, dept_id deptId, create_time createTime, update_time updateTime from emp where id = #{id} ")
public Emp getById(Integer id);
```

+ 2.æ‰‹åŠ¨ç»“æœæ˜ å°„ï¼šé€šè¿‡ @ResultsåŠ@Result è¿›è¡Œæ‰‹åŠ¨ç»“æœæ˜ å°„ã€‚

```java
    @Results({
            @Result(column = "dept_id", property = "deptId"),
            @Result(column = "create_time", property = "createTime"),
            @Result(column = "update_time", property = "updateTime")
    })
    @Select("select * from emp where id = #{id}")
    public Emp getById(Integer id);
```

+ 3.å¼€å¯é©¼å³°å‘½å(æ¨è)ï¼šå¦‚æœå­—æ®µåä¸å±æ€§åç¬¦åˆé©¼å³°å‘½åè§„åˆ™ï¼Œmybatisä¼šè‡ªåŠ¨é€šè¿‡é©¼å³°å‘½åè§„åˆ™æ˜ å°„ã€‚

```bash
#å¼€å¯é©¼å³°å‘½åè‡ªåŠ¨æ˜ å°„ï¼Œå³ä»æ•°æ®åº“å­—æ®µå a_column æ˜ å°„åˆ°Java å±æ€§å aColumnã€‚
mybatis.configuration.map-underscore-to-camel-case=true
```

> æ¡ä»¶æŸ¥è¯¢

å…³äº `like '%å¼ %'`,ä¸èƒ½ç›´æ¥ä½¿ç”¨ like '%#{name}%' -> '%?%' è¿™é‡Œï¼Ÿæ˜¯ä¸èƒ½å‡ºç°åœ¨å­—ç¬¦ä¸²ä¸­ï¼Œæ‰€ä»¥é”™è¯¯ï¼›

æ–¹æ³•ä¸€ ä½¿ç”¨ $ è¿›è¡Œæ‹¼æ¥ï¼Œä¸ä¼šç”Ÿæˆé¢„ç¼–è¯‘ SQL
```java
    //æ¡ä»¶æŸ¥è¯¢å‘˜å·¥
    //æ–¹å¼ä¸€
    @Select("select * from emp where name like '%${name}%' and gender = #{gender} and " + "entrydate between #{begin} and #{end} order by update_time desc ")
    /public List<Emp> list(String name, Short gender, LocalDate begin , LocalDate end);
```

ä¸Šé¢ä½¿ç”¨ $ è¿›è¡Œæ‹¼æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ æ€§èƒ½ä½ã€ä¸å®‰å…¨ã€å­˜åœ¨SQLæ³¨å…¥é—®é¢˜;


è§£å†³æ–¹æ³•ï¼šä½¿ç”¨ concat å‡½æ•°è¿›è¡Œæ‹¼æ¥ï¼Œè¿™æ ·ç»§ç»­ä½¿ç”¨ #,ä½¿ç”¨é¢„ç¼–è¯‘SQL;

```java
    //æ–¹å¼äºŒ
@Select("select * from emp where name like concat('%',#{name},'%') and gender = #{gender} and " +
"entrydate between #{begin} and #{end} order by update_time desc ")
public List<Emp> list(String name, Short gender, LocalDate begin , LocalDate end);

```

### 6.5. XMLæ˜ å°„æ–‡ä»¶

#### 6.5.1 ä»€ä¹ˆæ˜¯ XML

XMLï¼ˆeXtensible Markup Languageï¼‰ æ˜¯ä¸€ç§ å¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼Œç”¨æ¥å­˜å‚¨ã€ä¼ è¾“ã€ç»„ç»‡ç»“æ„åŒ–æ•°æ®ã€‚

ç®€å•è¯´ï¼ŒXMLå°±æ˜¯ä¸€ç§æ ¼å¼ï¼Œé•¿å¾—å¾ˆåƒ HTMLï¼Œä½†å®ƒä¸è§„å®šæ ‡ç­¾ï¼Œä½ å¯ä»¥è‡ªå·±å®šä¹‰ï¼

ä¾‹å¦‚ï¼š

```xml
<user>
  <id>1</id>
  <name>Tom</name>
  <age>18</age>
</user>
```

å°±æ˜¯æè¿°äº†ä¸€ä¸ªç”¨æˆ·çš„ä¿¡æ¯ã€‚

XML æœ¬èº«åªæ˜¯ç”¨æ¥æè¿°æ•°æ®ï¼Œä¸ä¼šæ‰§è¡Œé€»è¾‘ï¼


âœ… é‚£æ€ä¹ˆåˆ©ç”¨ XML æ¥å®ç° SQL æŸ¥è¯¢ï¼Ÿ

â¡ï¸ æŠŠ SQL è¯­å¥å†™åœ¨ XML æ–‡ä»¶é‡Œï¼Œç”± MyBatis è¯»å–å¹¶æ‰§è¡Œï¼

âœ… MyBatis é‡Œ XML ç»„ç»‡ SQL æŸ¥è¯¢çš„æ–¹å¼

ä¸€èˆ¬æ¥è¯´ï¼Œæ­¥éª¤æ˜¯è¿™æ ·çš„ï¼š

æ­¥éª¤ | è¯´æ˜
---|---
1 | å®šä¹‰ä¸€ä¸ª Mapper æ¥å£ï¼ˆJavaçš„æ¥å£ï¼Œå£°æ˜æ–¹æ³•ï¼‰
2 | å†™ä¸€ä¸ª XML æ–‡ä»¶ï¼ˆåŒå Mapper.xmlï¼‰ï¼Œé‡Œé¢ç”¨ XML æ ¼å¼å†™ SQL è¯­å¥
3 | é…ç½®å¥½ MyBatis è®©å®ƒè‡ªåŠ¨åŠ è½½è¿™äº› XML
4 | è°ƒç”¨æ¥å£æ–¹æ³•ï¼ŒMyBatis å» XML æ‰¾ SQL æ‰§è¡Œ


ğŸ“Œ æ³¨æ„äº‹é¡¹

+ XMLæ˜ å°„æ–‡ä»¶çš„åç§°ä¸Mapperæ¥å£åç§°ä¸€è‡´ï¼Œå¹¶ä¸”å°†XMLæ˜ å°„æ–‡ä»¶å’ŒMapperæ¥å£æ”¾ç½®åœ¨ç›¸åŒåŒ…ä¸‹ï¼ˆåŒåŒ…åŒåï¼‰ã€‚

+ XMLæ˜ å°„æ–‡ä»¶çš„namespaceå±æ€§ä¸ºMapperæ¥å£å…¨é™å®šåä¸€è‡´ã€‚

+ XMLæ˜ å°„æ–‡ä»¶ä¸­sqlè¯­å¥çš„idä¸Mapper æ¥å£ä¸­çš„æ–¹æ³•åä¸€è‡´ï¼Œå¹¶ä¿æŒè¿”å›ç±»å‹ä¸€è‡´ã€‚

![](./å›¾ç‰‡/springboot-xml1.png)

1. å®šä¹‰ Java æ¥å£ UserMapper

```java 
public interface UserMapper {
    User selectById(Integer id);
}
```

2. åˆ›å»ºå¯¹åº” XML UserMapper.xml

```xml
<mapper namespace="com.example.mapper.UserMapper">

    <select id="selectById" resultType="com.example.model.User">
        SELECT id, name, age
        FROM user
        WHERE id = #{id}
    </select>

</mapper>
```

+ < mapper>ï¼šè¡¨æ˜è¿™æ˜¯ä¸€ä¸ªæ˜ å°„å™¨
+ namespaceï¼šè¦è·Ÿæ¥å£çš„å®Œæ•´åŒ…åä¸€è‡´
+ < select>ï¼šè¡¨ç¤ºè¿™æ˜¯ä¸ªæŸ¥è¯¢è¯­å¥
+ id="selectById"ï¼šå¯¹åº”æ¥å£çš„æ–¹æ³•å
+ #{id}ï¼šå ä½ç¬¦ï¼ŒMyBatisè‡ªåŠ¨æŠŠæ–¹æ³•å‚æ•°å¡«è¿›æ¥
+ resultTypeï¼šæŸ¥è¯¢ç»“æœæ˜ å°„æˆå“ªä¸ª Java ç±»

æ›´æ–°

```java
<update id="updateUserName" parameterType="com.example.model.User">
    update user
    set name = #{name}
    where id = #{id}
</update>
```

### 6.6 åŠ¨æ€ SQL

éšç€ç”¨æˆ·çš„è¾“å…¥æˆ–å¤–éƒ¨æ¡ä»¶çš„å˜åŒ–è€Œå˜åŒ–çš„SQLè¯­å¥ï¼Œæˆ‘ä»¬ç§°ä¸º åŠ¨æ€SQLã€‚

+ <if>
+ <foreach>
+ <sql><include>

#### 6.6.1 <if>

+ < if >ï¼šç”¨äºåˆ¤æ–­æ¡ä»¶æ˜¯å¦æˆç«‹ã€‚ä½¿ç”¨testå±æ€§è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œå¦‚æœæ¡ä»¶ä¸ºtrueï¼Œåˆ™æ‹¼æ¥SQLã€‚

+ < where >ï¼šwhereÂ å…ƒç´ åªä¼šåœ¨å­å…ƒç´ æœ‰å†…å®¹çš„æƒ…å†µä¸‹æ‰æ’å…¥whereå­å¥ã€‚è€Œä¸”ä¼šè‡ªåŠ¨å»é™¤å­å¥çš„å¼€å¤´çš„AND æˆ–OR

```xml
    <select id="list" resultType="com.yzx.pojo.Emp">
        select * from tb_emp
        <where>
            <if test="name != null">
                name like concat('%', #{name}, '%')
            </if>
            <if test="gender != null">
                and gender = #{gender}
            </if>
            <if test="begin != null and end != null">
                and entrydate between #{begin} and #{end}
            </if>
        </where>
        order by update_time desc
    </select>
```

+ <set>ï¼šåŠ¨æ€åœ°åœ¨è¡Œé¦–æ’å…¥ SET å…³é”®å­—ï¼Œå¹¶ä¼šåˆ æ‰é¢å¤–çš„é€—å·ã€‚ï¼ˆç”¨åœ¨updateè¯­å¥ä¸­ï¼‰

```xml
    <update id="update2">
        update tb_emp
        <set>
            <if test="username != null">
                username = #{username},
            </if>
    
            <if test="name != null">
                name = #{name},
            </if>
    
            <if test="gender != null">
                gender = #{gender},
            </if>
    
            <if test="image != null">
                image = #{image},
            </if>
            <if test="job != null">
                job = #{job},
            </if>
            <if test="entrydate != null">
                entrydate = #{entrydate},
            </if>
            <if test="deptId!= null">
                dept_id = #{deptId},
            </if>
            <if test="updateTime != null">
                update_time = #{updateTime}
            </if>
        </set>
        where id = #{id}

    </update>
```

#### 6.6.2 <foreach>

âœ… foreach æ˜¯å¹²å˜›çš„ï¼Ÿ

åœ¨ MyBatis çš„ SQL ä¸­ï¼Œå¦‚æœä½ æœ‰ä¸€ç»„æ•°æ®è¦ç”¨ï¼Œæ¯”å¦‚ï¼š

+ æ‰¹é‡æ’å…¥
+ WHERE id IN (...) å¤šæ¡ä»¶æŸ¥è¯¢
+ æ›´æ–°å¤šæ¡è®°å½•

å°±éœ€è¦ç”¨åˆ° <foreach>ï¼Œå®ƒèƒ½éå†é›†åˆæˆ–è€…æ•°ç»„ï¼Œè‡ªåŠ¨ç”Ÿæˆä¸€æ®µåŠ¨æ€ SQLï¼

âœ… <foreach> åŸºæœ¬è¯­æ³•

```xml
<foreach 
    collection="é›†åˆåå­—" 
    item="æ¯ä¸€é¡¹çš„åå­—" 
    index="ä¸‹æ ‡å˜é‡åï¼ˆå¯é€‰ï¼‰" 
    open="å¼€å§‹ç¬¦" 
    close="ç»“æŸç¬¦" 
    separator="åˆ†éš”ç¬¦">

    SQLç‰‡æ®µï¼ˆç”¨ #{item} æˆ–è‡ªå·±å®šä¹‰çš„åå­—ï¼‰

</foreach>
```

å±æ€§ | è¯´æ˜
---|---
collection | è¦éå†çš„é›†åˆåï¼ˆList/Array/Mapï¼‰
item | æ¯æ¬¡éå†å‡ºçš„å…ƒç´ åå­—
index | å½“å‰å…ƒç´ çš„ç´¢å¼•ï¼ˆå¯ä»¥ä¸ç”¨ï¼‰
open | è¯­å¥å‰åŠ çš„å†…å®¹ï¼ˆæ¯”å¦‚ '(' ï¼‰
close | è¯­å¥ååŠ çš„å†…å®¹ï¼ˆæ¯”å¦‚ ')' ï¼‰
separator | æ¯ä¸ªå…ƒç´ ä¹‹é—´çš„åˆ†éš”ç¬¦ï¼ˆæ¯”å¦‚ ',' ï¼‰

```xml
<!--    æ‰¹é‡åˆ é™¤-->
    <delete id="deleteByIds">
        delete from tb_emp where id in
        <foreach collection="ids" item="id" separator="," open="(" close=")">
            #{id}
        </foreach>
    </delete>
```

#### 6.6.3 <sql><include>

âœ… <sql> å’Œ <include> æ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Ÿ

ç®€ç®€å•å•ä¸€å¥è¯ï¼š

æŠŠé‡å¤ç”¨çš„ SQL ç‰‡æ®µæå–å‡ºæ¥ï¼Œæƒ³ç”¨çš„æ—¶å€™ç›´æ¥ <include> å¼•ç”¨ï¼Œé¿å…é‡å¤å†™ã€‚

å°±åƒå†™å‡½æ•°ä¸€æ ·ï¼Œæœ‰äº†ä¸€ä»½å…¬ç”¨ SQL ç‰‡æ®µï¼Œæƒ³ç”¨å¤šå°‘æ¬¡éƒ½å¯ä»¥æ‹¿æ¥ç”¨ï¼Œè¶…çº§æ–¹ä¾¿ã€ç»´æŠ¤ç®€å•ï¼

âœ… åŸºæœ¬ç”¨æ³•

æ ‡ç­¾ | ä½œç”¨
---|---
<sql id="xxx"> | å®šä¹‰ä¸€æ®µå¯ä»¥å¤ç”¨çš„ SQL ç‰‡æ®µ
<include refid="xxx"/> | å¼•ç”¨é‚£æ®µ SQL ç‰‡æ®µ

âœ… ä¸¾ä¸ªç®€å•ä¾‹å­

å‡è®¾ï¼šæŸ¥è¯¢ç”¨æˆ·æ—¶ç»å¸¸éœ€è¦ id, name, age è¿™ä¸‰ä¸ªå­—æ®µã€‚

å¦‚æœæ¯æ¬¡éƒ½å†™ï¼š

```sql
SELECT id, name, age FROM user
SELECT id, name, age FROM admin
SELECT id, name, age FROM manager
```

äºæ˜¯ä½ å¯ä»¥è¿™æ · ğŸ‘‡

1. å®šä¹‰ <sql>

```xml
<sql id="Base_Column_List">
    id, name, age
</sql>
```

2. ä½¿ç”¨ <include>

```xml
<select id="selectUserById" resultType="com.example.User">
    SELECT 
        <include refid="Base_Column_List"/>
    FROM user
    WHERE id = #{id}
</select>

```

è¿™é‡Œï¼š

+ <include refid="Base_Column_List"/>
å°±æ˜¯ç›´æ¥æŠŠ id, name, age é‚£æ®µæ’è¿›æ¥äº†ï¼

âœ… æ³¨æ„äº‹é¡¹

è¦ç‚¹ | è¯´æ˜
--|---
<sql> æ ‡ç­¾å¿…é¡»å†™åœ¨ <mapper> é‡Œ | è·Ÿ <select> <insert> æ˜¯å¹³çº§çš„
id è¦å”¯ä¸€ | ç±»ä¼¼äºå‡½æ•°åï¼Œå¼•ç”¨é è¿™ä¸ª id
<include> åªèƒ½å¼•ç”¨å·²ç»å®šä¹‰å¥½çš„ <sql> | ä¸èƒ½ç›´æ¥å†™ SQL è¿›å»
å¯ä»¥åµŒå¥— <include> | ä¸€ä¸ª <sql> é‡Œé¢ä¹Ÿå¯ä»¥ <include> åˆ«çš„ <sql>


## 7. æ¡ˆä¾‹

1. ç¯å¢ƒæ­å»º

![](./å›¾ç‰‡/springboot-demo1.png)

2. å¼€å‘è§„èŒƒ - Restful

![](./å›¾ç‰‡/springboot-demo2.png)

+ RESTæ˜¯é£æ ¼ï¼Œæ˜¯çº¦å®šæ–¹å¼ï¼Œçº¦å®šä¸æ˜¯è§„å®šï¼Œå¯ä»¥æ‰“ç ´ã€‚

+ æè¿°æ¨¡å—çš„åŠŸèƒ½é€šå¸¸ä½¿ç”¨å¤æ•°ï¼Œä¹Ÿå°±æ˜¯åŠ sçš„æ ¼å¼æ¥æè¿°ï¼Œè¡¨ç¤ºæ­¤ç±»èµ„æºï¼Œè€Œéå•ä¸ªèµ„æºã€‚å¦‚ï¼šusersã€empsã€booksâ€¦

3. æµç¨‹

![](./å›¾ç‰‡/springboot-demo3.png)

ğŸ‘‰ é¦–å…ˆåœ¨ controller ä¸­å†™å‡ºæ¥å—è¯·æ±‚

![](./å›¾ç‰‡/springboot-demo4.png)

ğŸ‘‰ ç„¶åè°ƒç”¨ç»™ä½  serviceå±‚çš„å®ç°

![](./å›¾ç‰‡/springboot-demo5.png)

ğŸ‘‰ æœ€åå®ç°æ“ä½œæ•°æ®åº“

ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ³¨è§£ï¼›ä¸€ç§xml

![](./å›¾ç‰‡/springboot-demo6.png)

**æ³¨æ„xmlçš„çº¦æŸ**

![](./å›¾ç‰‡/springboot-demo7.png)

### 7.1 pagehelper

æ ¸å¿ƒåŠŸèƒ½ï¼š

+ åªè¦åœ¨æŸ¥è¯¢å‰è°ƒç”¨ä¸€ä¸‹ PageHelper.startPage(pageNum, pageSize)ï¼Œ

+ åé¢æŸ¥è¯¢çš„SQLä¼šè‡ªåŠ¨åŠ ä¸Š limitï¼Œ

+ è¿˜èƒ½è‡ªåŠ¨å¸¦ä¸Šåˆ†é¡µä¿¡æ¯ï¼Œæ¯”å¦‚æ€»è®°å½•æ•°ã€æ€»é¡µæ•°ã€‚

ğŸ“¦ ç¬¬ä¸€æ­¥ï¼šå¼•å…¥ä¾èµ–

å¦‚æœä½ ç”¨çš„æ˜¯ Mavenï¼Œåœ¨ pom.xml é‡ŒåŠ ï¼š

```xml
<dependency>
    <groupId>com.github.pagehelper</groupId>
    <artifactId>pagehelper-spring-boot-starter</artifactId>
    <version>1.4.7</version> <!-- ç‰ˆæœ¬å¯ä»¥æ¢æˆä½ éœ€è¦çš„ -->
</dependency>
```

ğŸ› ï¸ ç¬¬äºŒæ­¥ï¼šåŸºæœ¬ä½¿ç”¨

åœ¨ä½  Serviceå±‚ è°ƒç”¨æŸ¥è¯¢æ–¹æ³•ä¹‹å‰ï¼Œå…ˆå†™ï¼š

```java
PageHelper.startPage(pageNum, pageSize);
List<User> users = userMapper.selectAll();
```

è¿™æ ·ï¼Œåº•å±‚å°±è‡ªåŠ¨åŠ äº† limitï¼

ğŸ‘‰ ä¸éœ€è¦ä½ è‡ªå·±åœ¨ XML é‡Œå†™ limit #{offset}, #{pageSize} äº†ã€‚

æ¯”å¦‚å®é™…å‘å‡ºçš„ SQL ä¼šå˜æˆï¼š

```sql
select * from user limit 0, 10
```

ğŸ› ï¸ ç¬¬ä¸‰æ­¥ï¼šæ‹¿åˆ°åˆ†é¡µä¿¡æ¯

å¦‚æœä½ æƒ³è¦æ€»è®°å½•æ•°ã€æ€»é¡µæ•°ç­‰åˆ†é¡µä¿¡æ¯ï¼Œè¿˜å¯ä»¥ç”¨ PageInfo åŒ…è£…ä¸€ä¸‹ï¼š

```java
PageHelper.startPage(pageNo, pageSize);

List<Emp> list = empMapper.list();
Page<Emp> p = (Page<Emp>) list;

return new PageBean(p.getTotal(), p.getResult());
```

mapper åªè¦å®ç°ä¸‹é¢å³å¯ï¼Œpagehelperä¼šè‡ªåŠ¨å¯¹è¿™ä¸ªsqlè¿›è¡Œæ”¹é€ ï¼Œç”Ÿæˆä¸¤æ¡è¯­å¥ï¼Œåˆ†åˆ«æŸ¥æ‰¾æ€»æ•°å’Œæ€»limitï¼›

```java
@Select("select * from emp")
    public List<Emp> list();
```

### 7.2 é…ç½®æ–‡ä»¶

å¸¸é‡ï¼Œæ”¾åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼›åŠ è½½æ—¶ï¼Œä½¿ç”¨æ³¨è§£ @Value("key")

![](./å›¾ç‰‡/springboot-demo8.png)

ä½†æ˜¯æ­£å¸¸æƒ…å†µä¸‹ æ˜¯ä½¿ç”¨ymlæ–‡ä»¶ã€‚

ymlæ•°æ®æ ¼å¼ï¼š

![](./å›¾ç‰‡/springboot-yml1.png)

ä½¿ç”¨ @ConfigurationProperties è¿›è¡Œæ˜ å°„æ›¿ä»£ Valueï¼š

![](./å›¾ç‰‡/springboot-yml2.png)

ğŸŒŸ ä¾‹å­

1. åœ¨ yml æ–‡ä»¶ä¸­é…ç½®å‚æ•°ï¼š

![](./å›¾ç‰‡/springboot-yml3.png)

2. åˆ›å»ºå®ä½“ç±»è¿›è¡Œæ˜ å°„

![](./å›¾ç‰‡/springboot-yml4.png)

3. ä½¿ç”¨

![](./å›¾ç‰‡/springboot-yml5.png)



## 8. æ–‡ä»¶ä¸Šä¼ 

### 8.1 ä¿å­˜åˆ°æœ¬åœ°

![](./å›¾ç‰‡/springboot-file.png)

ğŸ”½ è¡¨å•éƒ¨åˆ†é‡ç‚¹è®²è§£

```html
<form action="/upload" method="post" enctype="multipart/form-data">
```

ğŸ”¹ action="/upload"

è¡¨ç¤ºè¡¨å•æäº¤åï¼Œæ•°æ®ä¼šè¢«å‘é€åˆ°æœåŠ¡å™¨ /upload è¿™ä¸ªè·¯å¾„ã€‚

ğŸ”¹ method="post"

ä½¿ç”¨ POST æ–¹æ³•æäº¤ï¼ˆå› ä¸ºä¸Šä¼ æ–‡ä»¶ä¸èƒ½ç”¨ GETï¼‰ã€‚

ğŸ”¹ enctype="multipart/form-data"

âš ï¸ è¿™æ˜¯ä¸Šä¼ æ–‡ä»¶çš„å…³é”®ç‚¹ï¼

å¿…é¡»åŠ è¿™ä¸ª enctypeï¼Œå¦åˆ™ä¸Šä¼ çš„æ–‡ä»¶å­—æ®µæ˜¯ç©ºçš„ï¼

ğŸ”¸ è¡¨å•å­—æ®µ

```html
å§“å: <input type="text" name="username"><br>
```

æ™®é€šæ–‡æœ¬æ¡†ï¼Œname=â€œusernameâ€ï¼Œç”¨äºæäº¤ç”¨æˆ·åã€‚

```html
å¹´é¾„: <input type="text" name="age"><br>
```

æ–‡æœ¬æ¡†ï¼Œname=â€œageâ€ï¼Œå¡«å†™å¹´é¾„ã€‚

```html
å¤´åƒ: <input type="file" name="image"><br>
```

+ æ–‡ä»¶é€‰æ‹©æ§ä»¶ï¼Œè®©ç”¨æˆ·é€‰æ‹©æœ¬åœ°æ–‡ä»¶ï¼ˆå›¾ç‰‡ç­‰ï¼‰ã€‚

+ name="image" æ˜¯æœåŠ¡ç«¯è·å–è¿™ä¸ªæ–‡ä»¶å­—æ®µçš„ keyã€‚æ–‡ä»¶é€‰æ‹©æ§ä»¶ï¼Œè®©ç”¨æˆ·é€‰æ‹©æœ¬åœ°æ–‡ä»¶ï¼ˆå›¾ç‰‡ç­‰ï¼‰ã€‚


```html
<input type="submit" value="æäº¤">
```

æäº¤æŒ‰é’®ã€‚

ğŸ§ª æäº¤æ•ˆæœ

ç‚¹å‡»ã€æäº¤ã€‘ä¹‹åï¼Œä¼šæŠŠä»¥ä¸‹å†…å®¹æ‰“åŒ…ä¸Šä¼ åˆ° /uploadï¼š

+ username=å°æ˜
+ age=18
+ image=æœ¬åœ°ä¸Šä¼ çš„æ–‡ä»¶äºŒè¿›åˆ¶å†…å®¹

ğŸ§° åç«¯é…åˆï¼ˆç®€å•ä¾‹å­ï¼‰

```java
@PostMapping("/upload")
public String handleUpload(
        @RequestParam("username") String username,
        @RequestParam("age") String age,
        @RequestParam("image") MultipartFile image) throws IOException {

    System.out.println("ç”¨æˆ·å: " + username);
    System.out.println("å¹´é¾„: " + age);
    System.out.println("æ–‡ä»¶å: " + image.getOriginalFilename());

    // ä¿å­˜åˆ°æœ¬åœ°
    image.transferTo(new File("D:/upload/" + image.getOriginalFilename()));
    
    return "ä¸Šä¼ æˆåŠŸ";
}
```

### 8.2 UUID ç±»ç”Ÿæˆå…¨å±€å”¯ä¸€çš„å­—ç¬¦ä¸²

```java
import java.io.File;
import java.io.IOException;
import java.util.UUID;
import org.springframework.web.multipart.MultipartFile;

@PostMapping("/upload")
public String uploadFile(@RequestParam("file") MultipartFile file) throws IOException {
    // è·å–åŸå§‹æ–‡ä»¶ååç¼€ï¼ˆå¦‚ .jpg/.png/.txtï¼‰
    String originalFilename = file.getOriginalFilename();
    String suffix = originalFilename.substring(originalFilename.lastIndexOf("."));

    // ç”Ÿæˆ UUID æ–‡ä»¶å
    String uuidFileName = UUID.randomUUID().toString() + suffix;

    // ä¿å­˜è·¯å¾„ï¼ˆç¡®ä¿ç›®å½•å­˜åœ¨ï¼‰
    File dest = new File("D:/upload/" + uuidFileName);
    file.transferTo(dest);

    return "ä¸Šä¼ æˆåŠŸï¼Œä¿å­˜åä¸ºï¼š" + uuidFileName;
}

```

åœ¨SpringBootä¸­ï¼Œæ–‡ä»¶ä¸Šä¼ ï¼Œé»˜è®¤å•ä¸ªæ–‡ä»¶å…è®¸æœ€å¤§å¤§å°ä¸º 1Mã€‚å¦‚æœéœ€è¦ä¸Šä¼ å¤§æ–‡ä»¶ï¼Œå¯ä»¥è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š

```java
#é…ç½®å•ä¸ªæ–‡ä»¶æœ€å¤§ä¸Šä¼ å¤§å°
spring.servlet.multipart.max-file-size=10MB
#é…ç½®å•ä¸ªè¯·æ±‚æœ€å¤§ä¸Šä¼ å¤§å°(ä¸€æ¬¡è¯·æ±‚å¯ä»¥ä¸Šä¼ å¤šä¸ªæ–‡ä»¶)
spring.servlet.multipart.max-request-size=100MB
```

å¸¸è§çš„æ–¹æ³•

```java
String getOriginalFilename(); //è·å–åŸå§‹æ–‡ä»¶å
void transferTo(File dest); //å°†æ¥æ”¶çš„æ–‡ä»¶è½¬å­˜åˆ°ç£ç›˜æ–‡ä»¶ä¸­
long getSize(); //è·å–æ–‡ä»¶çš„å¤§å°ï¼Œå•ä½ï¼šå­—èŠ‚
byte[] getBytes(); //è·å–æ–‡ä»¶å†…å®¹çš„å­—èŠ‚æ•°ç»„
InputStream getInputStream(); //è·å–æ¥æ”¶åˆ°çš„æ–‡ä»¶å†…å®¹çš„è¾“å…¥æµ
```

### 8.3 äº‘ä¿å­˜

ç›´æ¥çœ‹é˜¿é‡Œäº‘æ–‡æ¡£ï¼›

![](./å›¾ç‰‡/springboot-oss.png)


## 9. springboot å¸¸ç”¨æ³¨è§£

+ @Slf4j ï¼š ç›´æ¥ä½¿ç”¨æ—¥å¿— `log.info("call getDept");`

âœ… Controller å±‚å¸¸ç”¨æ³¨è§£æ±‡æ€»

æ³¨è§£ | ä½œç”¨ | å¸¸ç”¨åœ¨å“ª
---|---|---
@RestController | å®šä¹‰ä¸€ä¸ª RESTful é£æ ¼çš„ Controllerï¼Œè¿”å› JSON æ•°æ® | ç±»ä¸Š
@Controller | å®šä¹‰ä¸€ä¸ªæ™®é€šçš„ Controllerï¼Œè¿”å›è§†å›¾é¡µé¢ï¼ˆæ¯”å¦‚ Thymeleafï¼‰ | ç±»ä¸Š
@RequestMapping | è¯·æ±‚è·¯å¾„æ˜ å°„ï¼ˆå¯ä»¥åŠ åœ¨ç±»å’Œæ–¹æ³•ä¸Šï¼‰ | ç±»/æ–¹æ³•ä¸Š
@GetMapping / @PostMapping / @PutMapping / @DeleteMapping | æ›´å…·ä½“çš„è¯·æ±‚æ–¹å¼æ˜ å°„ï¼ˆç®€åŒ–ç‰ˆï¼‰ | æ–¹æ³•ä¸Š
@RequestParam | ç»‘å®šè¯·æ±‚å‚æ•°åˆ°æ–¹æ³•çš„å…¥å‚ï¼ˆå¦‚ ?name=xxxï¼‰ | æ–¹æ³•å‚æ•°ä¸Š
@PathVariable | ç»‘å®š URL é‡Œçš„è·¯å¾„å˜é‡ï¼ˆå¦‚ /user/{id}ï¼‰ | æ–¹æ³•å‚æ•°ä¸Š
@RequestBody | æŠŠè¯·æ±‚ä½“é‡Œçš„ JSON æ•°æ®ï¼Œç»‘å®šåˆ° Java å¯¹è±¡ | æ–¹æ³•å‚æ•°ä¸Š
@ResponseBody | æ–¹æ³•è¿”å›çš„æ•°æ®ç›´æ¥ä½œä¸º HTTP å“åº”ä½“è¾“å‡º | æ–¹æ³•ä¸Šï¼ˆéšå«åœ¨ @RestControllerï¼‰
@RequestHeader | ç»‘å®šè¯·æ±‚å¤´åˆ°æ–¹æ³•å‚æ•° | æ–¹æ³•å‚æ•°ä¸Š
@ModelAttribute | æŠŠè¯·æ±‚å‚æ•°ç»‘å®šåˆ°å¯¹è±¡ï¼ŒåŒæ—¶å¯ä»¥ç”¨äºåˆå§‹åŒ–è¡¨å•æ•°æ® | æ–¹æ³•å‚æ•°ä¸Š

âœ… å¸¸è§çš„IOC/DIç›¸å…³æ³¨è§£ä¸€è§ˆè¡¨

æ³¨è§£ | ä½œç”¨ | ä½ç½® | å¤‡æ³¨
---|---|---|---
@Component | æ ‡æ³¨ä¸ºæ™®é€šç»„ä»¶ | ç±»ä¸Š | æœ€åŸºç¡€çš„æ³¨è§£
@Service | æ ‡æ³¨ä¸ºæœåŠ¡å±‚ç»„ä»¶ | ç±»ä¸Š | ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆServiceï¼‰
@Repository | æ ‡æ³¨ä¸ºæ•°æ®è®¿é—®å±‚ç»„ä»¶ | ç±»ä¸Š | DAO å±‚ï¼ˆæ•°æ®åº“æ“ä½œï¼‰
@Controller | æ ‡æ³¨ä¸ºæ§åˆ¶å™¨ç»„ä»¶ | ç±»ä¸Š | Web æ§åˆ¶å™¨å±‚
@RestController | Controller + ResponseBodyç»„åˆ | ç±»ä¸Š | è¿”å› JSON
@Autowired | è‡ªåŠ¨æ³¨å…¥ Spring å®¹å™¨ä¸­çš„ Bean | å±æ€§/æ„é€ å™¨/æ–¹æ³•ä¸Š | æŒ‰ç±»å‹æ³¨å…¥
@Qualifier | é…åˆ @Autowired æŒ‰åå­—æ³¨å…¥ | å±æ€§/å‚æ•°ä¸Š | è§£å†³å¤šä¸ª Bean å†²çª
@Resource | JSR-250è§„èŒƒï¼ŒæŒ‰åå­—æ³¨å…¥ï¼ˆä¼˜å…ˆï¼‰ | å±æ€§ä¸Š | éœ€è¦å¼•å…¥ javax.annotation åŒ…
@Inject | JSR-330è§„èŒƒï¼ŒæŒ‰ç±»å‹æ³¨å…¥ | å±æ€§ä¸Š | å’Œ@Autowiredç±»ä¼¼ï¼Œä½†æ˜¯æ ‡å‡†
@Value | æ³¨å…¥é…ç½®æ–‡ä»¶ä¸­çš„å€¼ | å±æ€§ä¸Š | å¦‚application.properties

5. @Autowired
â¡ï¸ è‡ªåŠ¨æ³¨å…¥å®¹å™¨ä¸­çš„ Beanï¼ŒæŒ‰ç±»å‹æ¥æ³¨å…¥ã€‚

```java
@Service
public class OrderService {

    @Autowired
    private UserService userService;

    public void createOrder() {
        userService.register();
        System.out.println("Order created!");
    }
}
```

## 10. ç™»å½•è®¤è¯

### 10.1 ç™»å½•åŠŸèƒ½

æ ¹æ® ç”¨æˆ·å å’Œ å¯†ç  åˆ°æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢å³å¯ï¼›

```java
@Select("select * from emp where username = #{username} and password = #{password}")
Emp getByUsernameAndPassword(Emp emp);
```

### 10.2 ç™»å½•æ ¡éªŒ

ğŸ§  ä¸ºä»€ä¹ˆéœ€è¦ç™»å½•æ ¡éªŒ ï¼Ÿ

é¦–å…ˆhttpåè®®æ˜¯æ— çŠ¶æ€çš„ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€æ¬¡è¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸‹ä¸€æ¬¡è¯·æ±‚ä¸ä¼šæºå¸¦ä¸Šä¸€æ¬¡è¯·æ±‚çš„æ•°æ®ã€‚æœåŠ¡å™¨ä¸æµè§ˆå™¨ä¹‹é—´è¿›è¡Œäº¤äº’å°±æ˜¯åŸºäºhttpåè®®ï¼Œé‚£ä¹ˆæ¯”å¦‚æˆ‘ä»¬é€šè¿‡æµè§ˆå™¨æ¥è®¿é—®äº†ç™»å½•è¿™ä¸ªæ¥å£å¹¶å®ç°äº†ç™»å½•çš„è¿™ä¸ªæ“ä½œï¼Œä½†æˆ‘ä»¬å†æ‰§è¡Œå…¶ä»–ä¸šåŠ¡æ“ä½œæ—¶ æœåŠ¡å™¨ä¹Ÿå¹¶ä¸çŸ¥é“è¿™ä¸ªå‘˜å·¥æœ‰æ²¡æœ‰ç™»å½•ï¼Œå› ä¸ºhttpåè®®æ—¶æ— çŠ¶æ€çš„ï¼Œä¸¤æ¬¡è¯·æ±‚ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥å°±æœ‰äº†ç™»å½•æ ¡éªŒè¿™ä¸ªæ“ä½œ

ğŸ‘‰ å‡å¦‚æ²¡æœ‰ç™»å½•æ ¡éªŒï¼Œæ­¤æ—¶ä¸€ä¸ªç”¨æˆ·è¿›è¡Œç™»å½•äº†ã€‚æ­¤æ—¶æ‹¿åˆ°è¿™ä¸ª urlã€‚å½“è¿™ä¸ªç”¨æˆ·é€€å‡ºåï¼Œå†æ¬¡è®¿é—®è¿™ä¸ª urlï¼Œå°±ä¼šå‘ç”Ÿå¯ä»¥è®¿é—®åˆ°è¿™ä¸ªèµ„æºã€‚è¿™æ˜¾ç„¶æ˜¯ä¸å¯¹çš„ã€‚å› ä¸ºæ­¤æ—¶æ²¡æœ‰ç™»å½•å°±å¯ä»¥è®¿é—®åˆ°æ•°æ®ã€‚

è§£å†³æ–¹æ¡ˆï¼šæˆ‘ä»¬è¦åœ¨å‘˜å·¥ç™»å½•ä¹‹åå­˜å‚¨ä¸€ä¸ªæ ‡è®°ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æ¯ä¸€ä¸ªæ¥å£æ–¹æ³•ä¹‹å‰æ¥åšä¸€ä¸ªæ¡ä»¶åˆ¤æ–­ï¼Œå¦‚æœè¿™ä¸ªå‘˜å·¥å·²ç»ç™»å½•äº†ï¼Œé‚£å°±æ‰§è¡Œæ­£å¸¸çš„ä¸šåŠ¡æ“ä½œï¼Œå¦åˆ™å°±æ˜¯æ²¡æœ‰ç™»å½•å°±ç›´æ¥è¿”å›é”™è¯¯ä¿¡æ¯ç»™å‰ç«¯ï¼Œå‰ç«¯æ‹¿åˆ°è¿™ä¸ªé”™è¯¯ä¿¡æ¯å å®ƒä¼šè‡ªåŠ¨åœ°è·³è½¬åˆ°ç™»å½•é¡µé¢ï¼ˆå…¶ä»–çš„åŠŸèƒ½ä¹Ÿæ˜¯æ ¹æ®è¿™ä¸ªç›¸åŒçš„é€»è¾‘æ¥è¿›è¡Œåˆ¤æ–­ï¼ï¼‰


âš¡ ä½†æ˜¯å¦‚æœæ¯æ¬¡éƒ½è¿›è¡Œåˆ¤æ–­ä¼šå¾ˆç¹çã€‚ç»Ÿä¸€æ‹¦æˆªæŠ€æœ¯ï¼Œå¯ä»¥æ¥æ‹¦æˆªæµè§ˆå™¨å‘é€è¿‡æ¥çš„æ‰€æœ‰è¯·æ±‚ï¼Œå°±å¯ä»¥å¯¹å…¶è¿›è¡Œæ ¡éªŒå‘˜å·¥æ˜¯å¦ç™»å½•ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥è·å–ä¹‹å‰æ‰€å­˜å…¥çš„è¿™ä¸ªç™»é™†çš„æ ‡è®°ï¼Œå¦‚æœæˆåŠŸè·å–åˆ°äº†è¿™ä¸ªæ ‡è®°å¹¶æ²¡æœ‰é—®é¢˜ï¼Œé‚£å°±è¯´æ˜è¿™ä¸ªå‘˜å·¥å·²ç»ç™»å½•äº†ï¼Œå°±ç›´æ¥æ”¾è¡Œ ç»§ç»­å»è®¿é—®æ­£å¸¸çš„ä¸šåŠ¡æ¥å£å°±å¯ä»¥ï¼Œä½†å¦‚æœè·å–åˆ°çš„ç™»å½•æ ‡è®°æ˜¯æœ‰é—®é¢˜çš„ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç»™å‰ç«¯å“åº”ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œå‰ç«¯å°±ä¼šè‡ªåŠ¨çš„è·³è½¬åˆ°ç™»å½•é¡µé¢

![](./å›¾ç‰‡/springboot-ç™»å½•æ ¡éªŒ1.png)

#### 10.2.1 ä¼šè¯æŠ€æœ¯

ä¼šè¯ï¼š æŒ‡çš„å°±æ˜¯æœåŠ¡å™¨ ä¸æµè§ˆå™¨ä¹‹é—´çš„ä¸€æ¬¡è¿æ¥ï¼Œç›´åˆ°æœ‰ä¸€æ–¹æ–­å¼€è¿æ¥ ä¼šè¯æ‰ä¼šç»“æŸï¼Œå¹¶ä¸”åœ¨ä¸€æ¬¡ä¼šè¯ä¸­å¯ä»¥åŒ…å«å¤šæ¬¡è¯·æ±‚å’Œå“åº”ã€‚åªè¦è¿™ä¸ªæµè§ˆå™¨å’ŒæœåŠ¡å™¨éƒ½æ²¡æœ‰å…³é—­ï¼Œé‚£ä¹ˆè¿™ä¸‰æ¬¡è¯·æ±‚éƒ½æ˜¯åœ¨ä¸€æ¬¡ä¼šè¯ä¸­å®Œæˆçš„ã€‚

ğŸ§  ä¸ºä»€ä¹ˆéœ€è¦ä¼šè¯æŠ€æœ¯ï¼Ÿ

HTTP æ˜¯æ— çŠ¶æ€åè®®ï¼Œå³ï¼š

> æ¯æ¬¡è¯·æ±‚ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼ŒæœåŠ¡å™¨æ— æ³•çŸ¥é“ä¸¤æ¬¡è¯·æ±‚æ¥è‡ªåŒä¸€ä¸ªç”¨æˆ·ã€‚

è€Œåœ¨å®é™…ä¸šåŠ¡ä¸­æˆ‘ä»¬é€šå¸¸éœ€è¦ï¼š

+ ç”¨æˆ·ç™»å½•ä¸€æ¬¡åï¼Œå¤šæ¬¡è®¿é—®ä»ä¿æŒâ€œå·²ç™»å½•çŠ¶æ€â€
+ è´­ç‰©è½¦ã€æµè§ˆè®°å½•ã€æƒé™æ ¡éªŒç­‰ä¿¡æ¯èƒ½ç»´æŒ
+ é¿å…æ¯æ¬¡éƒ½é‡æ–°ç™»å½•æˆ–é‡æ–°æäº¤ä¿¡æ¯

â¡ï¸ æ‰€ä»¥å°±éœ€è¦ ä¼šè¯æŠ€æœ¯ã€‚


ğŸ“Œ **ä¼šè¯è·Ÿè¸ª**

ä¼šè¯è·Ÿè¸ªï¼ˆSession Trackingï¼‰æ˜¯ Web å¼€å‘ä¸­ç”¨äºè¯†åˆ«åŒä¸€ä¸ªç”¨æˆ·åœ¨å¤šæ¬¡è¯·æ±‚ä¸­èº«ä»½ï¼Œå¹¶ä¿å­˜å…¶çŠ¶æ€ä¿¡æ¯çš„ä¸€ç§æŠ€æœ¯ã€‚ç”±äº HTTP æ˜¯æ— çŠ¶æ€åè®®ï¼ŒæœåŠ¡å™¨é»˜è®¤æ— æ³•è¯†åˆ«ä¸¤æ¬¡è¯·æ±‚æ˜¯å¦æ¥è‡ªåŒä¸€ä¸ªç”¨æˆ·ï¼Œå› æ­¤éœ€è¦é€šè¿‡ä¼šè¯è·Ÿè¸ªæ¥ç»´æŒç”¨æˆ·çŠ¶æ€ã€‚

é€šä¿—æ¥è¯´å°±æ˜¯ä»ŠåæœåŠ¡å™¨ä¼šæ”¶åˆ°å¾ˆå¤šçš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿™æ—¶å°±éœ€è¦è¯†åˆ«å‡ºæ¥è¿™å†™äº›è¯·æ±‚æ˜¯ä¸æ˜¯æ¥è‡ªåŒä¸€ä¸ªæµè§ˆå™¨ï¼Œå¦‚æœä¸æ˜¯ å°±è¯´æ˜æ˜¯ä¸åŒçš„ä¼šè¯ï¼Œå¦‚æœæ˜¯ å°±è¯´æ˜æ˜¯åŒä¸€ä¼šè¯ å°±åœ¨åŒä¸€æ¬¡ä¼šè¯çš„å¤šæ¬¡è¯·æ±‚é—´å…±äº«æ•°æ®ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±å«åš â€”â€”â€”â€”ä¼šè¯è·Ÿè¸ªã€‚

ğŸ§  ä¸¾ä¸ªä¾‹å­ï¼š
ä½ ç™»å½•äº†ä¸€ä¸ªè´­ç‰©ç½‘ç«™åï¼š

1. æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦
2. æŸ¥çœ‹è®¢å•
3. æäº¤æ”¯ä»˜

è¿™ä¸€ç³»åˆ—æ“ä½œéƒ½å±äºåŒä¸€ä¸ªâ€œä¼šè¯â€ã€‚æœåŠ¡å™¨éœ€è¦è·Ÿè¸ªä½ è¿™ä¸ªç”¨æˆ·å½“å‰çš„çŠ¶æ€ï¼Œå¦åˆ™æ¯æ¬¡è¯·æ±‚å®ƒéƒ½ä¸çŸ¥é“â€œä½ æ˜¯è°â€ã€‚

ğŸ¯ ä¼šè¯è·Ÿè¸ªçš„ç›®çš„

+ å®ç°ç”¨æˆ·ç™»å½•ä¿æŒï¼ˆæ— éœ€æ¯æ¬¡éƒ½ç™»å½•ï¼‰
+ ä¿å­˜è´­ç‰©è½¦ã€æµè§ˆè®°å½•ã€ç”¨æˆ·æƒé™ç­‰ä¿¡æ¯
+ æ”¯æŒå¤šæ­¥éª¤æ“ä½œæµç¨‹ï¼ˆå¦‚ä¸‹å• â†’ æ”¯ä»˜ï¼‰



âœ… å¸¸è§çš„ä¼šè¯è·Ÿè¸ªæŠ€æœ¯æœ‰ï¼š

| æŠ€æœ¯              | è¯´æ˜ |
|-------------------|------|
| **Cookie**        | åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸­ä¿å­˜ç”¨æˆ·æ ‡è¯†ä¿¡æ¯ï¼Œè‡ªåŠ¨éšè¯·æ±‚å‘é€ç»™æœåŠ¡å™¨ã€‚|
| **Session**       | åœ¨æœåŠ¡å™¨ç«¯ä¸ºæ¯ä¸ªç”¨æˆ·ç”Ÿæˆå”¯ä¸€ session å¯¹è±¡ï¼Œä½¿ç”¨ sessionId ä¸å®¢æˆ·ç«¯ç»‘å®šã€‚|
| **URLé‡å†™**       | å°†ç”¨æˆ·æ ‡è¯†ä½œä¸ºå‚æ•°é™„åŠ åˆ°æ¯ä¸ªURLåé¢ï¼Œä¾‹å¦‚ï¼š`/cart.jsp?sessionid=12345`ã€‚|
| **éšè—è¡¨å•å­—æ®µ**  | åœ¨è¡¨å•ä¸­åµŒå…¥éšè—å­—æ®µ `<input type="hidden" name="sessionId" value="xxx"/>`ã€‚|
| **Token (JWT ç­‰)**| ä½¿ç”¨ä»¤ç‰Œåœ¨å‰åç«¯ä¹‹é—´ä¼ é€’ä¼šè¯ä¿¡æ¯ï¼Œå¸¸ç”¨äºç§»åŠ¨ç«¯å’Œå‰åç«¯åˆ†ç¦»é¡¹ç›®ã€‚|

ğŸŒ å¯¹æ¯”å‡ ä¸ªæ–¹å¼

| æ–¹æ³•       | å­˜å‚¨ä½ç½®      | å®‰å…¨æ€§ | é€‚ç”¨åœºæ™¯ |
|------------|---------------|--------|-----------|
| Cookie     | æµè§ˆå™¨æœ¬åœ°    | ä¸­ç­‰   | ç®€å•çŠ¶æ€ç»´æŠ¤ |
| Session    | æœåŠ¡å™¨å†…å­˜/ç¼“å­˜ | é«˜     | å¤šç”¨æˆ·ç³»ç»Ÿã€ç”¨æˆ·æ•°æ®è¾ƒå¤š |
| URLé‡å†™    | URLä¸­         | ä½     | æ— Cookieæ”¯æŒçš„æµè§ˆå™¨ |
| JWT Token  | å®¢æˆ·ç«¯+æœåŠ¡ç«¯è§£æ | é«˜   | å‰åç«¯åˆ†ç¦»ã€åˆ†å¸ƒå¼ç³»ç»Ÿ |

![](./å›¾ç‰‡/springboot-ç™»å½•æ ¡éªŒ2.png)

#### 10.2.2 JWTä»¤ç‰Œ

ä¸»è¦ä¸¤æ­¥æ“ä½œï¼šç”Ÿæˆä»¤ç‰Œã€æ ¡éªŒä»¤ç‰Œï¼›

![](./å›¾ç‰‡/springboot-ç™»å½•æ ¡éªŒ3.png)

```java
@Test
public void genJwt() {
    Map<String, Object> claims = new HashMap<>();
    claims.put("id", 1);
    claims.put("username", "Tom");

    String jwt = Jwts.builder()
            .signWith(SignatureAlgorithm.HS256, "yzxeqrygwer") //ç­¾åç®—æ³•
            .setClaims(claims) //è‡ªå®šä¹‰å†…å®¹(è½½è·)
            .setExpiration(new Date(System.currentTimeMillis() + 12 * 3600 * 1000)) //æœ‰æ•ˆæœŸ
            .compact();
    System.out.println(jwt);
}

@Test
public void testJwt2() {
    Claims claims = Jwts.parser()
            .setSigningKey("yzxeqrygwer")
            .parseClaimsJws("eyJhbGciOiJIUzI1NiJ9.eyJpZCI6MSwiZXhwIjoxNzQ1OTc4NjgzLCJ1c2VybmFtZSI6IlRvbSJ9.bHNWPI8mIq9tsnRg0l9A59iTjyTen6omKYi3j90B6F4")
            .getBody();
    System.out.println(claims);
}
```




âš ï¸ æŠ¥é”™ï¼š

| é—®é¢˜ | åŸå›  |
|------|------|
| `signWith(SignatureAlgorithm, String)` æŠ¥é”™ | è¢«å¼ƒç”¨ï¼Œåº”ä½¿ç”¨ `Key` |
| `IllegalArgumentException: key too short` | å¯†é’¥å¤ªçŸ­ï¼Œéœ€ â‰¥ 32 å­—èŠ‚ |
| `Cannot resolve method signWith(...)` | ä¾èµ–ç‰ˆæœ¬è¿‡æ—§æˆ–ä¸å®Œæ•´ |

#### 10.2.3 è¿‡æ»¤å™¨Filter

â— æ¦‚å¿µ: Filter è¿‡æ»¤å™¨,æ˜¯JavaWeb ä¸‰å¤§ç»„ä»¶(Servletã€Filterã€Listener)ä¹‹ä¸€ã€‚

â— è¿‡æ»¤å™¨å¯ä»¥æŠŠå¯¹èµ„æºçš„è¯·æ±‚æ‹¦æˆªä¸‹æ¥,ä»è€Œå®ç°ä¸€äº›ç‰¹æ®Šçš„åŠŸèƒ½ã€‚

â— è¿‡æ»¤å™¨ä¸€èˆ¬å®Œæˆä¸€äº›é€šç”¨çš„æ“ä½œ,æ¯”å¦‚:ç™»å½•æ ¡éªŒã€ç»Ÿä¸€ç¼–ç å¤„ç†ã€æ•æ„Ÿå­—ç¬¦å¤„ç†ç­‰ã€‚

![](./å›¾ç‰‡/springboot-filter1.png)


âœ… æ‹¦æˆªè·¯å¾„ï¼šFilterå¯ä»¥æ ¹æ®éœ€æ±‚ï¼Œé…ç½®ä¸åŒçš„æ‹¦æˆªèµ„æºè·¯å¾„

`@WebFilter(urlPatterns = "/*")`

æ‹¦æˆªå…·ä½“è·¯å¾„ï¼š /login ï¼Œä¹‹è®¿é—® /login è·¯å¾„æ—¶ï¼Œæ‰ä¼šè¢«æ‹¦æˆªï¼›

ç›®å½•æ‹¦æˆªï¼š/emps/* ï¼Œè®¿é—® /emps ä¸‹çš„æ‰€æœ‰èµ„æºï¼Œéƒ½ä¼šè¢«æ‹¦æˆªï¼›

æ‹¦æˆªæ‰€æœ‰ï¼š/* ,è®¿é—®æ‰€æœ‰èµ„æºéƒ½ä¼šè¢«æ‹¦æˆªï¼›

âœ… è¿‡æ»¤å™¨é“¾ï¼šä¸€ä¸ªwebåº”ç”¨ä¸­ï¼Œå¯ä»¥é…ç½®å¤šä¸ªè¿‡æ»¤å™¨ï¼Œè¿™å¤šä¸ªè¿‡æ»¤å™¨å°±å½¢æˆäº†ä¸€ä¸ª è¿‡æ»¤å™¨é“¾ï¼›

æ³¨æ„ï¼šè¿‡æ»¤å™¨é¡ºåºæ˜¯å’Œåå­—å¼ºå…³è”çš„ï¼›

![](./å›¾ç‰‡/springboot-filter2.png)

âœ… ç™»å½•æ ¡éªŒ

+ æ‰€æœ‰çš„è¯·æ±‚ï¼Œæ‹¦æˆªåˆ°äº†ä¹‹åï¼Œéƒ½éœ€è¦æ ¡éªŒä»¤ç‰Œå—ï¼Ÿæœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œç™»å½•è¯·æ±‚

+ æ‹¦æˆªåˆ°è¯·æ±‚åï¼Œä»€ä¹ˆæƒ…å†µä¸‹æ‰å¯ä»¥æ”¾è¡Œï¼Œæ‰§è¡Œä¸šåŠ¡æ“ä½œï¼Ÿæœ‰ä»¤ç‰Œï¼Œä¸”ä»¤ç‰Œæ ¡éªŒé€šè¿‡ï¼ˆåˆæ³•ï¼‰ï¼›å¦åˆ™éƒ½è¿”å›æœªç™»å½•é”™è¯¯ç»“æœ

âœ¨ ç™»å½•æ ¡éªŒæµç¨‹

![](./å›¾ç‰‡/springboot-filter3.png)

```java
public class LoginCheckFilter implements Filter {
    @Override
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {

        HttpServletRequest req = (HttpServletRequest) request;
        HttpServletResponse resp = (HttpServletResponse) response;

        //1.è·å–è¯·æ±‚urlã€‚
        String url = req.getRequestURL().toString();
        log.info("è¯·æ±‚çš„url: {}",url);

        //2.åˆ¤æ–­è¯·æ±‚urlä¸­æ˜¯å¦åŒ…å«loginï¼Œå¦‚æœåŒ…å«ï¼Œè¯´æ˜æ˜¯ç™»å½•æ“ä½œï¼Œæ”¾è¡Œã€‚
        if(url.contains("login")){
            log.info("ç™»å½•æ“ä½œ, æ”¾è¡Œ...");
            chain.doFilter(request,response);
            return;
        }

        //3.è·å–è¯·æ±‚å¤´ä¸­çš„ä»¤ç‰Œï¼ˆtokenï¼‰ã€‚
        String jwt = req.getHeader("token");

        //4.åˆ¤æ–­ä»¤ç‰Œæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯ç»“æœï¼ˆæœªç™»å½•ï¼‰ã€‚
        if(!StringUtils.hasLength(jwt)){
            log.info("è¯·æ±‚å¤´tokenä¸ºç©º,è¿”å›æœªç™»å½•çš„ä¿¡æ¯");
            Result error = Result.error("NOT_LOGIN");
            //æ‰‹åŠ¨è½¬æ¢ å¯¹è±¡--json --------> é˜¿é‡Œå·´å·´fastJSON
            String notLogin = JSONObject.toJSONString(error);
            resp.getWriter().write(notLogin);
            return;
        }

        //5.è§£ætokenï¼Œå¦‚æœè§£æå¤±è´¥ï¼Œè¿”å›é”™è¯¯ç»“æœï¼ˆæœªç™»å½•ï¼‰ã€‚
        try {
            JwtUtils.parseJWT(jwt);
        } catch (Exception e) {//jwtè§£æå¤±è´¥
            e.printStackTrace();
            log.info("è§£æä»¤ç‰Œå¤±è´¥, è¿”å›æœªç™»å½•é”™è¯¯ä¿¡æ¯");
            Result error = Result.error("NOT_LOGIN");
            //æ‰‹åŠ¨è½¬æ¢ å¯¹è±¡--json --------> é˜¿é‡Œå·´å·´fastJSON
            String notLogin = JSONObject.toJSONString(error);
            resp.getWriter().write(notLogin);
            return;
        }

        //6.æ”¾è¡Œã€‚
        log.info("ä»¤ç‰Œåˆæ³•, æ”¾è¡Œ");
        chain.doFilter(request, response);
    }
}
```


#### 10.2.4 æ‹¦æˆªå™¨Interceptor

âœ… ç®€ä»‹

+ æ¦‚å¿µï¼šæ˜¯ä¸€ç§åŠ¨æ€æ‹¦æˆªæ–¹æ³•è°ƒç”¨çš„æœºåˆ¶ï¼Œç±»ä¼¼äºè¿‡æ»¤å™¨ã€‚Springæ¡†æ¶ä¸­æä¾›çš„ï¼Œç”¨æ¥åŠ¨æ€æ‹¦æˆªæ§åˆ¶å™¨æ–¹æ³•çš„æ‰§è¡Œã€‚

+ ä½œç”¨ï¼šæ‹¦æˆªè¯·æ±‚ï¼Œåœ¨æŒ‡å®šçš„æ–¹æ³•è°ƒç”¨å‰åï¼Œæ ¹æ®ä¸šåŠ¡éœ€è¦æ‰§è¡Œé¢„å…ˆè®¾å®šçš„ä»£ç ã€‚

âœ… å¿«é€Ÿå…¥é—¨

![](./å›¾ç‰‡/springboot-filter4.png)

å®šä¹‰ç±»å®ç°ï¼š

```java
@Slf4j
@Component
public class LoginCheckInterceptor implements HandlerInterceptor {
    @Override //ç›®æ ‡èµ„æºæ–¹æ³•è¿è¡Œå‰è¿è¡Œ, è¿”å›true: æ”¾è¡Œ, æ”¾å›false, ä¸æ”¾è¡Œ
    public boolean preHandle(HttpServletRequest req, HttpServletResponse resp, Object handler) throws Exception {
        //1.è·å–è¯·æ±‚urlã€‚
        String url = req.getRequestURL().toString();
        log.info("è¯·æ±‚çš„url: {}",url);

        //2.åˆ¤æ–­è¯·æ±‚urlä¸­æ˜¯å¦åŒ…å«loginï¼Œå¦‚æœåŒ…å«ï¼Œè¯´æ˜æ˜¯ç™»å½•æ“ä½œï¼Œæ”¾è¡Œã€‚
        if(url.contains("login")){
            log.info("ç™»å½•æ“ä½œ, æ”¾è¡Œ...");
            return true;
        }

        //3.è·å–è¯·æ±‚å¤´ä¸­çš„ä»¤ç‰Œï¼ˆtokenï¼‰ã€‚
        String jwt = req.getHeader("token");

        //4.åˆ¤æ–­ä»¤ç‰Œæ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯ç»“æœï¼ˆæœªç™»å½•ï¼‰ã€‚
        if(!StringUtils.hasLength(jwt)){
            log.info("è¯·æ±‚å¤´tokenä¸ºç©º,è¿”å›æœªç™»å½•çš„ä¿¡æ¯");
            Result error = Result.error("NOT_LOGIN");
            //æ‰‹åŠ¨è½¬æ¢ å¯¹è±¡--json --------> é˜¿é‡Œå·´å·´fastJSON
            String notLogin = JSONObject.toJSONString(error);
            resp.getWriter().write(notLogin);
            return false;
        }

        //5.è§£ætokenï¼Œå¦‚æœè§£æå¤±è´¥ï¼Œè¿”å›é”™è¯¯ç»“æœï¼ˆæœªç™»å½•ï¼‰ã€‚
        try {
            JwtUtils.parseJWT(jwt);
        } catch (Exception e) {//jwtè§£æå¤±è´¥
            e.printStackTrace();
            log.info("è§£æä»¤ç‰Œå¤±è´¥, è¿”å›æœªç™»å½•é”™è¯¯ä¿¡æ¯");
            Result error = Result.error("NOT_LOGIN");
            //æ‰‹åŠ¨è½¬æ¢ å¯¹è±¡--json --------> é˜¿é‡Œå·´å·´fastJSON
            String notLogin = JSONObject.toJSONString(error);
            resp.getWriter().write(notLogin);
            return false;
        }

        //6.æ”¾è¡Œã€‚
        log.info("ä»¤ç‰Œåˆæ³•, æ”¾è¡Œ");
        return true;
    }

    @Override //ç›®æ ‡èµ„æºæ–¹æ³•è¿è¡Œåè¿è¡Œ
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
        System.out.println("postHandle ...");
    }

    @Override //è§†å›¾æ¸²æŸ“å®Œæ¯•åè¿è¡Œ, æœ€åè¿è¡Œ
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {
        System.out.println("afterCompletion...");
    }
}
```

å®šä¹‰é…ç½®é¡¹ï¼š

```java
@Configuration //é…ç½®ç±»
public class WebConfig implements WebMvcConfigurer {

    @Autowired
    private LoginCheckInterceptor loginCheckInterceptor;

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(loginCheckInterceptor)
                .addPathPatterns("/**")
                .excludePathPatterns("/login");
    }
}
```

âœ… æ‹¦æˆªå™¨-æ‹¦æˆªè·¯å¾„

![](./å›¾ç‰‡/springboot-filter5.png)

![](./å›¾ç‰‡/springboot-filter6.png)

âœ… ç™»å½•æ ¡éªŒ- Interceptor

![](./å›¾ç‰‡/springboot-Interceptor1.png)



### 10.3 å¼‚å¸¸å¤„ç†

è§£å†³æ–¹æ¡ˆï¼šå…¨å±€å¼‚å¸¸å¤„ç†å™¨

ç”±äºå¼‚å¸¸çš„å¤„ç†å¦‚æœä¸å¤„ç†ä¼šä»ä¸‹å¾€ä¸ŠæŠ›å‡ºï¼Œæ‰€ä»¥éƒ½åœ¨å¼‚å¸¸å¤„ç†å™¨è¿™é‡Œè¿›è¡Œå¤„ç†ï¼›

![](./å›¾ç‰‡/springboot-exception1.png)

ä¸»è¦ï¼š

+ @RestControllerAdvice = @ControllerAdvice + @ResponseBody
+ @ExceptionHandler æ•è·é‚£äº›å¼‚å¸¸

```java
@RestControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(Exception.class)//æ•è·æ‰€æœ‰å¼‚å¸¸
    public Result ex(Exception ex){
        ex.printStackTrace();
        return Result.error("å¯¹ä¸èµ·,æ“ä½œå¤±è´¥,è¯·è”ç³»ç®¡ç†å‘˜");
    }

}
```

## 11. AOP  

### 11.1 Springäº‹åŠ¡ç®¡ç†

![](./å›¾ç‰‡/springboot-transactional1.png)

âœ… äº‹åŠ¡è¿›é˜¶

é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰å‡ºç° RuntimeException æ‰å›æ»šå¼‚å¸¸ã€‚rollbackForå±æ€§ç”¨äºæ§åˆ¶å‡ºç°ä½•ç§å¼‚å¸¸ç±»å‹ï¼Œå›æ»šäº‹åŠ¡ã€‚

```java
@Transactional(rollbackFor = Exception.class)
@DeleteMapping("/{id}")
public Result delete(@PathVariable Integer id) {
    // åˆ é™¤éƒ¨é—¨
    deptService.delete(id);
        int a = 1/0;
    // åˆ é™¤éƒ¨é—¨ä¸‹çš„å‘˜å·¥
    emptService.deleteByDeptId(id);

    return Result.success();
}
```

äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼šæŒ‡çš„å°±æ˜¯å½“ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•è¢«å¦ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªäº‹åŠ¡æ–¹æ³•åº”è¯¥å¦‚ä½•è¿›è¡Œäº‹åŠ¡æ§åˆ¶ã€‚

![](./å›¾ç‰‡/springboot-transactional2.png)


### 11.2 AOP åŸºç¡€

AOPï¼šAspect Oriented Programmingï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ã€é¢å‘æ–¹é¢ç¼–ç¨‹ï¼‰ï¼Œå…¶å®å°±æ˜¯é¢å‘ç‰¹å®šæ–¹æ³•ç¼–ç¨‹ï¼›

ğŸ§  ä¸ºä»€ä¹ˆéœ€è¦ AOPï¼Ÿ

å‡è®¾ä½ è¦åœ¨å¤šä¸ªæœåŠ¡æ–¹æ³•ä¸­æ·»åŠ æ—¥å¿—ï¼š

```java
public void addUser() {
    System.out.println("æ·»åŠ æ—¥å¿—...");
    // æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
}
public void deleteUser() {
    System.out.println("æ·»åŠ æ—¥å¿—...");
    // æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
}
```

â¡ï¸ é‡å¤ä»£ç å¤ªå¤šï¼Œä¸åˆ©äºç»´æŠ¤ã€‚

AOP å°±æ˜¯ä¸ºäº†è§£è€¦è¿™ç±»â€œæ¨ªåˆ‡å…³æ³¨ç‚¹â€ï¼ˆæ—¥å¿—ã€äº‹åŠ¡ã€å®‰å…¨éªŒè¯ç­‰ï¼‰å’Œâ€œæ ¸å¿ƒä¸šåŠ¡é€»è¾‘â€ã€‚

ğŸ§© AOP çš„æ ¸å¿ƒæ¦‚å¿µ

| æœ¯è¯­        | å«ä¹‰ |
|-------------|------|
| **åˆ‡é¢ï¼ˆAspectï¼‰**       | æ¨ªåˆ‡é€»è¾‘çš„æ¨¡å—ï¼Œæ¯”å¦‚â€œæ—¥å¿—åˆ‡é¢â€ã€â€œäº‹åŠ¡åˆ‡é¢â€ |
| **è¿æ¥ç‚¹ï¼ˆJoinPointï¼‰** | ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­å¯ä»¥æ’å…¥æ¨ªåˆ‡é€»è¾‘çš„ç‚¹ï¼Œæ¯”å¦‚æ–¹æ³•è°ƒç”¨ã€å¼‚å¸¸æŠ›å‡ºç­‰ |
| **åˆ‡å…¥ç‚¹ï¼ˆPointcutï¼‰**   | æè¿°å“ªäº›è¿æ¥ç‚¹ä¼šè¢«ç»‡å…¥ï¼Œæ¯”å¦‚æŒ‡å®šæŸäº›åŒ…ä¸‹çš„æ‰€æœ‰æ–¹æ³• |
| **é€šçŸ¥ï¼ˆAdviceï¼‰**       | å®é™…è¦ç»‡å…¥çš„ä»£ç ï¼Œæ¯”å¦‚æ—¥å¿—æ‰“å°ï¼Œå¯ä»¥æ˜¯â€œå‰ç½®é€šçŸ¥â€ã€â€œåç½®é€šçŸ¥â€ã€â€œå¼‚å¸¸é€šçŸ¥â€ç­‰ |
| **ç»‡å…¥ï¼ˆWeavingï¼‰**      | æŠŠé€šçŸ¥åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡çš„è¿‡ç¨‹ï¼ˆè¿è¡Œæ—¶æˆ–ç¼–è¯‘æ—¶ï¼‰ |

![](./å›¾ç‰‡/springboot-aop1.png )

ğŸ“Œ Spring AOP å¸¸ç”¨æ³¨è§£

Spring AOP æ˜¯åŸºäºåŠ¨æ€ä»£ç†å®ç°çš„ï¼Œå¸¸ç”¨æ³¨è§£åŒ…æ‹¬ï¼š

```java
@Aspect            // å£°æ˜ä¸€ä¸ªåˆ‡é¢ç±»
@Component         // äº¤ç»™ Spring å®¹å™¨ç®¡ç†

@Before            // å‰ç½®é€šçŸ¥ï¼ˆåœ¨æ–¹æ³•æ‰§è¡Œå‰æ‰§è¡Œï¼‰
@AfterReturning    // åç½®é€šçŸ¥ï¼ˆæ–¹æ³•æˆåŠŸè¿”å›åï¼‰
@AfterThrowing     // å¼‚å¸¸é€šçŸ¥ï¼ˆæ–¹æ³•æŠ›å‡ºå¼‚å¸¸åï¼‰
@After             // æœ€ç»ˆé€šçŸ¥ï¼ˆæ— è®ºæ˜¯å¦å¼‚å¸¸éƒ½ä¼šæ‰§è¡Œï¼‰
@Around            // ç¯ç»•é€šçŸ¥ï¼ˆæ–¹æ³•å‰åéƒ½èƒ½æ’å…¥é€»è¾‘ï¼‰
```

```java
@Slf4j
@Component
@Aspect
public class MyAspect1 {

    @Pointcut("execution(* com.itheima.service.impl.DeptServiceImpl.*(..))")
    public void pt(){}

    @Before("pt()")
    public void before(){
        log.info("before ...");
    }

    @Around("pt()")
    public Object around(ProceedingJoinPoint proceedingJoinPoint) throws Throwable {
        log.info("around before ...");

        //è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„åŸå§‹æ–¹æ³•æ‰§è¡Œ
        Object result = proceedingJoinPoint.proceed();

        log.info("around after ...");
        return result;
    }

    @After("pt()")
    public void after(){
        log.info("after ...");
    }

    @AfterReturning("pt()")
    public void afterReturning(){
        log.info("afterReturning ...");
    }

    @AfterThrowing("pt()")
    public void afterThrowing(){
        log.info("afterThrowing ...");
    }
}

``` 

execution(...) è¡¨è¾¾å¼çš„è¯­æ³•

```java
execution(ä¿®é¥°ç¬¦? è¿”å›å€¼ åŒ…å.ç±»å.æ–¹æ³•å(å‚æ•°) å¼‚å¸¸?)
```

å…¶ä¸­å¤§å¤šæ•°å¯ä»¥ç”¨ * ä½œä¸ºé€šé…ç¬¦ï¼š

| ç¬¦å·         | å«ä¹‰ |
|--------------|------|
| `*`          | ä»»æ„å€¼ï¼ˆä»»æ„è¿”å›å€¼ã€ä»»æ„æ–¹æ³•åç­‰ï¼‰ |
| `..`         | ä»»æ„å±‚çº§ã€ä»»æ„å‚æ•° |
| `+`          | è¡¨ç¤ºâ€œå½“å‰ç±»åŠå…¶å­ç±»â€æˆ–â€œæ¥å£åŠå…¶å®ç°ç±»â€ |


### 11.2.1 é€šçŸ¥é¡ºåº

1. é€šçŸ¥é¡ºåºå’Œç±»åçš„é¡ºåºç›¸å…³ï¼›

2. æˆ–è€…ç”¨ @Order(æ•°å­—) åŠ åœ¨åˆ‡é¢ç±»ä¸Šæ¥æ§åˆ¶é¡ºåº

+ ç›®æ ‡æ–¹æ³•å‰çš„é€šçŸ¥æ–¹æ³•ï¼šæ•°å­—å°çš„å…ˆæ‰§è¡Œ

+ ç›®æ ‡æ–¹æ³•åçš„é€šçŸ¥æ–¹æ³•ï¼Œæ•°å­—å°çš„åæ‰§è¡Œ

### 11.2.2 åˆ‡å…¥ç‚¹è¡¨è¾¾å¼

+ åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼šæè¿°åˆ‡å…¥ç‚¹æ–¹æ³•çš„ä¸€ç§è¡¨è¾¾å¼

+ ä½œç”¨ï¼šä¸»è¦ç”¨æ¥å†³å®šé¡¹ç›®ä¸­çš„å“ªäº›æ–¹æ³•éœ€è¦åŠ å…¥é€šçŸ¥

+ å¸¸è§å½¢å¼ï¼š
    + execution(â€¦â€¦)ï¼šæ ¹æ®æ–¹æ³•çš„ç­¾åæ¥åŒ¹é…
    + @annotation(â€¦â€¦) ï¼šæ ¹æ®æ³¨è§£åŒ¹é…

âœ… åˆ‡å…¥ç‚¹è¡¨è¾¾å¼-execution

execution ä¸»è¦æ ¹æ®æ–¹æ³•çš„è¿”å›å€¼ã€åŒ…åã€ç±»åã€æ–¹æ³•åã€æ–¹æ³•å‚æ•°ç­‰ä¿¡æ¯æ¥åŒ¹é…ï¼Œè¯­æ³•ä¸ºï¼š

```java
execution(è®¿é—®ä¿®é¥°ç¬¦?  è¿”å›å€¼  åŒ…å.ç±»å.?æ–¹æ³•å(æ–¹æ³•å‚æ•°) throws å¼‚å¸¸?)
```

+ å…¶ä¸­å¸¦ ? çš„è¡¨ç¤ºå¯ä»¥çœç•¥çš„éƒ¨åˆ†
    + è®¿é—®ä¿®é¥°ç¬¦ï¼šå¯çœç•¥ï¼ˆæ¯”å¦‚: publicã€protectedï¼‰
    + åŒ…å.ç±»åï¼š å¯çœç•¥
    + throws å¼‚å¸¸ï¼šå¯çœç•¥ï¼ˆæ³¨æ„æ˜¯æ–¹æ³•ä¸Šå£°æ˜æŠ›å‡ºçš„å¼‚å¸¸ï¼Œä¸æ˜¯å®é™…æŠ›å‡ºçš„å¼‚å¸¸ï¼‰

+ * ï¼šå•ä¸ªç‹¬ç«‹çš„ä»»æ„ç¬¦å·ï¼Œå¯ä»¥é€šé…ä»»æ„è¿”å›å€¼ã€åŒ…åã€ç±»åã€æ–¹æ³•åã€ä»»æ„ç±»å‹çš„ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå¯ä»¥é€šé…åŒ…ã€ç±»ã€æ–¹æ³•åçš„ä¸€éƒ¨åˆ†

+ .. ï¼šå¤šä¸ªè¿ç»­çš„ä»»æ„ç¬¦å·ï¼Œå¯ä»¥é€šé…ä»»æ„å±‚çº§çš„åŒ…ï¼Œæˆ–ä»»æ„ç±»å‹ã€ä»»æ„ä¸ªæ•°çš„å‚æ•°
 

ğŸ¯ä¹¦å†™å»ºè®®

+ æ‰€æœ‰ä¸šåŠ¡æ–¹æ³•ååœ¨å‘½åæ—¶å°½é‡è§„èŒƒï¼Œæ–¹ä¾¿åˆ‡å…¥ç‚¹è¡¨è¾¾å¼å¿«é€ŸåŒ¹é…ã€‚å¦‚ï¼šæŸ¥è¯¢ç±»æ–¹æ³•éƒ½æ˜¯ find å¼€å¤´ï¼Œæ›´æ–°ç±»æ–¹æ³•éƒ½æ˜¯ updateå¼€å¤´ã€‚

+ æè¿°åˆ‡å…¥ç‚¹æ–¹æ³•é€šå¸¸åŸºäºæ¥å£æè¿°ï¼Œè€Œä¸æ˜¯ç›´æ¥æè¿°å®ç°ç±»ï¼Œå¢å¼ºæ‹“å±•æ€§ã€‚

+ åœ¨æ»¡è¶³ä¸šåŠ¡éœ€è¦çš„å‰æä¸‹ï¼Œå°½é‡ç¼©å°åˆ‡å…¥ç‚¹çš„åŒ¹é…èŒƒå›´ã€‚å¦‚ï¼šåŒ…ååŒ¹é…å°½é‡ä¸ä½¿ç”¨ ..ï¼Œä½¿ç”¨ * åŒ¹é…å•ä¸ªåŒ…ã€‚


âœ… åˆ‡å…¥ç‚¹è¡¨è¾¾å¼-@annotation

@annotation(æ³¨è§£ç±») è¡¨ç¤ºï¼šåŒ¹é…è¢«æŸä¸ªæ³¨è§£æ ‡æ³¨çš„æ–¹æ³•ã€‚

è¿™åœ¨æˆ‘ä»¬éœ€è¦æ ¹æ®æ³¨è§£æ¥å†³å®šæ˜¯å¦åº”ç”¨æŸäº›æ¨ªåˆ‡é€»è¾‘ï¼ˆå¦‚æƒé™æ£€æŸ¥ã€æ—¥å¿—è®°å½•ã€é™æµï¼‰æ—¶éå¸¸å¸¸ç”¨ã€‚

```java
@annotation(com.itheima.anno.Log)
```

âœ… ç¤ºä¾‹ï¼šåŒ¹é…å¸¦æŸä¸ªæ³¨è§£çš„æ–¹æ³•

1. å®šä¹‰è‡ªå®šä¹‰æ³¨è§£

```java
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface LogOperation {
    String value() default "";
}
```

2. æ ‡æ³¨åˆ°æŸä¸ªæ–¹æ³•ä¸Š

```java
@Service
public class UserService {
    
    @LogOperation("æ·»åŠ ç”¨æˆ·")
    public void addUser() {
        System.out.println("æ‰§è¡Œæ·»åŠ ç”¨æˆ·é€»è¾‘...");
    }
}
```

3. ä½¿ç”¨ @annotation å®šä¹‰åˆ‡ç‚¹

```java
@Aspect
@Component
public class LogAspect {

    // åˆ‡ç‚¹ï¼šæ‹¦æˆªæ‰€æœ‰ä½¿ç”¨ @LogOperation æ³¨è§£çš„æ–¹æ³•
    @Pointcut("@annotation(com.example.annotation.LogOperation)")
    public void logPointCut() {}

    @Before("logPointCut()")
    public void before(JoinPoint joinPoint) {
        System.out.println("æ‰§è¡Œäº† @LogOperation æ³¨è§£æ–¹æ³•ï¼");
    }
}
```

âœ… è·å–æ³¨è§£ä¸­çš„å€¼ï¼ˆå¢å¼ºç‰ˆï¼‰

```java
@Before("@annotation(logOperation)")
public void before(JoinPoint joinPoint, LogOperation logOperation) {
    System.out.println("æ³¨è§£å†…å®¹ï¼š" + logOperation.value());
}
```

æ³¨æ„ï¼šè¦åœ¨åˆ‡é¢æ–¹æ³•å‚æ•°ä¸­æ˜¾å¼åŠ ä¸Š æ³¨è§£åï¼ŒSpring ä¼šè‡ªåŠ¨æŠŠæ³¨è§£å¯¹è±¡æ³¨å…¥è¿›æ¥ã€‚

### 11.2.3 è¿æ¥ç‚¹

åœ¨Springä¸­ç”¨JoinPointæŠ½è±¡äº†è¿æ¥ç‚¹ï¼Œç”¨å®ƒå¯ä»¥è·å¾—æ–¹æ³•æ‰§è¡Œæ—¶çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚ç›®æ ‡ç±»åã€æ–¹æ³•åã€æ–¹æ³•å‚æ•°ç­‰

+ ProceedingJoinPoint
+ JoinPoint

![](./å›¾ç‰‡/springboot-aop3.png)

![](./å›¾ç‰‡/springboot-aop2.png)

 
### aop demo

ğŸŒ å°†æ¡ˆä¾‹ä¸­ å¢ã€åˆ ã€æ”¹ ç›¸å…³æ¥å£çš„æ“ä½œæ—¥å¿—è®°å½•åˆ°æ•°æ®åº“è¡¨ä¸­ã€‚

âœ… éœ€è¦å¯¹æ‰€æœ‰ä¸šåŠ¡ç±»ä¸­çš„å¢ã€åˆ ã€æ”¹ æ–¹æ³•æ·»åŠ ç»Ÿä¸€åŠŸèƒ½ï¼Œä½¿ç”¨ AOP æŠ€æœ¯æœ€ä¸ºæ–¹ä¾¿; @Around ç¯ç»•é€šçŸ¥

ç”±äºå¢ã€åˆ ã€æ”¹æ–¹æ³•åæ²¡æœ‰è§„å¾‹ï¼Œå¯ä»¥è‡ªå®šä¹‰ @Log æ³¨è§£å®Œæˆç›®æ ‡æ–¹æ³•åŒ¹é…ã€‚


1. å¯¼å…¥æ•°æ®ã€å®ä½“ç±»å’Œmapper æ¥å£

![](./å›¾ç‰‡/springboot-aopdemo1.png)

![](./å›¾ç‰‡/springboot-aopdemo1.png)
![](./å›¾ç‰‡/springboot-aopdemo2.png)

2. è‡ªå®šä¹‰æ³¨è§£

è¿™é‡Œçš„æ³¨è§£åªæ˜¯èµ·åˆ°æ ‡è¯†çš„ä½œç”¨ï¼Œæ‰€ä»¥ä¸éœ€è¦æˆå‘˜

![](./å›¾ç‰‡/springboot-aopdemo3.png)

3. å®šä¹‰åˆ‡é¢ç±»ï¼Œå®Œæˆè®°å½•æ“ä½œæ—¥å¿—çš„é€»è¾‘

![](./å›¾ç‰‡/springboot-aopdemo4.png)

ç„¶ååœ¨å‡½æ•°ä¸ŠåŠ å…¥ @Log æ³¨è§£å³å¯ï¼›

## 12. springboot åŸç†

é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§

.properties > .yml > .yaml

ä¸»æµï¼šyml;

### 12.1 Bean ç®¡ç†

âœ… è·å– bean å¯¹è±¡

![](./å›¾ç‰‡/springboot-bean1.png)

âœ… bean ä½œç”¨åŸŸ

![](./å›¾ç‰‡/springboot-bean2.png)

å¯ä»¥é€šè¿‡ @Scope æ³¨è§£è¿›è¡Œé…ç½®ä½œç”¨åŸŸï¼›
å¹¶ä¸”å¯ä»¥ä½¿ç”¨ @Lazy æ³¨è§£æ¥å»¶è¿Ÿåˆå§‹åŒ–ï¼›

![](./å›¾ç‰‡/springboot-bean3.png)

### 12.2 ç¬¬ä¸‰æ–¹ bean

å¦‚æœè¦ç®¡ç†çš„beanå¯¹è±¡æ¥è‡ªäºç¬¬ä¸‰æ–¹ï¼ˆä¸æ˜¯è‡ªå®šä¹‰çš„ï¼‰ï¼Œæ˜¯æ— æ³•ç”¨ @Component åŠè¡ç”Ÿæ³¨è§£å£°æ˜beançš„ï¼Œå°±éœ€è¦ç”¨åˆ° @Beanæ³¨è§£

![](./å›¾ç‰‡/springboot-bean4.png)

@Component åŠè¡ç”Ÿæ³¨è§£ ä¸ @Beanæ³¨è§£ä½¿ç”¨åœºæ™¯ï¼Ÿ

+ é¡¹ç›®ä¸­è‡ªå®šä¹‰çš„ï¼Œä½¿ç”¨@ComponentåŠå…¶è¡ç”Ÿæ³¨è§£
+ é¡¹ç›®ä¸­å¼•å…¥ç¬¬ä¸‰æ–¹çš„ï¼Œä½¿ç”¨@Beanæ³¨è§£

### 12.3 springboot åŸç†

+ èµ·æ­¥ä¾èµ–ï¼šmaveanä»¥æ¥ä¼ é€’

+ è‡ªåŠ¨é…ç½®ï¼šSpringBootçš„è‡ªåŠ¨é…ç½®å°±æ˜¯å½“springå®¹å™¨å¯åŠ¨åï¼Œä¸€äº›é…ç½®ç±»ã€beanå¯¹è±¡å°±è‡ªåŠ¨å­˜å…¥åˆ°äº†IOCå®¹å™¨ä¸­ï¼Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»å£°æ˜ï¼Œä»è€Œç®€åŒ–äº†å¼€å‘ï¼Œçœå»äº†ç¹ççš„é…ç½®æ“ä½œã€‚

#### è‡ªåŠ¨é…ç½® åŸç†


## 13. Maven

### 13.1 åˆ†æ¨¡å—è®¾è®¡ä¸å¼€å‘

![](./å›¾ç‰‡/springboot-maven1.png)

æŠŠä¹‹å‰çš„ä»£ç æ‹†åˆ†æˆå„ä¸ªæ¨¡å—ï¼Œè¿™æ ·å¯ä»¥å…±ç»™ä»–äººä½¿ç”¨ï¼›

1. é¦–å…ˆæ–°å»ºæ¨¡å—ï¼ŒæŠŠ pojo çš„ä¸œè¥¿æ”¾åˆ°æ–°æ¨¡å—ä¸­

2. ç„¶ååœ¨æ¨¡å—ä¸­åŠ è½½å³å¯

### 13.2 ç»§æ‰¿ä¸èšåˆ

é€šè¿‡parent ï¼Œç®¡ç†åŒ…ï¼›æ³¨æ„ï¼Œæ‰“åŒ…æ–¹å¼ä¸º pomï¼›

![](./å›¾ç‰‡/springboot-jicheng1.png)

![](./å›¾ç‰‡/springboot-jicheng2.png)


ç‰ˆæœ¬é”å®šï¼šåœ¨mavenä¸­ï¼Œå¯ä»¥åœ¨çˆ¶å·¥ç¨‹çš„pomæ–‡ä»¶ä¸­é€šè¿‡ < dependencyManagement > æ¥ç»Ÿä¸€ç®¡ç†ä¾èµ–ç‰ˆæœ¬ã€‚

![](./å›¾ç‰‡/springboot-jicheng3.png)


âœ… èšåˆ

![](./å›¾ç‰‡/springboot-juhe1.png)

ä½¿ç”¨ï¼š

![](./å›¾ç‰‡/springboot-juhe2.png)

### 13.3 ç§æœ

![](./å›¾ç‰‡/springboot-sifu1.png)




 














