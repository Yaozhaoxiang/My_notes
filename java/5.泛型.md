# ä»€ä¹ˆæ˜¯æ³›å‹

1. ä»€ä¹ˆæ˜¯æ³›å‹
2. ä½¿ç”¨æ³›å‹
3. ç¼–å†™æ³›å‹
4. æ“¦æ‹­æ³•
5. extendsé€šé…ç¬¦
6. superé€šé…ç¬¦
7. æ³›å‹å’Œåå°„

æŠ„è‡ª:https://liaoxuefeng.com/books/java/generics/use-generics/index.html

Java ä¸­çš„ æ³›å‹ï¼ˆGenericsï¼‰ å’Œ C++ ä¸­çš„ æ¨¡æ¿ï¼ˆTemplatesï¼‰ ç¡®å®æœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ã€‚å®ƒä»¬éƒ½æ˜¯ å‚æ•°åŒ–ç±»å‹ çš„æœºåˆ¶ï¼Œå…è®¸ä½ ç¼–å†™æ›´åŠ é€šç”¨çš„ä»£ç ï¼Œåœ¨ä¿æŒç±»å‹å®‰å…¨çš„åŒæ—¶ï¼Œæé«˜ä»£ç çš„å¤ç”¨æ€§ã€‚è™½ç„¶å®ƒä»¬çš„å®ç°æ–¹å¼å’Œåº•å±‚æœºåˆ¶ä¸åŒï¼Œä½†æ¦‚å¿µæ˜¯ç›¸ä¼¼çš„ã€‚

## ğŸ§© 1ã€åŸºæœ¬æ¦‚å¿µï¼šä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿ

Java ä¸­çš„æ³›å‹å…è®¸ä½ åœ¨ç¼–å†™ç±»ã€æ¥å£ã€æ–¹æ³•æ—¶ï¼Œä¸æŒ‡å®šå…·ä½“çš„ç±»å‹ï¼Œè€Œæ˜¯é€šè¿‡å ä½ç¬¦ï¼ˆé€šå¸¸æ˜¯å­—æ¯ Tã€Eã€K ç­‰ï¼‰æ¥ä»£æ›¿ã€‚

```java
// å®šä¹‰ä¸€ä¸ªæ³›å‹ç±»
class Box<T> {
    private T value;

    public T getValue() {
        return value;
    }

    public void setValue(T value) {
        this.value = value;
    }
}

// ä½¿ç”¨æ³›å‹ç±»
Box<Integer> box = new Box<>();
box.setValue(42);
int value = box.getValue(); // è‡ªåŠ¨ç±»å‹æ¨å¯¼
```

ğŸ“¦ ä¸ C++ æ¨¡æ¿çš„ç›¸ä¼¼æ€§

![](./å›¾ç‰‡/java_96.png)

```cpp
template <typename T>
class Box {
public:
    T value;
    T getValue() { return value; }
    void setValue(T value) { this->value = value; }
};

// ä½¿ç”¨æ¨¡æ¿ç±»
Box<int> box;
box.setValue(42);
int value = box.getValue();
```

### å‘ä¸Šè½¬å‹

åœ¨Javaæ ‡å‡†åº“ä¸­çš„ArrayList<T>å®ç°äº†List<T>æ¥å£ï¼Œå®ƒå¯ä»¥å‘ä¸Šè½¬å‹ä¸ºList<T>ï¼š

```java
public class ArrayList<T> implements List<T> {
    ...
}

List<String> list = new ArrayList<String>();
```

å³ç±»å‹ArrayList<T>å¯ä»¥å‘ä¸Šè½¬å‹ä¸ºList<T>ã€‚

è¦ç‰¹åˆ«æ³¨æ„ï¼šä¸èƒ½æŠŠArrayList<Integer>å‘ä¸Šè½¬å‹ä¸ºArrayList<Number>æˆ–List<Number>ã€‚

è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå‡è®¾ArrayList<Integer>å¯ä»¥å‘ä¸Šè½¬å‹ä¸ºArrayList<Number>ï¼Œè§‚å¯Ÿä¸€ä¸‹ä»£ç ï¼š

```java
// åˆ›å»ºArrayList<Integer>ç±»å‹ï¼š
ArrayList<Integer> integerList = new ArrayList<Integer>();
// æ·»åŠ ä¸€ä¸ªIntegerï¼š
integerList.add(new Integer(123));
// â€œå‘ä¸Šè½¬å‹â€ä¸ºArrayList<Number>ï¼š
ArrayList<Number> numberList = integerList;
// æ·»åŠ ä¸€ä¸ªFloatï¼Œå› ä¸ºFloatä¹Ÿæ˜¯Numberï¼š
numberList.add(new Float(12.34));
// ä»ArrayList<Integer>è·å–ç´¢å¼•ä¸º1çš„å…ƒç´ ï¼ˆå³æ·»åŠ çš„Floatï¼‰ï¼š
Integer n = integerList.get(1); // ClassCastException!
```

æˆ‘ä»¬æŠŠä¸€ä¸ªArrayList<Integer>è½¬å‹ä¸ºArrayList<Number>ç±»å‹åï¼Œè¿™ä¸ªArrayList<Number>å°±å¯ä»¥æ¥å—Floatç±»å‹ï¼Œå› ä¸ºFloatæ˜¯Numberçš„å­ç±»ã€‚ä½†æ˜¯ï¼ŒArrayList<Number>å®é™…ä¸Šå’ŒArrayList<Integer>æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯ArrayList<Integer>ç±»å‹ï¼Œå®ƒä¸å¯èƒ½æ¥å—Floatç±»å‹ï¼Œ æ‰€ä»¥åœ¨è·å–Integerçš„æ—¶å€™å°†äº§ç”ŸClassCastExceptionã€‚

å®é™…ä¸Šï¼Œç¼–è¯‘å™¨ä¸ºäº†é¿å…è¿™ç§é”™è¯¯ï¼Œæ ¹æœ¬å°±ä¸å…è®¸æŠŠArrayList<Integer>è½¬å‹ä¸ºArrayList<Number>ã€‚

## 2. ä½¿ç”¨æ³›å‹

ä½¿ç”¨ArrayListæ—¶ï¼Œå¦‚æœä¸å®šä¹‰æ³›å‹ç±»å‹æ—¶ï¼Œæ³›å‹ç±»å‹å®é™…ä¸Šå°±æ˜¯Objectï¼š

```java
// ç¼–è¯‘å™¨è­¦å‘Š:
List list = new ArrayList();
list.add("Hello");
list.add("World");
String first = (String) list.get(0);
String second = (String) list.get(1);
```

æ­¤æ—¶ï¼Œåªèƒ½æŠŠ<T>å½“ä½œObjectä½¿ç”¨ï¼Œæ²¡æœ‰å‘æŒ¥æ³›å‹çš„ä¼˜åŠ¿ã€‚

å½“æˆ‘ä»¬å®šä¹‰æ³›å‹ç±»å‹<String>åï¼ŒList<T>çš„æ³›å‹æ¥å£å˜ä¸ºå¼ºç±»å‹List<String>ï¼š

```java
// æ— ç¼–è¯‘å™¨è­¦å‘Š:
List<String> list = new ArrayList<String>();
list.add("Hello");
list.add("World");
// æ— å¼ºåˆ¶è½¬å‹:
String first = list.get(0);
String second = list.get(1);
```

å½“æˆ‘ä»¬å®šä¹‰æ³›å‹ç±»å‹<Number>åï¼ŒList<T>çš„æ³›å‹æ¥å£å˜ä¸ºå¼ºç±»å‹List<Number>ï¼š
```java
List<Number> list = new ArrayList<Number>();
list.add(new Integer(123));
list.add(new Double(12.34));
Number first = list.get(0);
Number second = list.get(1);
```

ç¼–è¯‘å™¨å¦‚æœèƒ½è‡ªåŠ¨æ¨æ–­å‡ºæ³›å‹ç±»å‹ï¼Œå°±å¯ä»¥çœç•¥åé¢çš„æ³›å‹ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸‹é¢çš„ä»£ç ï¼š

```java
List<Number> list = new ArrayList<Number>();
```

ç¼–è¯‘å™¨çœ‹åˆ°æ³›å‹ç±»å‹List<Number>å°±å¯ä»¥è‡ªåŠ¨æ¨æ–­å‡ºåé¢çš„ArrayList<T>çš„æ³›å‹ç±»å‹å¿…é¡»æ˜¯ArrayList<Number>ï¼Œå› æ­¤ï¼Œå¯ä»¥æŠŠä»£ç ç®€å†™ä¸ºï¼š

```java
// å¯ä»¥çœç•¥åé¢çš„Numberï¼Œç¼–è¯‘å™¨å¯ä»¥è‡ªåŠ¨æ¨æ–­æ³›å‹ç±»å‹ï¼š
List<Number> list = new ArrayList<>();
```

æ³›å‹æ¥å£
é™¤äº†ArrayList<T>ä½¿ç”¨äº†æ³›å‹ï¼Œè¿˜å¯ä»¥åœ¨æ¥å£ä¸­ä½¿ç”¨æ³›å‹ã€‚ä¾‹å¦‚ï¼ŒArrays.sort(Object[])å¯ä»¥å¯¹ä»»æ„æ•°ç»„è¿›è¡Œæ’åºï¼Œä½†å¾…æ’åºçš„å…ƒç´ å¿…é¡»å®ç°Comparable<T>è¿™ä¸ªæ³›å‹æ¥å£ï¼š

```cpp
public interface Comparable<T> {
    /**
     * è¿”å›è´Ÿæ•°: å½“å‰å®ä¾‹æ¯”å‚æ•°oå°
     * è¿”å›0: å½“å‰å®ä¾‹ä¸å‚æ•°oç›¸ç­‰
     * è¿”å›æ­£æ•°: å½“å‰å®ä¾‹æ¯”å‚æ•°oå¤§
     */
    int compareTo(T o);
}
```

å¯ä»¥ç›´æ¥å¯¹Stringæ•°ç»„è¿›è¡Œæ’åºï¼š
```java
// sort
import java.util.Arrays;

public class Main {
    public static void main(String[] args) {
        String[] ss = new String[] { "Orange", "Apple", "Pear" };
        Arrays.sort(ss);
        System.out.println(Arrays.toString(ss));
    }
}
```

è¿™æ˜¯å› ä¸ºStringæœ¬èº«å·²ç»å®ç°äº†Comparable<String>æ¥å£ã€‚å¦‚æœæ¢æˆæˆ‘ä»¬è‡ªå®šä¹‰çš„Personç±»å‹è¯•è¯•ï¼š

```java
// sort
import java.util.Arrays;

public class Main {
    public static void main(String[] args) {
        Person[] ps = new Person[] {
            new Person("Bob", 61),
            new Person("Alice", 88),
            new Person("Lily", 75),
        };
        Arrays.sort(ps);
        System.out.println(Arrays.toString(ps));
    }
}


class Person implements Comparable<Person> {
    String name;
    int score;
    Person(String name, int score) {
        this.name = name;
        this.score = score;
    }

    public int compareTo(Person other) {
        return this.name.compareTo(other.name);
    }

    public String toString() {
        return this.name + "," + this.score;
    }
}

```

## 3. ç¼–å†™æ³›å‹

å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ¥ç¼–å†™ä¸€ä¸ªæ³›å‹ç±»ã€‚

é¦–å…ˆï¼ŒæŒ‰ç…§æŸç§ç±»å‹ï¼Œä¾‹å¦‚ï¼šStringï¼Œæ¥ç¼–å†™ç±»ï¼š
```java
public class Pair {
    private String first;
    private String last;
    public Pair(String first, String last) {
        this.first = first;
        this.last = last;
    }
    public String getFirst() {
        return first;
    }
    public String getLast() {
        return last;
    }
}
```

ç„¶åï¼Œæ ‡è®°æ‰€æœ‰çš„ç‰¹å®šç±»å‹ï¼Œè¿™é‡Œæ˜¯Stringï¼ŒæŠŠç‰¹å®šç±»å‹Stringæ›¿æ¢ä¸ºTï¼Œå¹¶ç”³æ˜<T>ï¼š

```java
public class Pair<T> {
    private T first;
    private T last;
    public Pair(T first, T last) {
        this.first = first;
        this.last = last;
    }
    public T getFirst() {
        return first;
    }
    public T getLast() {
        return last;
    }
}
```

é™æ€æ–¹æ³•
ç¼–å†™æ³›å‹ç±»æ—¶ï¼Œè¦ç‰¹åˆ«æ³¨æ„ï¼Œæ³›å‹ç±»å‹<T>ä¸èƒ½ç”¨äºé™æ€æ–¹æ³•ã€‚ä¾‹å¦‚ï¼š
```java
public class Pair<T> {
    private T first;
    private T last;
    public Pair(T first, T last) {
        this.first = first;
        this.last = last;
    }
    public T getFirst() { ... }
    public T getLast() { ... }

    // å¯¹é™æ€æ–¹æ³•ä½¿ç”¨<T>:
    public static Pair<T> create(T first, T last) {
        return new Pair<T>(first, last);
    }
}
```

ä¸Šè¿°ä»£ç ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ï¼Œæˆ‘ä»¬æ— æ³•åœ¨é™æ€æ–¹æ³•create()çš„æ–¹æ³•å‚æ•°å’Œè¿”å›ç±»å‹ä¸Šä½¿ç”¨æ³›å‹ç±»å‹Tã€‚
è¿™æ˜¯å› ä¸ºæ³›å‹ç±»å‹å‚æ•°çš„ä½œç”¨åŸŸä»…é™äºç±»çš„å®ä¾‹çº§åˆ«ï¼Œè€Œé™æ€æ–¹æ³•å±äºç±»çº§åˆ«ï¼Œä¸å…·ä½“çš„å®ä¾‹æ— å…³ã€‚

å¯ä»¥åœ¨staticä¿®é¥°ç¬¦åé¢åŠ ä¸€ä¸ª<T>ï¼Œç¼–è¯‘å°±èƒ½é€šè¿‡ï¼š

```java
public class Pair<T> {
    private T first;
    private T last;
    public Pair(T first, T last) {
        this.first = first;
        this.last = last;
    }
    public T getFirst() { ... }
    public T getLast() { ... }

    // å¯ä»¥ç¼–è¯‘é€šè¿‡:
    public static <T> Pair<T> create(T first, T last) {
        return new Pair<T>(first, last);
    }
}
```

ä½†å®é™…ä¸Šï¼Œè¿™ä¸ª<T>å’ŒPair<T>ç±»å‹çš„<T>å·²ç»æ²¡æœ‰ä»»ä½•å…³ç³»äº†ã€‚

å¯¹äºé™æ€æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å•ç‹¬æ”¹å†™ä¸ºâ€œæ³›å‹â€æ–¹æ³•ï¼Œåªéœ€è¦ä½¿ç”¨å¦ä¸€ä¸ªç±»å‹å³å¯ã€‚å¯¹äºä¸Šé¢çš„create()é™æ€æ–¹æ³•ï¼Œæˆ‘ä»¬åº”è¯¥æŠŠå®ƒæ”¹ä¸ºå¦ä¸€ç§æ³›å‹ç±»å‹ï¼Œä¾‹å¦‚ï¼Œ<K>ï¼š

```java
public class Pair<T> {
    private T first;
    private T last;
    public Pair(T first, T last) {
        this.first = first;
        this.last = last;
    }
    public T getFirst() { ... }
    public T getLast() { ... }

    // é™æ€æ³›å‹æ–¹æ³•åº”è¯¥ä½¿ç”¨å…¶ä»–ç±»å‹åŒºåˆ†:
    public static <K> Pair<K> create(K first, K last) {
        return new Pair<K>(first, last);
    }
}
```

> å¤šä¸ªæ³›å‹ç±»å‹

æ³›å‹è¿˜å¯ä»¥å®šä¹‰å¤šç§ç±»å‹ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¸Œæœ›Pairä¸æ€»æ˜¯å­˜å‚¨ä¸¤ä¸ªç±»å‹ä¸€æ ·çš„å¯¹è±¡ï¼Œå°±å¯ä»¥ä½¿ç”¨ç±»å‹<T, K>ï¼š

```java
public class Pair<T, K> {
    private T first;
    private K last;
    public Pair(T first, K last) {
        this.first = first;
        this.last = last;
    }
    public T getFirst() { ... }
    public K getLast() { ... }
}
```

ä½¿ç”¨çš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å‡ºä¸¤ç§ç±»å‹ï¼š

```java
Pair<String, Integer> p = new Pair<>("test", 123);
```

Javaæ ‡å‡†åº“çš„Map<K, V>å°±æ˜¯ä½¿ç”¨ä¸¤ç§æ³›å‹ç±»å‹çš„ä¾‹å­ã€‚å®ƒå¯¹Keyä½¿ç”¨ä¸€ç§ç±»å‹ï¼Œå¯¹Valueä½¿ç”¨å¦ä¸€ç§ç±»å‹ã€‚

## 4. æ“¦æ‹­æ³•

æ³›å‹æ˜¯ä¸€ç§ç±»ä¼¼â€æ¨¡æ¿ä»£ç â€œçš„æŠ€æœ¯ï¼Œä¸åŒè¯­è¨€çš„æ³›å‹å®ç°æ–¹å¼ä¸ä¸€å®šç›¸åŒã€‚

Javaè¯­è¨€çš„æ³›å‹å®ç°æ–¹å¼æ˜¯æ“¦æ‹­æ³•ï¼ˆType Erasureï¼‰ã€‚å®ƒæ˜¯ Java ä¸ºäº†å®ç° å‘åå…¼å®¹æ€§ï¼ˆå’Œæ—§ç‰ˆæœ¬ JVM å…¼å®¹ï¼‰ è€Œé‡‡ç”¨çš„ç­–ç•¥ã€‚

æ‰€è°“æ“¦æ‹­æ³•æ˜¯æŒ‡ï¼Œè™šæ‹Ÿæœºå¯¹æ³›å‹å…¶å®ä¸€æ— æ‰€çŸ¥ï¼Œæ‰€æœ‰çš„å·¥ä½œéƒ½æ˜¯ç¼–è¯‘å™¨åšçš„ã€‚Java ç¼–è¯‘å™¨åœ¨ç¼–è¯‘å¸¦æœ‰æ³›å‹çš„ä»£ç æ—¶ï¼Œä¼šåœ¨ç¼–è¯‘å ç§»é™¤æ³›å‹ç±»å‹ä¿¡æ¯ï¼Œå¹¶æ›¿æ¢ä¸º é™å®šçš„ç±»å‹ï¼ˆé€šå¸¸æ˜¯ Object æˆ–ç±»å‹è¾¹ç•Œï¼‰ã€‚

ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªæ³›å‹ç±»Pair<T>ï¼Œè¿™æ˜¯ç¼–è¯‘å™¨çœ‹åˆ°çš„ä»£ç ï¼š

```java
public class Pair<T> {
    private T first;
    private T last;
    public Pair(T first, T last) {
        this.first = first;
        this.last = last;
    }
    public T getFirst() {
        return first;
    }
    public T getLast() {
        return last;
    }
}
```

è€Œè™šæ‹Ÿæœºæ ¹æœ¬ä¸çŸ¥é“æ³›å‹ã€‚è¿™æ˜¯è™šæ‹Ÿæœºæ‰§è¡Œçš„ä»£ç ï¼š

```java
public class Pair {
    private Object first;
    private Object last;
    public Pair(Object first, Object last) {
        this.first = first;
        this.last = last;
    }
    public Object getFirst() {
        return first;
    }
    public Object getLast() {
        return last;
    }
}
```

å› æ­¤ï¼ŒJavaä½¿ç”¨æ“¦æ‹­æ³•å®ç°æ³›å‹ï¼Œå¯¼è‡´äº†ï¼š

+ ç¼–è¯‘å™¨æŠŠç±»å‹<T>è§†ä¸ºObjectï¼›
+ ç¼–è¯‘å™¨æ ¹æ®<T>å®ç°å®‰å…¨çš„å¼ºåˆ¶è½¬å‹ã€‚

ä½¿ç”¨æ³›å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç¼–å†™çš„ä»£ç ä¹Ÿæ˜¯ç¼–è¯‘å™¨çœ‹åˆ°çš„ä»£ç ï¼š

```java
Pair<String> p = new Pair<>("Hello", "world");
String first = p.getFirst();
String last = p.getLast();
```

è€Œè™šæ‹Ÿæœºæ‰§è¡Œçš„ä»£ç å¹¶æ²¡æœ‰æ³›å‹ï¼š
```java
Pair p = new Pair("Hello", "world");
String first = (String) p.getFirst();
String last = (String) p.getLast();
```

æ‰€ä»¥ï¼ŒJavaçš„æ³›å‹æ˜¯ç”±ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶å®è¡Œçš„ï¼Œç¼–è¯‘å™¨å†…éƒ¨æ°¸è¿œæŠŠæ‰€æœ‰ç±»å‹Tè§†ä¸ºObjectå¤„ç†ï¼Œä½†æ˜¯ï¼Œåœ¨éœ€è¦è½¬å‹çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®Tçš„ç±»å‹è‡ªåŠ¨ä¸ºæˆ‘ä»¬å®è¡Œå®‰å…¨åœ°å¼ºåˆ¶è½¬å‹ã€‚

å±€é™ä¸€ï¼š<T>ä¸èƒ½æ˜¯åŸºæœ¬ç±»å‹ï¼Œä¾‹å¦‚intï¼Œå› ä¸ºå®é™…ç±»å‹æ˜¯Objectï¼ŒObjectç±»å‹æ— æ³•æŒæœ‰åŸºæœ¬ç±»å‹ï¼š

```java
Pair<int> p = new Pair<>(1, 2); // compile error!
```

é™äºŒï¼šæ— æ³•å–å¾—å¸¦æ³›å‹çš„Classã€‚è§‚å¯Ÿä»¥ä¸‹ä»£ç ï¼š
```java
public class Main {
    public static void main(String[] args) {
        Pair<String> p1 = new Pair<>("Hello", "world");
        Pair<Integer> p2 = new Pair<>(123, 456);
        Class c1 = p1.getClass();
        Class c2 = p2.getClass();
        System.out.println(c1==c2); // true
        System.out.println(c1==Pair.class); // true
    }
}

class Pair<T> {
    private T first;
    private T last;
    public Pair(T first, T last) {
        this.first = first;
        this.last = last;
    }
    public T getFirst() {
        return first;
    }
    public T getLast() {
        return last;
    }
}
```

å› ä¸ºTæ˜¯Objectï¼Œæˆ‘ä»¬å¯¹Pair<String>å’ŒPair<Integer>ç±»å‹è·å–Classæ—¶ï¼Œè·å–åˆ°çš„æ˜¯åŒä¸€ä¸ªClassï¼Œä¹Ÿå°±æ˜¯Pairç±»çš„Classã€‚

æ¢å¥è¯è¯´ï¼Œæ‰€æœ‰æ³›å‹å®ä¾‹ï¼Œæ— è®ºTçš„ç±»å‹æ˜¯ä»€ä¹ˆï¼ŒgetClass()è¿”å›åŒä¸€ä¸ªClasså®ä¾‹ï¼Œå› ä¸ºç¼–è¯‘åå®ƒä»¬å…¨éƒ¨éƒ½æ˜¯Pair<Object>ã€‚

> .getClass() 

.getClass() æ˜¯ Java ä¸­æ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥è°ƒç”¨çš„æ–¹æ³•ï¼Œå®ƒå®šä¹‰åœ¨ Java çš„æ ¹ç±» java.lang.Object ä¸­ã€‚è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯ è¿”å›è¿è¡Œæ—¶å¯¹è±¡çš„ç±»å¯¹è±¡ï¼ˆClass å®ä¾‹ï¼‰ã€‚

å±€é™ä¸‰ï¼šæ— æ³•åˆ¤æ–­å¸¦æ³›å‹çš„ç±»å‹

```java
List<String> list = new ArrayList<>();
if (list instanceof List<String>) { ... }  // âŒ ç¼–è¯‘é”™è¯¯
```

æ­£ç¡®åšæ³•æ˜¯ï¼š
```java
if (list instanceof List) { ... }  // âœ… åªèƒ½æ£€æµ‹åŸå§‹ç±»å‹
```

å±€é™å››ï¼šä¸èƒ½å®ä¾‹åŒ–Tç±»å‹ï¼š

```java
public class Pair<T> {
    private T first;
    private T last;
    public Pair() {
        // Compile error:
        first = new T();
        last = new T();
    }
}
```

ä¸Šè¿°ä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘ï¼Œå› ä¸ºæ„é€ æ–¹æ³•çš„ä¸¤è¡Œè¯­å¥ï¼š

```java
first = new T();
last = new T();
```

æ“¦æ‹­åå®é™…ä¸Šå˜æˆäº†ï¼š
```java
first = new Object();
last = new Object();
```

è¿™æ ·ä¸€æ¥ï¼Œåˆ›å»ºnew Pair<String>()å’Œåˆ›å»ºnew Pair<Integer>()å°±å…¨éƒ¨æˆäº†Objectï¼Œæ˜¾ç„¶ç¼–è¯‘å™¨è¦é˜»æ­¢è¿™ç§ç±»å‹ä¸å¯¹çš„ä»£ç ã€‚

è¦å®ä¾‹åŒ–Tç±»å‹ï¼Œæˆ‘ä»¬å¿…é¡»å€ŸåŠ©é¢å¤–çš„Class<T>å‚æ•°ï¼š

```java
public class Pair<T> {
    private T first;
    private T last;
    public Pair(Class<T> clazz) {
        first = clazz.newInstance();
        last = clazz.newInstance();
    }
}
```

ä¸Šè¿°ä»£ç å€ŸåŠ©Class<T>å‚æ•°å¹¶é€šè¿‡åå°„æ¥å®ä¾‹åŒ–Tç±»å‹ï¼Œä½¿ç”¨çš„æ—¶å€™ï¼Œä¹Ÿå¿…é¡»ä¼ å…¥Class<T>ã€‚ä¾‹å¦‚ï¼š

```java
Pair<String> pair = new Pair<>(String.class);
```

å› ä¸ºä¼ å…¥äº†Class<String>çš„å®ä¾‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å€ŸåŠ©String.classå°±å¯ä»¥å®ä¾‹åŒ–Stringç±»å‹ã€‚


### ä¸æ°å½“çš„è¦†å†™æ–¹æ³•

æœ‰äº›æ—¶å€™ï¼Œä¸€ä¸ªçœ‹ä¼¼æ­£ç¡®å®šä¹‰çš„æ–¹æ³•ä¼šæ— æ³•é€šè¿‡ç¼–è¯‘ã€‚ä¾‹å¦‚ï¼š
```java
public class Pair<T> {
    public boolean equals(T t) {
        return this == t;
    }
}
```

è¿™æ˜¯å› ä¸ºï¼Œå®šä¹‰çš„equals(T t)æ–¹æ³•å®é™…ä¸Šä¼šè¢«æ“¦æ‹­æˆequals(Object t)ï¼Œè€Œè¿™ä¸ªæ–¹æ³•æ˜¯ç»§æ‰¿è‡ªObjectçš„ï¼Œç¼–è¯‘å™¨ä¼šé˜»æ­¢ä¸€ä¸ªå®é™…ä¸Šä¼šå˜æˆè¦†å†™çš„æ³›å‹æ–¹æ³•å®šä¹‰ã€‚

æ¢ä¸ªæ–¹æ³•åï¼Œé¿å¼€ä¸Object.equals(Object)çš„å†²çªå°±å¯ä»¥æˆåŠŸç¼–è¯‘ï¼š
```java
public class Pair<T> {
    public boolean same(T t) {
        return this == t;
    }
}
```

### æ³›å‹ç»§æ‰¿

ä¸€ä¸ªç±»å¯ä»¥ç»§æ‰¿è‡ªä¸€ä¸ªæ³›å‹ç±»ã€‚ä¾‹å¦‚ï¼šçˆ¶ç±»çš„ç±»å‹æ˜¯Pair<Integer>ï¼Œå­ç±»çš„ç±»å‹æ˜¯IntPairï¼Œå¯ä»¥è¿™ä¹ˆç»§æ‰¿ï¼š

```java
public class IntPair extends Pair<Integer> {
}
```

ä½¿ç”¨çš„æ—¶å€™ï¼Œå› ä¸ºå­ç±»IntPairå¹¶æ²¡æœ‰æ³›å‹ç±»å‹ï¼Œæ‰€ä»¥ï¼Œæ­£å¸¸ä½¿ç”¨å³å¯ï¼š

```java
IntPair ip = new IntPair(1, 2);
```

å‰é¢è®²äº†ï¼Œæˆ‘ä»¬æ— æ³•è·å–Pair<T>çš„Tç±»å‹ï¼Œå³ç»™å®šä¸€ä¸ªå˜é‡Pair<Integer> pï¼Œæ— æ³•ä»pä¸­è·å–åˆ°Integerç±»å‹ã€‚

ä½†æ˜¯ï¼Œåœ¨çˆ¶ç±»æ˜¯æ³›å‹ç±»å‹çš„æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨å°±å¿…é¡»æŠŠç±»å‹Tï¼ˆå¯¹IntPairæ¥è¯´ï¼Œä¹Ÿå°±æ˜¯Integerç±»å‹ï¼‰ä¿å­˜åˆ°å­ç±»çš„classæ–‡ä»¶ä¸­ï¼Œä¸ç„¶ç¼–è¯‘å™¨å°±ä¸çŸ¥é“IntPairåªèƒ½å­˜å–Integerè¿™ç§ç±»å‹ã€‚

åœ¨ç»§æ‰¿äº†æ³›å‹ç±»å‹çš„æƒ…å†µä¸‹ï¼Œå­ç±»å¯ä»¥è·å–çˆ¶ç±»çš„æ³›å‹ç±»å‹ã€‚ä¾‹å¦‚ï¼šIntPairå¯ä»¥è·å–åˆ°çˆ¶ç±»çš„æ³›å‹ç±»å‹Integerã€‚è·å–çˆ¶ç±»çš„æ³›å‹ç±»å‹ä»£ç æ¯”è¾ƒå¤æ‚ï¼š

```java
import java.lang.reflect.ParameterizedType;
import java.lang.reflect.Type;

public class Main {
    public static void main(String[] args) {
        Class<IntPair> clazz = IntPair.class;
        Type t = clazz.getGenericSuperclass();
        if (t instanceof ParameterizedType) {
            ParameterizedType pt = (ParameterizedType) t;
            Type[] types = pt.getActualTypeArguments(); // å¯èƒ½æœ‰å¤šä¸ªæ³›å‹ç±»å‹
            Type firstType = types[0]; // å–ç¬¬ä¸€ä¸ªæ³›å‹ç±»å‹
            Class<?> typeClass = (Class<?>) firstType;
            System.out.println(typeClass); // Integer
        }
    }
}

class Pair<T> {
    private T first;
    private T last;
    public Pair(T first, T last) {
        this.first = first;
        this.last = last;
    }
    public T getFirst() {
        return first;
    }
    public T getLast() {
        return last;
    }
}

class IntPair extends Pair<Integer> {
    public IntPair(Integer first, Integer last) {
        super(first, last);
    }
}
```

## 5. æ³›å‹ç»§æ‰¿

ğŸ“Œ 1. æ³›å‹ç±»ä¹‹é—´æ²¡æœ‰ç»§æ‰¿å…³ç³»ï¼

```java
List<Object> objList = new ArrayList<String>(); // âŒ ç¼–è¯‘é”™è¯¯
```

ä¸Šé¢è¿™æ®µä»£ç æ˜¯é”™è¯¯çš„ï¼Œå³ä½¿ String æ˜¯ Object çš„å­ç±»ï¼ŒList<String> ä¹Ÿä¸æ˜¯ List<Object> çš„å­ç±»ã€‚

ğŸ‘‰ åŸå› æ˜¯ä¸ºäº† ç±»å‹å®‰å…¨ï¼š
å‡è®¾å…è®¸äº†ä¸Šè¿°èµ‹å€¼ï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¼šå¾€ objList é‡ŒåŠ ä¸ª Integerï¼Œä½†å®é™…å®ƒæ˜¯ ArrayList<String>ï¼Œå°±å´©äº†ï¼

âœ… æ­£ç¡®çš„åšæ³•ï¼šä½¿ç”¨é€šé…ç¬¦ ?
â“ ? extends T è¡¨ç¤ºï¼šæŸç§ T çš„å­ç±»å‹ åŒ…å«è‡ªèº«

```java
List<? extends Number> list = new ArrayList<Integer>(); // âœ… æ­£ç¡®
```

+ ä½ å¯ä»¥è¯»å–å…ƒç´ ï¼Œè¿”å›çš„æ˜¯ Number
+ ä¸èƒ½å¾€é‡ŒåŠ å…ƒç´ ï¼ˆé™¤äº† nullï¼‰

â“ ? super T è¡¨ç¤ºï¼šæŸç§ T çš„çˆ¶ç±»å‹ åŒ…å«è‡ªèº«

```java
List<? super Integer> list = new ArrayList<Number>(); // âœ… æ­£ç¡®
```

+ ä½ å¯ä»¥å¾€é‡Œé¢åŠ  Integer æˆ–å…¶å­ç±»
+ å–å‡ºå…ƒç´ æ—¶ï¼Œåªèƒ½å½“ä½œ Object

ğŸ’¡ ç±»çš„ç»§æ‰¿ä¸­ä½¿ç”¨æ³›å‹

```java
class Animal {}
class Dog extends Animal {}

class Box<T> {
    T value;
}

Box<Dog> dogBox = new Box<>();
Box<Animal> animalBox = dogBox; // âŒ é”™è¯¯ï¼æ³›å‹æ²¡æœ‰åå˜
```














