# æ³¨è§£

ä»€ä¹ˆæ˜¯æ³¨è§£ï¼ˆAnnotationï¼‰ï¼Ÿæ³¨è§£æ˜¯æ”¾åœ¨Javaæºç çš„ç±»ã€æ–¹æ³•ã€å­—æ®µã€å‚æ•°å‰çš„ä¸€ç§ç‰¹æ®Šâ€œæ³¨é‡Šâ€ï¼š

ä½œç”¨ç±»ä¼¼äº C++ ä¸­çš„å®ï¼ˆå¦‚ __attribute__ï¼‰æˆ–è€…å…ƒä¿¡æ¯ç³»ç»Ÿï¼Œä½†æ¯” C++ æ›´åŠ æ ‡å‡†åŒ–å’Œå¼ºå¤§ã€‚


```java
// this is a component:
@Resource("hello")
public class Hello {
    @Inject
    int n;

    @PostConstruct
    public void hello(@Param String name) {
        System.out.println(name);
    }

    @Override
    public String toString() {
        return "Hello";
    }
}

```

æ³¨é‡Šä¼šè¢«ç¼–è¯‘å™¨ç›´æ¥å¿½ç•¥ï¼Œæ³¨è§£åˆ™å¯ä»¥è¢«ç¼–è¯‘å™¨æ‰“åŒ…è¿›å…¥classæ–‡ä»¶ï¼Œå› æ­¤ï¼Œæ³¨è§£æ˜¯ä¸€ç§ç”¨ä½œæ ‡æ³¨çš„â€œå…ƒæ•°æ®â€ã€‚

æ³¨è§£çš„ä½œç”¨

ä»JVMçš„è§’åº¦çœ‹ï¼Œæ³¨è§£æœ¬èº«å¯¹ä»£ç é€»è¾‘æ²¡æœ‰ä»»ä½•å½±å“ï¼Œå¦‚ä½•ä½¿ç”¨æ³¨è§£å®Œå…¨ç”±å·¥å…·å†³å®šã€‚è€Œæ³¨è§£åœ¨ä»£ç è¿è¡Œæ—¶æ˜¯å¯ä»¥è¢«åå°„è¯»å–å¹¶è¿›è¡Œç›¸åº”çš„æ“ä½œï¼Œè€Œå¦‚æœæ²¡æœ‰ä½¿ç”¨åå°„æˆ–è€…å…¶ä»–æ£€æŸ¥ï¼Œé‚£ä¹ˆæ³¨è§£æ˜¯æ²¡æœ‰ä»»ä½•çœŸå®ä½œç”¨çš„ï¼Œä¹Ÿä¸ä¼šå½±å“åˆ°ç¨‹åºçš„æ­£å¸¸è¿è¡Œç»“æœã€‚

ğŸ“š å¸¸ç”¨çš„æ ‡å‡†æ³¨è§£

æ³¨è§£å | ä½œç”¨
@Override | è¡¨ç¤ºå½“å‰æ–¹æ³•é‡å†™äº†çˆ¶ç±»æ–¹æ³•
@Deprecated | è¡¨ç¤ºå½“å‰æ–¹æ³•ä¸æ¨èä½¿ç”¨
@SuppressWarnings | æŠ‘åˆ¶ç¼–è¯‘å™¨è­¦å‘Š
@FunctionalInterface | é™å®šæ¥å£åªèƒ½æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼ˆå‡½æ•°å¼æ¥å£ï¼‰
@SafeVarargs | ç”¨äºæ³›å‹å¯å˜å‚æ•°æ–¹æ³•ï¼Œæ¶ˆé™¤è­¦å‘Š

ğŸ”§ æ³¨è§£åˆ†ç±»
âœ… æŒ‰æ˜¯å¦å¸¦å‚æ•°
```java
// ä¸å¸¦å‚æ•°
@Override

// å¸¦å‚æ•°
@SuppressWarnings("unchecked")
```

âœ… æŒ‰ä½¿ç”¨åœºæ™¯åˆ†ä¸º 3 ç±»ï¼š

ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹
---|---|---
ç¼–è¯‘æ—¶æ³¨è§£ | ç»™ç¼–è¯‘å™¨ä½¿ç”¨ | @Override, @SuppressWarnings
è¿è¡Œæ—¶æ³¨è§£ | ç¨‹åºè¿è¡Œæ—¶é€šè¿‡åå°„è¯»å– | @Retention(RUNTIME) å®šä¹‰çš„æ³¨è§£
æºç æ³¨è§£ | ä»…åœ¨æºç ä¸­ç”Ÿæ•ˆï¼Œä¸è¿›å…¥ class æ–‡ä»¶ | æ–‡æ¡£æ³¨è§£


Javaçš„æ³¨è§£å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š

ç¬¬ä¸€ç±»æ˜¯ç”±ç¼–è¯‘å™¨ä½¿ç”¨çš„æ³¨è§£ï¼Œä¾‹å¦‚ï¼š

+ @Overrideï¼šè®©ç¼–è¯‘å™¨æ£€æŸ¥è¯¥æ–¹æ³•æ˜¯å¦æ­£ç¡®åœ°å®ç°äº†è¦†å†™ï¼›
+ @SuppressWarningsï¼šå‘Šè¯‰ç¼–è¯‘å™¨å¿½ç•¥æ­¤å¤„ä»£ç äº§ç”Ÿçš„è­¦å‘Šã€‚

è¿™ç±»æ³¨è§£ä¸ä¼šè¢«ç¼–è¯‘è¿›å…¥.classæ–‡ä»¶ï¼Œå®ƒä»¬åœ¨ç¼–è¯‘åå°±è¢«ç¼–è¯‘å™¨æ‰”æ‰äº†ã€‚

ç¬¬äºŒç±»æ˜¯ç”±å·¥å…·å¤„ç†.classæ–‡ä»¶ä½¿ç”¨çš„æ³¨è§£ï¼Œæ¯”å¦‚æœ‰äº›å·¥å…·ä¼šåœ¨åŠ è½½classçš„æ—¶å€™ï¼Œå¯¹classåšåŠ¨æ€ä¿®æ”¹ï¼Œå®ç°ä¸€äº›ç‰¹æ®Šçš„åŠŸèƒ½ã€‚è¿™ç±»æ³¨è§£ä¼šè¢«ç¼–è¯‘è¿›å…¥.classæ–‡ä»¶ï¼Œä½†åŠ è½½ç»“æŸåå¹¶ä¸ä¼šå­˜åœ¨äºå†…å­˜ä¸­ã€‚è¿™ç±»æ³¨è§£åªè¢«ä¸€äº›åº•å±‚åº“ä½¿ç”¨ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¸å¿…è‡ªå·±å¤„ç†ã€‚

ç¬¬ä¸‰ç±»æ˜¯åœ¨ç¨‹åºè¿è¡ŒæœŸèƒ½å¤Ÿè¯»å–çš„æ³¨è§£ï¼Œå®ƒä»¬åœ¨åŠ è½½åä¸€ç›´å­˜åœ¨äºJVMä¸­ï¼Œè¿™ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ³¨è§£ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªé…ç½®äº†@PostConstructçš„æ–¹æ³•ä¼šåœ¨è°ƒç”¨æ„é€ æ–¹æ³•åè‡ªåŠ¨è¢«è°ƒç”¨ï¼ˆè¿™æ˜¯Javaä»£ç è¯»å–è¯¥æ³¨è§£å®ç°çš„åŠŸèƒ½ï¼ŒJVMå¹¶ä¸ä¼šè¯†åˆ«è¯¥æ³¨è§£ï¼‰ã€‚


å®šä¹‰ä¸€ä¸ªæ³¨è§£æ—¶ï¼Œè¿˜å¯ä»¥å®šä¹‰é…ç½®å‚æ•°ã€‚é…ç½®å‚æ•°å¯ä»¥åŒ…æ‹¬ï¼š

+ æ‰€æœ‰åŸºæœ¬ç±»å‹ï¼›
+ Stringï¼›
+ æšä¸¾ç±»å‹ï¼›
+ åŸºæœ¬ç±»å‹ã€Stringã€Classä»¥åŠæšä¸¾çš„æ•°ç»„ã€‚

å› ä¸ºé…ç½®å‚æ•°å¿…é¡»æ˜¯å¸¸é‡ï¼Œæ‰€ä»¥ï¼Œä¸Šè¿°é™åˆ¶ä¿è¯äº†æ³¨è§£åœ¨å®šä¹‰æ—¶å°±å·²ç»ç¡®å®šäº†æ¯ä¸ªå‚æ•°çš„å€¼ã€‚

æ³¨è§£çš„é…ç½®å‚æ•°å¯ä»¥æœ‰é»˜è®¤å€¼ï¼Œç¼ºå°‘æŸä¸ªé…ç½®å‚æ•°æ—¶å°†ä½¿ç”¨é»˜è®¤å€¼ã€‚

æ­¤å¤–ï¼Œå¤§éƒ¨åˆ†æ³¨è§£ä¼šæœ‰ä¸€ä¸ªåä¸ºvalueçš„é…ç½®å‚æ•°ï¼Œå¯¹æ­¤å‚æ•°èµ‹å€¼ï¼Œå¯ä»¥åªå†™å¸¸é‡ï¼Œç›¸å½“äºçœç•¥äº†valueå‚æ•°ã€‚

å¦‚æœåªå†™æ³¨è§£ï¼Œç›¸å½“äºå…¨éƒ¨ä½¿ç”¨é»˜è®¤å€¼ã€‚

ä¸¾ä¸ªæ —å­ï¼Œå¯¹ä»¥ä¸‹ä»£ç ï¼š

```java
public class Hello {
    @Check(min=0, max=100, value=55)
    public int n;

    @Check(value=99)
    public int p;

    @Check(99) // @Check(value=99)
    public int x;

    @Check
    public int y;
}
```

@Checkå°±æ˜¯ä¸€ä¸ªæ³¨è§£ã€‚ç¬¬ä¸€ä¸ª@Check(min=0, max=100, value=55)æ˜ç¡®å®šä¹‰äº†ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ª@Check(value=99)åªå®šä¹‰äº†ä¸€ä¸ªvalueå‚æ•°ï¼Œå®ƒå®é™…ä¸Šå’Œ@Check(99)æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚æœ€åä¸€ä¸ª@Checkè¡¨ç¤ºæ‰€æœ‰å‚æ•°éƒ½ä½¿ç”¨é»˜è®¤å€¼ã€‚


## 1. å®šä¹‰æ³¨è§£@interfaceï¼‰

javaè¯­è¨€ä½¿ç”¨@interfaceè¯­æ³•æ¥å®šä¹‰æ³¨è§£ï¼ˆAnnotationï¼‰ï¼Œå®ƒçš„æ ¼å¼å¦‚ä¸‹ï¼š

```java
public @interface Report {
    int type() default 0;
    String level() default "info";
    String value() default "";
}
```

æ³¨è§£çš„å‚æ•°ç±»ä¼¼æ— å‚æ•°æ–¹æ³•ï¼Œå¯ä»¥ç”¨defaultè®¾å®šä¸€ä¸ªé»˜è®¤å€¼ï¼ˆå¼ºçƒˆæ¨èï¼‰ã€‚æœ€å¸¸ç”¨çš„å‚æ•°åº”å½“å‘½åä¸ºvalueã€‚

## 2. å…ƒæ³¨è§£

æœ‰ä¸€äº›æ³¨è§£å¯ä»¥ä¿®é¥°å…¶ä»–æ³¨è§£ï¼Œè¿™äº›æ³¨è§£å°±ç§°ä¸ºå…ƒæ³¨è§£ï¼ˆmeta annotationï¼‰ã€‚Javaæ ‡å‡†åº“å·²ç»å®šä¹‰äº†ä¸€äº›å…ƒæ³¨è§£ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨å…ƒæ³¨è§£ï¼Œé€šå¸¸ä¸éœ€è¦è‡ªå·±å»ç¼–å†™å…ƒæ³¨è§£ã€‚

å…ƒæ ‡ç­¾æœ‰ @Retentionã€@Documentedã€@Targetã€@Inheritedã€@Repeatable 5 ç§ã€‚

### 2.1 @Retention

@Retentionå®šä¹‰äº†Annotationçš„ç”Ÿå‘½å‘¨æœŸï¼š

+ RetentionPolicy.SOURCE æ³¨è§£åªåœ¨æºç é˜¶æ®µä¿ç•™ï¼Œåœ¨ç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘æ—¶å®ƒå°†è¢«ä¸¢å¼ƒå¿½è§†ã€‚

+ RetentionPolicy.CLASS æ³¨è§£åªè¢«ä¿ç•™åˆ°ç¼–è¯‘è¿›è¡Œçš„æ—¶å€™ï¼Œå®ƒå¹¶ä¸ä¼šè¢«åŠ è½½åˆ° JVM ä¸­ã€‚

+ RetentionPolicy.RUNTIME æ³¨è§£å¯ä»¥ä¿ç•™åˆ°ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œå®ƒä¼šè¢«åŠ è½½è¿›å…¥åˆ° JVM ä¸­ï¼Œæ‰€ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶å¯ä»¥è·å–åˆ°å®ƒä»¬ã€‚

å¦‚æœ@Retentionä¸å­˜åœ¨ï¼Œåˆ™è¯¥Annotationé»˜è®¤ä¸ºCLASSã€‚å› ä¸ºé€šå¸¸æˆ‘ä»¬è‡ªå®šä¹‰çš„Annotationéƒ½æ˜¯RUNTIMEï¼Œæ‰€ä»¥ï¼ŒåŠ¡å¿…è¦åŠ ä¸Š@Retention(RetentionPolicy.RUNTIME)è¿™ä¸ªå…ƒæ³¨è§£ï¼š

```java
@Retention(RetentionPolicy.RUNTIME)
public @interface Report {
    int type() default 0;
    String level() default "info";
    String value() default "";
}
```

ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®š Report å¯ä»¥åœ¨ç¨‹åºè¿è¡Œå‘¨æœŸè¢«è·å–åˆ°ï¼Œå› æ­¤å®ƒçš„ç”Ÿå‘½å‘¨æœŸéå¸¸çš„é•¿ã€‚

### 2.2 @Documented

å®ƒçš„ä½œç”¨æ˜¯èƒ½å¤Ÿå°†æ³¨è§£ä¸­çš„å…ƒç´ åŒ…å«åˆ° Javadoc ä¸­å»ã€‚

### 2.3 @Target


æœ€å¸¸ç”¨çš„å…ƒæ³¨è§£æ˜¯@Targetã€‚ä½¿ç”¨@Targetå¯ä»¥å®šä¹‰Annotationèƒ½å¤Ÿè¢«åº”ç”¨äºæºç çš„å“ªäº›ä½ç½®ï¼š

å¯ä»¥è¿™æ ·ç†è§£ï¼Œå½“ä¸€ä¸ªæ³¨è§£è¢« @Target æ³¨è§£æ—¶ï¼Œè¿™ä¸ªæ³¨è§£å°±è¢«é™å®šäº†è¿ç”¨çš„åœºæ™¯ã€‚

+ ç±»æˆ–æ¥å£ï¼šElementType.TYPEï¼›
+ å­—æ®µï¼šElementType.FIELDï¼›
+ æ–¹æ³•ï¼šElementType.METHODï¼›
+ æ„é€ æ–¹æ³•ï¼šElementType.CONSTRUCTORï¼›
+ æ–¹æ³•å‚æ•°ï¼šElementType.PARAMETERã€‚

ä¾‹å¦‚ï¼Œå®šä¹‰æ³¨è§£@Reportå¯ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œæˆ‘ä»¬å¿…é¡»æ·»åŠ ä¸€ä¸ª@Target(ElementType.METHOD)ï¼š

```java
@Target(ElementType.METHOD)
public @interface Report {
    int type() default 0;
    String level() default "info";
    String value() default "";
}
```

å®šä¹‰æ³¨è§£@Reportå¯ç”¨åœ¨æ–¹æ³•æˆ–å­—æ®µä¸Šï¼Œå¯ä»¥æŠŠ@Targetæ³¨è§£å‚æ•°å˜ä¸ºæ•°ç»„{ ElementType.METHOD, ElementType.FIELD }ï¼š

```java
@Target({
    ElementType.METHOD,
    ElementType.FIELD
})
public @interface Report {
    ...
}
```

å®é™…ä¸Š@Targetå®šä¹‰çš„valueæ˜¯ElementType[]æ•°ç»„ï¼Œåªæœ‰ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå¯ä»¥çœç•¥æ•°ç»„çš„å†™æ³•ã€‚

### 2.4 @Inherited

Inherited æ˜¯ç»§æ‰¿çš„æ„æ€ï¼Œä½†æ˜¯å®ƒå¹¶ä¸æ˜¯è¯´æ³¨è§£æœ¬èº«å¯ä»¥ç»§æ‰¿ï¼Œè€Œæ˜¯è¯´å¦‚æœä¸€ä¸ªè¶…ç±»è¢« @Inherited æ³¨è§£è¿‡çš„æ³¨è§£è¿›è¡Œæ³¨è§£çš„è¯ï¼Œé‚£ä¹ˆå¦‚æœå®ƒçš„å­ç±»æ²¡æœ‰è¢«ä»»ä½•æ³¨è§£åº”ç”¨çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªå­ç±»å°±ç»§æ‰¿äº†è¶…ç±»çš„æ³¨è§£ã€‚

è¯´çš„æ¯”è¾ƒæŠ½è±¡ã€‚ä»£ç æ¥è§£é‡Šã€‚

```java
@Inherited
@Retention(RetentionPolicy.RUNTIME)
@interface Test {}

@Test
public class A {}

public class B extends A {}
```

æ³¨è§£ Test è¢« @Inherited ä¿®é¥°ï¼Œä¹‹åç±» A è¢« Test æ³¨è§£ï¼Œç±» B ç»§æ‰¿ A,ç±» B ä¹Ÿæ‹¥æœ‰ Test è¿™ä¸ªæ³¨è§£ã€‚

### 2.5  @Repeatable

ä½¿ç”¨@Repeatableè¿™ä¸ªå…ƒæ³¨è§£å¯ä»¥å®šä¹‰Annotationæ˜¯å¦å¯é‡å¤ã€‚

ä¸¾ä¸ªä¾‹å­:

```java
@interface Persons {
    Person[]  value();
}

@Repeatable(Persons.class)
@interface Person{
    String role default "";
}

@Person(role="artist")
@Person(role="coder")
@Person(role="PM")
public class SuperMan{
}
```

æ³¨æ„ä¸Šé¢çš„ä»£ç ï¼Œ@Repeatable æ³¨è§£äº† Personã€‚è€Œ @Repeatable åé¢æ‹¬å·ä¸­çš„ç±»ç›¸å½“äºä¸€ä¸ªå®¹å™¨æ³¨è§£ã€‚

ä»€ä¹ˆæ˜¯å®¹å™¨æ³¨è§£å‘¢ï¼Ÿå°±æ˜¯ç”¨æ¥å­˜æ”¾å…¶å®ƒæ³¨è§£çš„åœ°æ–¹ã€‚å®ƒæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ³¨è§£ã€‚

æˆ‘ä»¬å†çœ‹çœ‹ä»£ç ä¸­çš„ç›¸å…³å®¹å™¨æ³¨è§£ã€‚

```java
@interface Persons {
    Person[]  value();
}
```

æŒ‰ç…§è§„å®šï¼Œå®ƒé‡Œé¢å¿…é¡»è¦æœ‰ä¸€ä¸ª value çš„å±æ€§ï¼Œå±æ€§ç±»å‹æ˜¯ä¸€ä¸ªè¢« @Repeatable æ³¨è§£è¿‡çš„æ³¨è§£æ•°ç»„ï¼Œæ³¨æ„å®ƒæ˜¯æ•°ç»„ã€‚

å¦‚æœä¸å¥½ç†è§£çš„è¯ï¼Œå¯ä»¥è¿™æ ·ç†è§£ã€‚Persons æ˜¯ä¸€å¼ æ€»çš„æ ‡ç­¾ï¼Œä¸Šé¢è´´æ»¡äº† Person è¿™ç§åŒç±»å‹ä½†å†…å®¹ä¸ä¸€æ ·çš„æ ‡ç­¾ã€‚æŠŠ Persons ç»™ä¸€ä¸ª SuperMan è´´ä¸Šï¼Œç›¸å½“äºåŒæ—¶ç»™ä»–è´´äº†ç¨‹åºå‘˜ã€äº§å“ç»ç†ã€ç”»å®¶çš„æ ‡ç­¾ã€‚

æˆ‘ä»¬å¯èƒ½å¯¹äº @Person(role=â€PMâ€) æ‹¬å·é‡Œé¢çš„å†…å®¹æ„Ÿå…´è¶£ï¼Œå®ƒå…¶å®å°±æ˜¯ç»™ Person è¿™ä¸ªæ³¨è§£çš„ role å±æ€§èµ‹å€¼ä¸º PM ï¼Œå¤§å®¶ä¸æ˜ç™½æ­£å¸¸ï¼Œé©¬ä¸Šå°±è®²åˆ°æ³¨è§£çš„å±æ€§è¿™ä¸€å—ã€‚

**æ³¨è§£çš„å±æ€§**

æ³¨è§£çš„å±æ€§ä¹Ÿå«åšæˆå‘˜å˜é‡ã€‚æ³¨è§£åªæœ‰æˆå‘˜å˜é‡ï¼Œæ²¡æœ‰æ–¹æ³•ã€‚æ³¨è§£çš„æˆå‘˜å˜é‡åœ¨æ³¨è§£çš„å®šä¹‰ä¸­ä»¥â€œæ— å½¢å‚çš„æ–¹æ³•â€å½¢å¼æ¥å£°æ˜ï¼Œå…¶æ–¹æ³•åå®šä¹‰äº†è¯¥æˆå‘˜å˜é‡çš„åå­—ï¼Œå…¶è¿”å›å€¼å®šä¹‰äº†è¯¥æˆå‘˜å˜é‡çš„ç±»å‹ã€‚

```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface TestAnnotation {
    int id();
    String msg();
}
```

ä¸Šé¢ä»£ç å®šä¹‰äº† TestAnnotation è¿™ä¸ªæ³¨è§£ä¸­æ‹¥æœ‰ id å’Œ msg ä¸¤ä¸ªå±æ€§ã€‚åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬åº”è¯¥ç»™å®ƒä»¬è¿›è¡Œèµ‹å€¼ã€‚

èµ‹å€¼çš„æ–¹å¼æ˜¯åœ¨æ³¨è§£çš„æ‹¬å·å†…ä»¥ value=â€â€ å½¢å¼ï¼Œå¤šä¸ªå±æ€§ä¹‹å‰ç”¨ ï¼Œéš”å¼€ã€‚

```java
@TestAnnotation(id=3,msg="hello annotation")
public class Test {
}
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ³¨è§£ä¸­å®šä¹‰å±æ€§æ—¶å®ƒçš„ç±»å‹å¿…é¡»æ˜¯ 8 ç§åŸºæœ¬æ•°æ®ç±»å‹å¤–åŠ  ç±»ã€æ¥å£ã€æ³¨è§£åŠå®ƒä»¬çš„æ•°ç»„ã€‚

æ³¨è§£ä¸­å±æ€§å¯ä»¥æœ‰é»˜è®¤å€¼ï¼Œé»˜è®¤å€¼éœ€è¦ç”¨ default å…³é”®å€¼æŒ‡å®šã€‚æ¯”å¦‚ï¼š

```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface TestAnnotation {
    public int id() default -1;
    public String msg() default "Hi";
}
```

TestAnnotation ä¸­ id å±æ€§é»˜è®¤å€¼ä¸º -1ï¼Œmsg å±æ€§é»˜è®¤å€¼ä¸º Hiã€‚
å®ƒå¯ä»¥è¿™æ ·åº”ç”¨ã€‚

```java
@TestAnnotation()
public class Test {}
```

å› ä¸ºæœ‰é»˜è®¤å€¼ï¼Œæ‰€ä»¥æ— éœ€è¦å†åœ¨ @TestAnnotation åé¢çš„æ‹¬å·é‡Œé¢è¿›è¡Œèµ‹å€¼äº†ï¼Œè¿™ä¸€æ­¥å¯ä»¥çœç•¥ã€‚

å¦å¤–ï¼Œè¿˜æœ‰ä¸€ç§æƒ…å†µã€‚å¦‚æœä¸€ä¸ªæ³¨è§£å†…ä»…ä»…åªæœ‰ä¸€ä¸ªåå­—ä¸º value çš„å±æ€§æ—¶ï¼Œåº”ç”¨è¿™ä¸ªæ³¨è§£æ—¶å¯ä»¥ç›´æ¥æ¥å±æ€§å€¼å¡«å†™åˆ°æ‹¬å·å†…ã€‚

```java
public @interface Check {
    String value();
}
```

ä¸Šé¢ä»£ç ä¸­ï¼ŒCheck è¿™ä¸ªæ³¨è§£åªæœ‰ value è¿™ä¸ªå±æ€§ã€‚æ‰€ä»¥å¯ä»¥è¿™æ ·åº”ç”¨ã€‚

```java
@Check("hi")
int a;
```

è¿™å’Œä¸‹é¢çš„æ•ˆæœæ˜¯ä¸€æ ·çš„

```java
@Check(value="hi")
int a;
```

æœ€åï¼Œè¿˜éœ€è¦æ³¨æ„çš„ä¸€ç§æƒ…å†µæ˜¯ä¸€ä¸ªæ³¨è§£æ²¡æœ‰ä»»ä½•å±æ€§ã€‚æ¯”å¦‚

```java
public @interface Perform {}
```

é‚£ä¹ˆåœ¨åº”ç”¨è¿™ä¸ªæ³¨è§£çš„æ—¶å€™ï¼Œæ‹¬å·éƒ½å¯ä»¥çœç•¥ã€‚

```java
@Perform
public void testMethod(){}
```



## 3. å¦‚ä½•å®šä¹‰Annotation
æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹å®šä¹‰Annotationçš„æ­¥éª¤ï¼š

ç¬¬ä¸€æ­¥ï¼Œç”¨@interfaceå®šä¹‰æ³¨è§£ï¼š

```java
public @interface Report {
}
```

ç¬¬äºŒæ­¥ï¼Œæ·»åŠ å‚æ•°ã€é»˜è®¤å€¼ï¼š
```java
public @interface Report {
    int type() default 0;
    String level() default "info";
    String value() default "";
}

```

æŠŠæœ€å¸¸ç”¨çš„å‚æ•°å®šä¹‰ä¸ºvalue()ï¼Œæ¨èæ‰€æœ‰å‚æ•°éƒ½å°½é‡è®¾ç½®é»˜è®¤å€¼ã€‚

ç¬¬ä¸‰æ­¥ï¼Œç”¨å…ƒæ³¨è§£é…ç½®æ³¨è§£ï¼š
```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface Report {
    int type() default 0;
    String level() default "info";
    String value() default "";
}

```

å…¶ä¸­ï¼Œå¿…é¡»è®¾ç½®@Targetå’Œ@Retentionï¼Œ@Retentionä¸€èˆ¬è®¾ç½®ä¸ºRUNTIMEï¼Œå› ä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„æ³¨è§£é€šå¸¸è¦æ±‚åœ¨è¿è¡ŒæœŸè¯»å–ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸å¿…å†™@Inheritedå’Œ@Repeatableã€‚


## 4. Java é¢„ç½®çš„æ³¨è§£

### 4.1 @Deprecated

è¿™ä¸ªå…ƒç´ æ˜¯ç”¨æ¥æ ‡è®°è¿‡æ—¶çš„å…ƒç´ ï¼Œæƒ³å¿…å¤§å®¶åœ¨æ—¥å¸¸å¼€å‘ä¸­ç»å¸¸ç¢°åˆ°ã€‚ç¼–è¯‘å™¨åœ¨ç¼–è¯‘é˜¶æ®µé‡åˆ°è¿™ä¸ªæ³¨è§£æ—¶ä¼šå‘å‡ºæé†’è­¦å‘Šï¼Œå‘Šè¯‰å¼€å‘è€…æ­£åœ¨è°ƒç”¨ä¸€ä¸ªè¿‡æ—¶çš„å…ƒç´ æ¯”å¦‚è¿‡æ—¶çš„æ–¹æ³•ã€è¿‡æ—¶çš„ç±»ã€è¿‡æ—¶çš„æˆå‘˜å˜é‡ã€‚

```java
public class Hero {
    @Deprecated
    public void say(){
        System.out.println("Noting has to say!");
    }
    public void speak(){
        System.out.println("I have a dream!");
    }
}
```

å®šä¹‰äº†ä¸€ä¸ª Hero ç±»ï¼Œå®ƒæœ‰ä¸¤ä¸ªæ–¹æ³• say() å’Œ speak() ï¼Œå…¶ä¸­ say() è¢« @Deprecated æ³¨è§£ã€‚ç„¶åæˆ‘ä»¬åœ¨ IDE ä¸­åˆ†åˆ«è°ƒç”¨å®ƒä»¬ã€‚

![](./å›¾ç‰‡/java_115.png)

å¯ä»¥çœ‹åˆ°ï¼Œsay() æ–¹æ³•ä¸Šé¢è¢«ä¸€æ¡ç›´çº¿åˆ’äº†ä¸€æ¡ï¼Œè¿™å…¶å®å°±æ˜¯ç¼–è¯‘å™¨è¯†åˆ«åçš„æé†’æ•ˆæœã€‚

### 4.2 @Override

è¿™ä¸ªå¤§å®¶åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼Œæç¤ºå­ç±»è¦å¤å†™çˆ¶ç±»ä¸­è¢« @Override ä¿®é¥°çš„æ–¹æ³•

### 4.3 @SuppressWarnings

é˜»æ­¢è­¦å‘Šçš„æ„æ€ã€‚ä¹‹å‰è¯´è¿‡è°ƒç”¨è¢« @Deprecated æ³¨è§£çš„æ–¹æ³•åï¼Œç¼–è¯‘å™¨ä¼šè­¦å‘Šæé†’ï¼Œè€Œæœ‰æ—¶å€™å¼€å‘è€…ä¼šå¿½ç•¥è¿™ç§è­¦å‘Šï¼Œä»–ä»¬å¯ä»¥åœ¨è°ƒç”¨çš„åœ°æ–¹é€šè¿‡ @SuppressWarnings è¾¾åˆ°ç›®çš„ã€‚

```java
@SuppressWarnings("deprecation")
public void test1(){
    Hero hero = new Hero();
    hero.say();
    hero.speak();
}
```

### 4.4 @SafeVarargs

å‚æ•°å®‰å…¨ç±»å‹æ³¨è§£ã€‚å®ƒçš„ç›®çš„æ˜¯æé†’å¼€å‘è€…ä¸è¦ç”¨å‚æ•°åšä¸€äº›ä¸å®‰å…¨çš„æ“ä½œ,å®ƒçš„å­˜åœ¨ä¼šé˜»æ­¢ç¼–è¯‘å™¨äº§ç”Ÿ unchecked è¿™æ ·çš„è­¦å‘Šã€‚å®ƒæ˜¯åœ¨ Java 1.7 çš„ç‰ˆæœ¬ä¸­åŠ å…¥çš„ã€‚

```java
@SafeVarargs // Not actually safe!
    static void m(List<String>... stringLists) {
    Object[] array = stringLists;
    List<Integer> tmpList = Arrays.asList(42);
    array[0] = tmpList; // Semantically invalid, but compiles without warnings
    String s = stringLists[0].get(0); // Oh no, ClassCastException at runtime!
}
```

ä¸Šé¢çš„ä»£ç ä¸­ï¼Œç¼–è¯‘é˜¶æ®µä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯è¿è¡Œæ—¶ä¼šæŠ›å‡º ClassCastException è¿™ä¸ªå¼‚å¸¸ï¼Œæ‰€ä»¥å®ƒè™½ç„¶å‘Šè¯‰å¼€å‘è€…è¦å¦¥å–„å¤„ç†ï¼Œä½†æ˜¯å¼€å‘è€…è‡ªå·±è¿˜æ˜¯æç ¸äº†ã€‚

Java å®˜æ–¹æ–‡æ¡£è¯´ï¼Œæœªæ¥çš„ç‰ˆæœ¬ä¼šæˆæƒç¼–è¯‘å™¨å¯¹è¿™ç§ä¸å®‰å…¨çš„æ“ä½œäº§ç”Ÿé”™è¯¯è­¦


### 4.5 @FunctionalInterface

å‡½æ•°å¼æ¥å£æ³¨è§£ï¼Œè¿™ä¸ªæ˜¯ Java 1.8 ç‰ˆæœ¬å¼•å…¥çš„æ–°ç‰¹æ€§ã€‚å‡½æ•°å¼ç¼–ç¨‹å¾ˆç«ï¼Œæ‰€ä»¥ Java 8 ä¹ŸåŠæ—¶æ·»åŠ äº†è¿™ä¸ªç‰¹æ€§ã€‚

å‡½æ•°å¼æ¥å£ (Functional Interface) å°±æ˜¯ä¸€ä¸ªå…·æœ‰ä¸€ä¸ªæ–¹æ³•çš„æ™®é€šæ¥å£ã€‚
æ¯”å¦‚

```java
@FunctionalInterface
public interface Runnable {
    /**
     * When an object implementing interface <code>Runnable</code> is used
     * to create a thread, starting the thread causes the object's
     * <code>run</code> method to be called in that separately executing
     * thread.
     * <p>
     * The general contract of the method <code>run</code> is that it may
     * take any action whatsoever.
     *
     * @see     java.lang.Thread#run()
     */
    public abstract void run();
}
```

æˆ‘ä»¬è¿›è¡Œçº¿ç¨‹å¼€å‘ä¸­å¸¸ç”¨çš„ Runnable å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„å‡½æ•°å¼æ¥å£ï¼Œä¸Šé¢æºç å¯ä»¥çœ‹åˆ°å®ƒå°±è¢« @FunctionalInterface æ³¨è§£ã€‚

å¯èƒ½æœ‰äººä¼šç–‘æƒ‘ï¼Œå‡½æ•°å¼æ¥å£æ ‡è®°æœ‰ä»€ä¹ˆç”¨ï¼Œè¿™ä¸ªåŸå› æ˜¯å‡½æ•°å¼æ¥å£å¯ä»¥å¾ˆå®¹æ˜“è½¬æ¢ä¸º Lambda è¡¨è¾¾å¼ã€‚è¿™æ˜¯å¦å¤–çš„ä¸»é¢˜äº†ï¼Œæœ‰å…´è¶£çš„åŒå­¦è¯·è‡ªå·±æœç´¢ç›¸å…³çŸ¥è¯†ç‚¹å­¦ä¹ ã€‚
### 4.6 @Component 

è¿™æ˜¯ Spring ä¸­çš„ä¸€ä¸ª é€šç”¨ç»„ä»¶æ³¨è§£ï¼Œä½œç”¨æ˜¯æŠŠç±»æ ‡è®°ä¸º Spring å®¹å™¨ä¸­çš„ä¸€ä¸ª Beanï¼Œç›¸å½“äºå‘Šè¯‰ Springï¼š

> â€œå˜¿ï¼Œè¿™ä¸ªç±»äº¤ç»™ä½ æ¥ç®¡ç†ï¼â€

å®ƒçš„æ ¸å¿ƒä½œç”¨ï¼š

âœ… è¢«è‡ªåŠ¨æ‰«æï¼ˆé…åˆ @ComponentScanï¼‰
âœ… è‡ªåŠ¨æ³¨å…¥åˆ°å…¶ä»– Bean ä¸­ï¼ˆé…åˆ @Autowiredï¼‰

ğŸ“Œ ç¤ºä¾‹

```java
@Component
public class UserService {
    public void sayHello() {
        System.out.println("Hello, User!");
    }
}
```

å½“ Spring Boot å¯åŠ¨æ—¶ï¼Œå®ƒä¼šæ‰«æåˆ° @Component æ ‡æ³¨çš„ç±»ï¼Œå¹¶æŠŠå®ƒæ”¾å…¥ Spring å®¹å™¨ï¼Œå˜æˆä¸€ä¸ªå•ä¾‹ Beanã€‚

è¿™æ ·ä½ å°±å¯ä»¥åœ¨å…¶ä»–åœ°æ–¹è¿™æ ·ä½¿ç”¨ï¼š

```java
@Autowired
private UserService userService;
```

ğŸ“š ç›¸å…³æ³¨è§£

å®é™…ä¸Šï¼ŒSpring è¿˜æä¾›äº†å‡ ä¸ªæ›´ç»†åˆ†çš„æ³¨è§£ï¼Œå®ƒä»¬ æœ¬è´¨ä¸Šä¹Ÿæ˜¯ @Component çš„ç‰¹åŒ–ç‰ˆï¼š

+ @Service â†’ è¡¨ç¤ºä¸šåŠ¡é€»è¾‘å±‚ç»„ä»¶

+ @Repository â†’ è¡¨ç¤ºæ•°æ®è®¿é—®å±‚ç»„ä»¶

+ @Controller â†’ è¡¨ç¤º Web æ§åˆ¶å±‚ç»„ä»¶

å®ƒä»¬åœ¨åŠŸèƒ½ä¸Šç­‰ä»·äº @Componentï¼Œåªæ˜¯è¯­ä¹‰æ›´æ˜ç¡®ã€‚

### 4.7 @Aspect æ³¨è§£

è¿™æ˜¯ Spring AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰çš„æ ¸å¿ƒæ³¨è§£ï¼Œä½œç”¨æ˜¯ï¼š

> æŠŠä¸€ä¸ªç±»æ ‡è®°ä¸º åˆ‡é¢ï¼ˆAspectï¼‰ï¼Œç”¨äºå®šä¹‰æ¨ªåˆ‡é€»è¾‘ï¼ˆæ¯”å¦‚æ—¥å¿—ã€æƒé™ã€äº‹åŠ¡ç­‰ï¼‰ã€‚

ç®€å•è¯´ï¼Œ@Aspect æ˜¯ç”¨æ¥å†™ AOP ä»£ç çš„ã€‚

ğŸ“Œ ç¤ºä¾‹

```java
@Aspect
@Component
public class LogAspect {

    @Before("execution(* com.example.service.*.*(..))")
    public void beforeMethod() {
        System.out.println("Before method execution...");
    }
}

```

è§£é‡Šï¼š

âœ… @Aspect â†’ å£°æ˜è¿™æ˜¯ä¸€ä¸ªåˆ‡é¢

âœ… @Before â†’ å®šä¹‰ä¸€ä¸ªå‰ç½®é€šçŸ¥ï¼Œæ‹¦æˆªç›®æ ‡æ–¹æ³•å‰æ‰§è¡Œ

âœ… execution(...) â†’ åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼ŒæŒ‡å®šæ‹¦æˆªå“ªäº›æ–¹æ³•

> æ³¨æ„ï¼š@Aspect å¿…é¡»å’Œ @Component æ­é…ä½¿ç”¨ï¼Œå› ä¸ºåˆ‡é¢æœ¬è´¨ä¹Ÿæ˜¯ä¸€ä¸ª Spring Beanã€‚

ğŸ“š å¸¸ç”¨ AOP æ³¨è§£

| æ³¨è§£                | ä½œç”¨                |
| ----------------- | ----------------- |
| `@Before`         | æ–¹æ³•å‰æ‰§è¡Œ             |
| `@After`          | æ–¹æ³•åæ‰§è¡Œï¼ˆæ— è®ºæ˜¯å¦å¼‚å¸¸ï¼‰     |
| `@AfterReturning` | æ–¹æ³•æˆåŠŸè¿”å›åæ‰§è¡Œ         |
| `@AfterThrowing`  | æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åæ‰§è¡Œ         |
| `@Around`         | åŒ…è£¹æ•´ä¸ªæ–¹æ³•ï¼ˆå¯æ§åˆ¶æ˜¯å¦ç»§ç»­æ‰§è¡Œï¼‰ |




## 5. æ³¨è§£ä¸åå°„ã€‚

æ³¨è§£é€šè¿‡åå°„è·å–ã€‚é¦–å…ˆå¯ä»¥é€šè¿‡ Class å¯¹è±¡çš„ isAnnotationPresent() æ–¹æ³•åˆ¤æ–­å®ƒæ˜¯å¦åº”ç”¨äº†æŸä¸ªæ³¨è§£

```java
public boolean isAnnotationPresent(Class<? extends Annotation> annotationClass) {}
```

ç„¶åé€šè¿‡ getAnnotation() æ–¹æ³•æ¥è·å– Annotation å¯¹è±¡ã€‚

```java
public <A extends Annotation> A getAnnotation(Class<A> annotationClass) {}
```

æˆ–è€…æ˜¯ getAnnotations() æ–¹æ³•ã€‚

```java
public Annotation[] getAnnotations() {}
```


å‰ä¸€ç§æ–¹æ³•è¿”å›æŒ‡å®šç±»å‹çš„æ³¨è§£ï¼Œåä¸€ç§æ–¹æ³•è¿”å›æ³¨è§£åˆ°è¿™ä¸ªå…ƒç´ ä¸Šçš„æ‰€æœ‰æ³¨è§£ã€‚

å¦‚æœè·å–åˆ°çš„ Annotation å¦‚æœä¸ä¸º nullï¼Œåˆ™å°±å¯ä»¥è°ƒç”¨å®ƒä»¬çš„å±æ€§æ–¹æ³•äº†ã€‚æ¯”å¦‚

```java
@TestAnnotation()
public class Test {
    public static void main(String[] args) {
        boolean hasAnnotation = Test.class.isAnnotationPresent(TestAnnotation.class);
        if ( hasAnnotation ) {
            TestAnnotation testAnnotation = Test.class.getAnnotation(TestAnnotation.class);
            System.out.println("id:"+testAnnotation.id());
            System.out.println("msg:"+testAnnotation.msg());
        }
    }
}
```

ç¨‹åºçš„è¿è¡Œç»“æœæ˜¯ï¼š

```java
id:-1
msg:
```

è¿™ä¸ªæ­£æ˜¯ TestAnnotation ä¸­ id å’Œ msg çš„é»˜è®¤å€¼ã€‚

ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåªæ˜¯æ£€é˜…å‡ºäº†æ³¨è§£åœ¨ç±»ä¸Šçš„æ³¨è§£ï¼Œå…¶å®å±æ€§ã€æ–¹æ³•ä¸Šçš„æ³¨è§£ç…§æ ·æ˜¯å¯ä»¥çš„ã€‚åŒæ ·è¿˜æ˜¯è¦å‡æ‰‹äºåå°„ã€‚

```java
@TestAnnotation(msg="hello")
public class Test {
    @Check(value="hi")
    int a;
    @Perform
    public void testMethod(){}
    @SuppressWarnings("deprecation")
    public void test1(){
        Hero hero = new Hero();
        hero.say();
        hero.speak();
    }
    public static void main(String[] args) {
        boolean hasAnnotation = Test.class.isAnnotationPresent(TestAnnotation.class);
        if ( hasAnnotation ) {
            TestAnnotation testAnnotation = Test.class.getAnnotation(TestAnnotation.class);
            //è·å–ç±»çš„æ³¨è§£
            System.out.println("id:"+testAnnotation.id());
            System.out.println("msg:"+testAnnotation.msg());
        }
        try {
            Field a = Test.class.getDeclaredField("a");
            a.setAccessible(true);
            //è·å–ä¸€ä¸ªæˆå‘˜å˜é‡ä¸Šçš„æ³¨è§£
            Check check = a.getAnnotation(Check.class);
            if ( check != null ) {
                System.out.println("check value:"+check.value());
            }
            Method testMethod = Test.class.getDeclaredMethod("testMethod");
            if ( testMethod != null ) {
                // è·å–æ–¹æ³•ä¸­çš„æ³¨è§£
                Annotation[] ans = testMethod.getAnnotations();
                for( int i = 0;i < ans.length;i++) {
                    System.out.println("method testMethod annotation:"+ans[i].annotationType().getSimpleName());
                }
            }
        } catch (NoSuchFieldException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
            System.out.println(e.getMessage());
        } catch (SecurityException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
            System.out.println(e.getMessage());
        } catch (NoSuchMethodException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
            System.out.println(e.getMessage());
        }
    }
}
```

å®ƒä»¬çš„ç»“æœå¦‚ä¸‹ï¼š

```java
id:-1
msg:hello
check value:hi
method testMethod annotation:Perform
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä¸€ä¸ªæ³¨è§£è¦åœ¨è¿è¡Œæ—¶è¢«æˆåŠŸæå–ï¼Œé‚£ä¹ˆ @Retention(RetentionPolicy.RUNTIME) æ˜¯å¿…é¡»çš„ã€‚

## 6. æ³¨è§£çš„ä½¿ç”¨åœºæ™¯

æ³¨è§£æ˜¯ä¸€ç³»åˆ—å…ƒæ•°æ®ï¼Œå®ƒæä¾›æ•°æ®ç”¨æ¥è§£é‡Šç¨‹åºä»£ç ï¼Œä½†æ˜¯æ³¨è§£å¹¶éæ˜¯æ‰€è§£é‡Šçš„ä»£ç æœ¬èº«çš„ä¸€éƒ¨åˆ†ã€‚æ³¨è§£å¯¹äºä»£ç çš„è¿è¡Œæ•ˆæœæ²¡æœ‰ç›´æ¥å½±å“ã€‚

æ³¨è§£æœ‰è®¸å¤šç”¨å¤„ï¼Œä¸»è¦å¦‚ä¸‹ï¼š

+ æä¾›ä¿¡æ¯ç»™ç¼–è¯‘å™¨ï¼š ç¼–è¯‘å™¨å¯ä»¥åˆ©ç”¨æ³¨è§£æ¥æ¢æµ‹é”™è¯¯å’Œè­¦å‘Šä¿¡æ¯

+ ç¼–è¯‘é˜¶æ®µæ—¶çš„å¤„ç†ï¼š è½¯ä»¶å·¥å…·å¯ä»¥ç”¨æ¥åˆ©ç”¨æ³¨è§£ä¿¡æ¯æ¥ç”Ÿæˆä»£ç ã€Htmlæ–‡æ¡£æˆ–è€…åšå…¶å®ƒç›¸åº”å¤„ç†ã€‚

+ è¿è¡Œæ—¶çš„å¤„ç†ï¼š æŸäº›æ³¨è§£å¯ä»¥åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™æ¥å—ä»£ç çš„æå–
å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ³¨è§£ä¸æ˜¯ä»£ç æœ¬èº«çš„ä¸€éƒ¨åˆ†ã€‚

### 6.1 demo

æˆ‘è¦å†™ä¸€ä¸ªæµ‹è¯•æ¡†æ¶ï¼Œæµ‹è¯•ç¨‹åºå‘˜çš„ä»£ç æœ‰æ— æ˜æ˜¾çš„å¼‚å¸¸ã€‚

â€”â€” ç¨‹åºå‘˜ A : æˆ‘å†™äº†ä¸€ä¸ªç±»ï¼Œå®ƒçš„åå­—å«åš NoBugï¼Œå› ä¸ºå®ƒæ‰€æœ‰çš„æ–¹æ³•éƒ½æ²¡æœ‰é”™è¯¯ã€‚

â€”â€” æˆ‘ï¼šè‡ªä¿¡æ˜¯å¥½äº‹ï¼Œä¸è¿‡ä¸ºäº†é˜²æ­¢æ„å¤–ï¼Œè®©æˆ‘æµ‹è¯•ä¸€ä¸‹å¦‚ä½•ï¼Ÿ

â€”â€” ç¨‹åºå‘˜ A: æ€ä¹ˆæµ‹è¯•ï¼Ÿ

â€”â€” æˆ‘ï¼šæŠŠä½ å†™çš„ä»£ç çš„æ–¹æ³•éƒ½åŠ ä¸Š @Jiecha è¿™ä¸ªæ³¨è§£å°±å¥½äº†ã€‚

â€”â€” ç¨‹åºå‘˜ A: å¥½çš„ã€‚

```java
package ceshi;
import ceshi.Jiecha;
public class NoBug {
    @Jiecha
    public void suanShu(){
        System.out.println("1234567890");
    }
    @Jiecha
    public void jiafa(){
        System.out.println("1+1="+1+1);
    }
    @Jiecha
    public void jiefa(){
        System.out.println("1-1="+(1-1));
    }
    @Jiecha
    public void chengfa(){
        System.out.println("3 x 5="+ 3*5);
    }
    @Jiecha
    public void chufa(){
        System.out.println("6 / 0="+ 6 / 0);
    }
    public void ziwojieshao(){
        System.out.println("æˆ‘å†™çš„ç¨‹åºæ²¡æœ‰ bug!");
    }
}
```

ä¸Šé¢çš„ä»£ç ï¼Œæœ‰äº›æ–¹æ³•ä¸Šé¢è¿ç”¨äº† @Jiecha æ³¨è§£ã€‚

è¿™ä¸ªæ³¨è§£æ˜¯æˆ‘å†™çš„æµ‹è¯•è½¯ä»¶æ¡†æ¶ä¸­å®šä¹‰çš„æ³¨è§£ã€‚

```java
package ceshi;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
@Retention(RetentionPolicy.RUNTIME)
public @interface Jiecha {
}
```

ç„¶åï¼Œæˆ‘å†ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç±» TestTool å°±å¯ä»¥æµ‹è¯• NoBug ç›¸åº”çš„æ–¹æ³•äº†ã€‚

```java
package ceshi;
import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
public class TestTool {
    public static void main(String[] args) {
        // TODO Auto-generated method stub
        NoBug testobj = new NoBug();
        Class clazz = testobj.getClass();
        Method[] method = clazz.getDeclaredMethods();
        //ç”¨æ¥è®°å½•æµ‹è¯•äº§ç”Ÿçš„ log ä¿¡æ¯
        StringBuilder log = new StringBuilder();
        // è®°å½•å¼‚å¸¸çš„æ¬¡æ•°
        int errornum = 0;
        for ( Method m: method ) {
            // åªæœ‰è¢« @Jiecha æ ‡æ³¨è¿‡çš„æ–¹æ³•æ‰è¿›è¡Œæµ‹è¯•
            if ( m.isAnnotationPresent( Jiecha.class )) {
                try {
                    m.setAccessible(true);
                    m.invoke(testobj, null);
                } catch (Exception e) {
                    // TODO Auto-generated catch block
                    //e.printStackTrace();
                    errornum++;
                    log.append(m.getName());
                    log.append(" ");
                    log.append("has error:");
                    log.append("\n\r  caused by ");
                    //è®°å½•æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œå‘ç”Ÿçš„å¼‚å¸¸çš„åç§°
                    log.append(e.getCause().getClass().getSimpleName());
                    log.append("\n\r");
                    //è®°å½•æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œå‘ç”Ÿçš„å¼‚å¸¸çš„å…·ä½“ä¿¡æ¯
                    log.append(e.getCause().getMessage());
                    log.append("\n\r");
                } 
            }
        }
        log.append(clazz.getSimpleName());
        log.append(" has  ");
        log.append(errornum);
        log.append(" error.");
        // ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
        System.out.println(log.toString());
    }
}
```

æµ‹è¯•çš„ç»“æœæ˜¯ï¼š

```java
1234567890
1+1=11
1-1=0
3 x 5=15
chufa has error:
  caused by ArithmeticException
/ by zero
NoBug has  1 error.
```

æç¤º NoBug ç±»ä¸­çš„ chufa() è¿™ä¸ªæ–¹æ³•æœ‰å¼‚å¸¸ï¼Œè¿™ä¸ªå¼‚å¸¸åç§°å«åš ArithmeticExceptionï¼ŒåŸå› æ˜¯è¿ç®—è¿‡ç¨‹ä¸­è¿›è¡Œäº†é™¤ 0 çš„æ“ä½œã€‚

æ‰€ä»¥ï¼ŒNoBug è¿™ä¸ªç±»æœ‰ Bugã€‚

è¿™æ ·ï¼Œé€šè¿‡æ³¨è§£æˆ‘å®Œæˆäº†æˆ‘è‡ªå·±çš„ç›®çš„ï¼Œé‚£å°±æ˜¯å¯¹åˆ«äººçš„ä»£ç è¿›è¡Œæµ‹è¯•ã€‚

æ‰€ä»¥ï¼Œå†é—®æˆ‘æ³¨è§£ä»€ä¹ˆæ—¶å€™ç”¨ï¼Ÿæˆ‘åªèƒ½å‘Šè¯‰ä½ ï¼Œè¿™å–å†³äºä½ æƒ³åˆ©ç”¨å®ƒå¹²ä»€ä¹ˆç”¨ã€‚






