## 1. 为什么设置SO_REUSEADDR可以解决time_wait？

SO_REUSEADDR 是一个套接字选项，允许多个套接字绑定到同一地址和端口上。在 TCP 连接中，这个选项在以下几种情况下特别有用：
  1. 允许端口重用：即使端口仍然处于 TIME_WAIT 状态，设置了 SO_REUSEADDR 的套接字仍然可以绑定到该端口。这在服务器程序需要频繁重启时特别有用，因为它允许新启动的服务器立即绑定到之前使用过的端口上，而不会等待旧连接完全关闭。

  2. 处理绑定冲突：在某些操作系统上，SO_REUSEADDR 可以帮助解决由于端口还在 TIME_WAIT 状态而导致的绑定冲突问题。这样，服务器可以在没有等待端口完全释放的情况下重新使用相同的端口。


## 2. 在 TCP 的断开连接过程（四次挥手，Four-Way Handshake）中，TIME_WAIT 状态通常会发生在主动关闭连接的一方。

在 TCP 连接断开时，主动关闭连接的一方（无论是客户端还是服务器）会发送一个 FIN 包来表示它不再发送数据。这个过程称为四次挥手（Four-Way Handshake）。


详细解析这个过程：
1. 第一次挥手（FIN）：
  主动关闭方（可以是客户端或服务器）发送一个 FIN（Finish）包，表示它不再发送数据。此时，主动关闭方进入 FIN_WAIT_1 状态。
2. 第二次挥手（ACK）：
  被动关闭方 接收到 FIN 包后，发送一个确认（ACK）包给主动关闭方，并进入 CLOSE_WAIT 状态。被动关闭方此时可以继续向主动关闭方发送数据。
3. 第三次挥手（FIN）：
  被动关闭方完成其数据传输后，发送一个 FIN 包，表示它也不再发送数据。此时，被动关闭方进入 LAST_ACK 状态。
4. 第四次挥手（ACK）
  主动关闭方收到被动关闭方的 FIN 包后，发送一个确认（ACK）包，进入 TIME_WAIT 状态，等待足够长的时间（通常是 2 倍的最大段生命周期，MSL），以确保最后的确认包能到达对方。如果没有问题，主动关闭方最终会进入 CLOSED 状态。

TIME_WAIT 状态通常发生在主动关闭连接的一方。也就是说，先发送 FIN 包的套接字，在确认接收到最后一个 FIN 包后，会进入 TIME_WAIT 状态。主动关闭方在 TIME_WAIT 状态下会保留该端口一段时间，以确保所有数据包都已经被处理并且网络上的数据包不会干扰将来的连接。

TIME_WAIT 状态与 TCP 连接的断开过程（即四次挥手）是直接相关的，而不是与请求连接过程中的 SYN 消息传输顺序有关

## dns

DNS（Domain Name System） 是互联网的一项核心技术，用于将人类可读的域名（如 www.example.com）转换为计算机可理解的 IP 地址（如 192.0.2.1）。这使得我们能够使用易于记忆的域名访问网站，而无需记住复杂的 IP 地址。

域名解析：将用户输入的域名转换为 IP 地址，从而使计算机能够在网络上找到目标服务器。

DNS 的工作原理
  1. 客户端查询：当用户在浏览器中输入一个域名时，浏览器会向本地 DNS 解析器（通常由操作系统提供）发送查询请求。
  2. 递归查询：本地 DNS 解析器如果缓存中没有该域名的解析结果，会递归地查询 DNS 服务器。首先查询根 DNS 服务器，根服务器将请求转发到相应的 TLD 服务器。TLD 服务器将请求转发到权威 DNS 服务器。
  3. 权威 DNS 服务器返回结果：权威 DNS 服务器返回结果：递归 DNS 服务器将结果缓存并返回给客户端。
  4. 客户端使用 IP 地址：客户端接收到 IP 地址后，可以直接与目标服务器建立连接。

路由器在 DNS 查询中扮演了中介的角色，帮助设备与 DNS 服务器之间进行有效的通信。
访问网站的过程
  1. 设备请求域名：用户在浏览器中输入 www.example.com。
  2. DNS 查询：设备向配置的 DNS 服务器（可能是路由器或外部 DNS 服务器）发送 DNS 查询请求。
  3. DNS 解析：DNS 服务器返回 www.example.com 对应的 IP 地址（如 192.0.2.1）。
  4. 路由器转发数据：设备使用解析得到的 IP 地址向目标服务器发送请求。路由器在网络中转发这些数据包，确保它们能够到达目标服务器，并将服务器的响应数据包返回给设备

路由器通常配置了 DNS 服务器的地址。设备通过路由器发出的 DNS 查询请求将被路由器转发到配置的 DNS 服务器。
路由器可以使用 DNS 转发功能，将 DNS 查询请求转发到上游 DNS 服务器，并将解析结果返回给设备。

### DNS 服务器和路由器

DNS 服务器和路由器是网络中两个不同的组件

1. DNS 服务器
  主要功能： DNS 服务器的主要功能是将域名转换为 IP 地址。用户在浏览器中输入的域名（如 www.example.com）会被 DNS 服务器解析为一个 IP 地址（如 192.0.2.1），以便设备能够找到目标服务器并进行通信。

  数据处理： DNS 服务器处理域名解析请求，并根据其 DNS 数据库或通过递归查询返回相应的 IP 地址。

  网络服务： DNS 服务器是网络服务的一部分，用于提供域名解析服务，不直接处理数据包的路由或转发。

2. 路由器
  主要功能： 路由器的主要功能是在网络中转发数据包。它将数据从一个网络传输到另一个网络或子网，确保数据能够到达目标设备。

  数据处理： 路由器根据目的地 IP 地址和其路由表来决定如何转发数据包。它在网络层处理数据包的路由和转发。

  网络设备： 路由器是网络基础设施的一部分，负责管理网络流量、连接不同的网络或子网。

DNS 服务器：
  处理域名解析请求。
  管理域名到 IP 地址的映射。
  可以是公共 DNS 服务器（如 Google DNS、Cloudflare DNS）或私有 DNS 服务器（如公司内部的 DNS 服务器）。

路由器：
  转发数据包在网络中。
  连接不同的网络或子网。
  可能包括 NAT（网络地址转换）、防火墙和其他网络管理功能。

DNS 查询： 当设备需要解析一个域名时，它会向 DNS 服务器发送查询请求。这个请求可能首先经过路由器，路由器将其转发到 DNS 服务器。

数据包转发： 一旦 DNS 服务器返回域名对应的 IP 地址，设备会使用这个 IP 地址通过路由器将数据包发送到目标服务器。



## 所有的域名信息并非集中在1台DNS服务器，但可以获取某一台DNS服务器中未注册的IP地址，对吗？
不对

NS 系统是分层的，包括根 DNS 服务器、顶级域名服务器（如 .com、.org）、权威 DNS 服务器（负责具体的域名）等。每一层负责管理和维护不同级别的域名。

域名分布： 域名信息并不集中在单台服务器上，而是分布在不同的 DNS 服务器中。根 DNS 服务器提供对顶级域名服务器的指引，顶级域名服务器指向权威 DNS 服务器，权威 DNS 服务器提供最终的域名解析。

如果某个 IP 地址未被注册到 DNS 系统中（例如，它不是任何已知域名的 IP 地址），那么 DNS 服务器将无法提供与该 IP 地址相关联的域名。通常，DNS 服务器只会提供它自己知道的信息。

DNS 服务器的作用： 如果 DNS 服务器被请求解析一个未注册的域名，它会将查询转发到其他 DNS 服务器，直到找到相关信息或确定该域名未注册。如果最终没有找到对应的信息，该 DNS 服务器会返回一个“NXDOMAIN”错误，表示该域名不存在。





